var CE=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Wk=CE(($k,eE)=>{const LE=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}};LE();var Rt={exports:{}},Y={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var so=Symbol.for("react.element"),ME=Symbol.for("react.portal"),IE=Symbol.for("react.fragment"),RE=Symbol.for("react.strict_mode"),OE=Symbol.for("react.profiler"),kE=Symbol.for("react.provider"),NE=Symbol.for("react.context"),FE=Symbol.for("react.forward_ref"),DE=Symbol.for("react.suspense"),zE=Symbol.for("react.memo"),UE=Symbol.for("react.lazy"),Yd=Symbol.iterator;function BE(t){return t===null||typeof t!="object"?null:(t=Yd&&t[Yd]||t["@@iterator"],typeof t=="function"?t:null)}var y0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_0=Object.assign,E0={};function Ir(t,e,n){this.props=t,this.context=e,this.refs=E0,this.updater=n||y0}Ir.prototype.isReactComponent={};Ir.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ir.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function w0(){}w0.prototype=Ir.prototype;function Kf(t,e,n){this.props=t,this.context=e,this.refs=E0,this.updater=n||y0}var qf=Kf.prototype=new w0;qf.constructor=Kf;_0(qf,Ir.prototype);qf.isPureReactComponent=!0;var Zd=Array.isArray,x0=Object.prototype.hasOwnProperty,Qf={current:null},T0={key:!0,ref:!0,__self:!0,__source:!0};function S0(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)x0.call(e,i)&&!T0.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:so,type:t,key:s,ref:o,props:r,_owner:Qf.current}}function VE(t,e){return{$$typeof:so,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Jf(t){return typeof t=="object"&&t!==null&&t.$$typeof===so}function jE(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Kd=/\/+/g;function mc(t,e){return typeof t=="object"&&t!==null&&t.key!=null?jE(""+t.key):e.toString(36)}function ma(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case so:case ME:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+mc(o,0):i,Zd(r)?(n="",t!=null&&(n=t.replace(Kd,"$&/")+"/"),ma(r,e,n,"",function(c){return c})):r!=null&&(Jf(r)&&(r=VE(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(Kd,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",Zd(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+mc(s,a);o+=ma(s,e,n,l,r)}else if(l=BE(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+mc(s,a++),o+=ma(s,e,n,l,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ko(t,e,n){if(t==null)return t;var i=[],r=0;return ma(t,i,"","",function(s){return e.call(n,s,r++)}),i}function GE(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var We={current:null},va={transition:null},WE={ReactCurrentDispatcher:We,ReactCurrentBatchConfig:va,ReactCurrentOwner:Qf};Y.Children={map:ko,forEach:function(t,e,n){ko(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ko(t,function(){e++}),e},toArray:function(t){return ko(t,function(e){return e})||[]},only:function(t){if(!Jf(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Y.Component=Ir;Y.Fragment=IE;Y.Profiler=OE;Y.PureComponent=Kf;Y.StrictMode=RE;Y.Suspense=DE;Y.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=WE;Y.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=_0({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Qf.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)x0.call(e,l)&&!T0.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:so,type:t.type,key:r,ref:s,props:i,_owner:o}};Y.createContext=function(t){return t={$$typeof:NE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:kE,_context:t},t.Consumer=t};Y.createElement=S0;Y.createFactory=function(t){var e=S0.bind(null,t);return e.type=t,e};Y.createRef=function(){return{current:null}};Y.forwardRef=function(t){return{$$typeof:FE,render:t}};Y.isValidElement=Jf;Y.lazy=function(t){return{$$typeof:UE,_payload:{_status:-1,_result:t},_init:GE}};Y.memo=function(t,e){return{$$typeof:zE,type:t,compare:e===void 0?null:e}};Y.startTransition=function(t){var e=va.transition;va.transition={};try{t()}finally{va.transition=e}};Y.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Y.useCallback=function(t,e){return We.current.useCallback(t,e)};Y.useContext=function(t){return We.current.useContext(t)};Y.useDebugValue=function(){};Y.useDeferredValue=function(t){return We.current.useDeferredValue(t)};Y.useEffect=function(t,e){return We.current.useEffect(t,e)};Y.useId=function(){return We.current.useId()};Y.useImperativeHandle=function(t,e,n){return We.current.useImperativeHandle(t,e,n)};Y.useInsertionEffect=function(t,e){return We.current.useInsertionEffect(t,e)};Y.useLayoutEffect=function(t,e){return We.current.useLayoutEffect(t,e)};Y.useMemo=function(t,e){return We.current.useMemo(t,e)};Y.useReducer=function(t,e,n){return We.current.useReducer(t,e,n)};Y.useRef=function(t){return We.current.useRef(t)};Y.useState=function(t){return We.current.useState(t)};Y.useSyncExternalStore=function(t,e,n){return We.current.useSyncExternalStore(t,e,n)};Y.useTransition=function(){return We.current.useTransition()};Y.version="18.2.0";Rt.exports=Y;var HE=Rt.exports,Su={},P0={exports:{}},dt={},b0={exports:{}},A0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(F,V){var G=F.length;F.push(V);e:for(;0<G;){var ae=G-1>>>1,se=F[ae];if(0<r(se,V))F[ae]=V,F[G]=se,G=ae;else break e}}function n(F){return F.length===0?null:F[0]}function i(F){if(F.length===0)return null;var V=F[0],G=F.pop();if(G!==V){F[0]=G;e:for(var ae=0,se=F.length,ki=se>>>1;ae<ki;){var Ct=2*(ae+1)-1,zr=F[Ct],sn=Ct+1,me=F[sn];if(0>r(zr,G))sn<se&&0>r(me,zr)?(F[ae]=me,F[sn]=G,ae=sn):(F[ae]=zr,F[Ct]=G,ae=Ct);else if(sn<se&&0>r(me,G))F[ae]=me,F[sn]=G,ae=sn;else break e}}return V}function r(F,V){var G=F.sortIndex-V.sortIndex;return G!==0?G:F.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,f=null,h=3,p=!1,g=!1,_=!1,x=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate!="undefined"?setImmediate:null;typeof navigator!="undefined"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(F){for(var V=n(c);V!==null;){if(V.callback===null)i(c);else if(V.startTime<=F)i(c),V.sortIndex=V.expirationTime,e(l,V);else break;V=n(c)}}function S(F){if(_=!1,w(F),!g)if(n(l)!==null)g=!0,si(P);else{var V=n(c);V!==null&&An(S,V.startTime-F)}}function P(F,V){g=!1,_&&(_=!1,y(M),M=-1),p=!0;var G=h;try{for(w(V),f=n(l);f!==null&&(!(f.expirationTime>V)||F&&!U());){var ae=f.callback;if(typeof ae=="function"){f.callback=null,h=f.priorityLevel;var se=ae(f.expirationTime<=V);V=t.unstable_now(),typeof se=="function"?f.callback=se:f===n(l)&&i(l),w(V)}else i(l);f=n(l)}if(f!==null)var ki=!0;else{var Ct=n(c);Ct!==null&&An(S,Ct.startTime-V),ki=!1}return ki}finally{f=null,h=G,p=!1}}var A=!1,C=null,M=-1,R=5,O=-1;function U(){return!(t.unstable_now()-O<R)}function B(){if(C!==null){var F=t.unstable_now();O=F;var V=!0;try{V=C(!0,F)}finally{V?j():(A=!1,C=null)}}else A=!1}var j;if(typeof v=="function")j=function(){v(B)};else if(typeof MessageChannel!="undefined"){var H=new MessageChannel,$e=H.port2;H.port1.onmessage=B,j=function(){$e.postMessage(null)}}else j=function(){x(B,0)};function si(F){C=F,A||(A=!0,j())}function An(F,V){M=x(function(){F(t.unstable_now())},V)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(F){F.callback=null},t.unstable_continueExecution=function(){g||p||(g=!0,si(P))},t.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<F?Math.floor(1e3/F):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(F){switch(h){case 1:case 2:case 3:var V=3;break;default:V=h}var G=h;h=V;try{return F()}finally{h=G}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(F,V){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var G=h;h=F;try{return V()}finally{h=G}},t.unstable_scheduleCallback=function(F,V,G){var ae=t.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?ae+G:ae):G=ae,F){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=G+se,F={id:u++,callback:V,priorityLevel:F,startTime:G,expirationTime:se,sortIndex:-1},G>ae?(F.sortIndex=G,e(c,F),n(l)===null&&F===n(c)&&(_?(y(M),M=-1):_=!0,An(S,G-ae))):(F.sortIndex=se,e(l,F),g||p||(g=!0,si(P))),F},t.unstable_shouldYield=U,t.unstable_wrapCallback=function(F){var V=h;return function(){var G=h;h=V;try{return F.apply(this,arguments)}finally{h=G}}}})(A0);b0.exports=A0;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C0=Rt.exports,ft=b0.exports;function I(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var L0=new Set,Ms={};function Mi(t,e){mr(t,e),mr(t+"Capture",e)}function mr(t,e){for(Ms[t]=e,t=0;t<e.length;t++)L0.add(e[t])}var vn=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),Pu=Object.prototype.hasOwnProperty,$E=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qd={},Qd={};function XE(t){return Pu.call(Qd,t)?!0:Pu.call(qd,t)?!1:$E.test(t)?Qd[t]=!0:(qd[t]=!0,!1)}function YE(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function ZE(t,e,n,i){if(e===null||typeof e=="undefined"||YE(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function He(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Ie={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ie[t]=new He(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ie[e]=new He(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ie[t]=new He(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ie[t]=new He(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ie[t]=new He(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ie[t]=new He(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ie[t]=new He(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ie[t]=new He(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ie[t]=new He(t,5,!1,t.toLowerCase(),null,!1,!1)});var eh=/[\-:]([a-z])/g;function th(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(eh,th);Ie[e]=new He(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(eh,th);Ie[e]=new He(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(eh,th);Ie[e]=new He(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ie[t]=new He(t,1,!1,t.toLowerCase(),null,!1,!1)});Ie.xlinkHref=new He("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ie[t]=new He(t,1,!1,t.toLowerCase(),null,!0,!0)});function nh(t,e,n,i){var r=Ie.hasOwnProperty(e)?Ie[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ZE(e,n,r,i)&&(n=null),i||r===null?XE(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Sn=C0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,No=Symbol.for("react.element"),Hi=Symbol.for("react.portal"),$i=Symbol.for("react.fragment"),ih=Symbol.for("react.strict_mode"),bu=Symbol.for("react.profiler"),M0=Symbol.for("react.provider"),I0=Symbol.for("react.context"),rh=Symbol.for("react.forward_ref"),Au=Symbol.for("react.suspense"),Cu=Symbol.for("react.suspense_list"),sh=Symbol.for("react.memo"),Nn=Symbol.for("react.lazy"),R0=Symbol.for("react.offscreen"),Jd=Symbol.iterator;function $r(t){return t===null||typeof t!="object"?null:(t=Jd&&t[Jd]||t["@@iterator"],typeof t=="function"?t:null)}var fe=Object.assign,vc;function ls(t){if(vc===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);vc=e&&e[1]||""}return`
`+vc+t}var yc=!1;function _c(t,e){if(!t||yc)return"";yc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{yc=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ls(t):""}function KE(t){switch(t.tag){case 5:return ls(t.type);case 16:return ls("Lazy");case 13:return ls("Suspense");case 19:return ls("SuspenseList");case 0:case 2:case 15:return t=_c(t.type,!1),t;case 11:return t=_c(t.type.render,!1),t;case 1:return t=_c(t.type,!0),t;default:return""}}function Lu(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case $i:return"Fragment";case Hi:return"Portal";case bu:return"Profiler";case ih:return"StrictMode";case Au:return"Suspense";case Cu:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case I0:return(t.displayName||"Context")+".Consumer";case M0:return(t._context.displayName||"Context")+".Provider";case rh:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case sh:return e=t.displayName||null,e!==null?e:Lu(t.type)||"Memo";case Nn:e=t._payload,t=t._init;try{return Lu(t(e))}catch{}}return null}function qE(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Lu(e);case 8:return e===ih?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Qn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function O0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function QE(t){var e=O0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n!="undefined"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Fo(t){t._valueTracker||(t._valueTracker=QE(t))}function k0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=O0(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Ba(t){if(t=t||(typeof document!="undefined"?document:void 0),typeof t=="undefined")return null;try{return t.activeElement||t.body}catch{return t.body}}function Mu(t,e){var n=e.checked;return fe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n!=null?n:t._wrapperState.initialChecked})}function ep(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Qn(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function N0(t,e){e=e.checked,e!=null&&nh(t,"checked",e,!1)}function Iu(t,e){N0(t,e);var n=Qn(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Ru(t,e.type,n):e.hasOwnProperty("defaultValue")&&Ru(t,e.type,Qn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function tp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Ru(t,e,n){(e!=="number"||Ba(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var cs=Array.isArray;function ar(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Qn(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Ou(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(I(91));return fe({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function np(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(I(92));if(cs(n)){if(1<n.length)throw Error(I(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Qn(n)}}function F0(t,e){var n=Qn(e.value),i=Qn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function ip(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function D0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ku(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?D0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Do,z0=function(t){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Do=Do||document.createElement("div"),Do.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Do.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Is(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var gs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},JE=["Webkit","ms","Moz","O"];Object.keys(gs).forEach(function(t){JE.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),gs[e]=gs[t]})});function U0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||gs.hasOwnProperty(t)&&gs[t]?(""+e).trim():e+"px"}function B0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=U0(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var ew=fe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Nu(t,e){if(e){if(ew[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(I(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(I(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(I(61))}if(e.style!=null&&typeof e.style!="object")throw Error(I(62))}}function Fu(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Du=null;function oh(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var zu=null,lr=null,cr=null;function rp(t){if(t=lo(t)){if(typeof zu!="function")throw Error(I(280));var e=t.stateNode;e&&(e=Ol(e),zu(t.stateNode,t.type,e))}}function V0(t){lr?cr?cr.push(t):cr=[t]:lr=t}function j0(){if(lr){var t=lr,e=cr;if(cr=lr=null,rp(t),e)for(t=0;t<e.length;t++)rp(e[t])}}function G0(t,e){return t(e)}function W0(){}var Ec=!1;function H0(t,e,n){if(Ec)return t(e,n);Ec=!0;try{return G0(t,e,n)}finally{Ec=!1,(lr!==null||cr!==null)&&(W0(),j0())}}function Rs(t,e){var n=t.stateNode;if(n===null)return null;var i=Ol(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(I(231,e,typeof n));return n}var Uu=!1;if(vn)try{var Xr={};Object.defineProperty(Xr,"passive",{get:function(){Uu=!0}}),window.addEventListener("test",Xr,Xr),window.removeEventListener("test",Xr,Xr)}catch{Uu=!1}function tw(t,e,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var ms=!1,Va=null,ja=!1,Bu=null,nw={onError:function(t){ms=!0,Va=t}};function iw(t,e,n,i,r,s,o,a,l){ms=!1,Va=null,tw.apply(nw,arguments)}function rw(t,e,n,i,r,s,o,a,l){if(iw.apply(this,arguments),ms){if(ms){var c=Va;ms=!1,Va=null}else throw Error(I(198));ja||(ja=!0,Bu=c)}}function Ii(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&4098)!==0&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function $0(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function sp(t){if(Ii(t)!==t)throw Error(I(188))}function sw(t){var e=t.alternate;if(!e){if(e=Ii(t),e===null)throw Error(I(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return sp(r),t;if(s===i)return sp(r),e;s=s.sibling}throw Error(I(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(I(189))}}if(n.alternate!==i)throw Error(I(190))}if(n.tag!==3)throw Error(I(188));return n.stateNode.current===n?t:e}function X0(t){return t=sw(t),t!==null?Y0(t):null}function Y0(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Y0(t);if(e!==null)return e;t=t.sibling}return null}var Z0=ft.unstable_scheduleCallback,op=ft.unstable_cancelCallback,ow=ft.unstable_shouldYield,aw=ft.unstable_requestPaint,pe=ft.unstable_now,lw=ft.unstable_getCurrentPriorityLevel,ah=ft.unstable_ImmediatePriority,K0=ft.unstable_UserBlockingPriority,Ga=ft.unstable_NormalPriority,cw=ft.unstable_LowPriority,q0=ft.unstable_IdlePriority,Ll=null,Qt=null;function uw(t){if(Qt&&typeof Qt.onCommitFiberRoot=="function")try{Qt.onCommitFiberRoot(Ll,t,void 0,(t.current.flags&128)===128)}catch{}}var zt=Math.clz32?Math.clz32:dw,fw=Math.log,hw=Math.LN2;function dw(t){return t>>>=0,t===0?32:31-(fw(t)/hw|0)|0}var zo=64,Uo=4194304;function us(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Wa(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=us(a):(s&=o,s!==0&&(i=us(s)))}else o=n&~r,o!==0?i=us(o):s!==0&&(i=us(s));if(i===0)return 0;if(e!==0&&e!==i&&(e&r)===0&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if((i&4)!==0&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-zt(e),r=1<<n,i|=t[n],e&=~r;return i}function pw(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gw(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-zt(s),a=1<<o,l=r[o];l===-1?((a&n)===0||(a&i)!==0)&&(r[o]=pw(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function Vu(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Q0(){var t=zo;return zo<<=1,(zo&4194240)===0&&(zo=64),t}function wc(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function oo(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-zt(e),t[e]=n}function mw(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-zt(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function lh(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-zt(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var q=0;function J0(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var ev,ch,tv,nv,iv,ju=!1,Bo=[],Gn=null,Wn=null,Hn=null,Os=new Map,ks=new Map,Dn=[],vw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ap(t,e){switch(t){case"focusin":case"focusout":Gn=null;break;case"dragenter":case"dragleave":Wn=null;break;case"mouseover":case"mouseout":Hn=null;break;case"pointerover":case"pointerout":Os.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ks.delete(e.pointerId)}}function Yr(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=lo(e),e!==null&&ch(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function yw(t,e,n,i,r){switch(e){case"focusin":return Gn=Yr(Gn,t,e,n,i,r),!0;case"dragenter":return Wn=Yr(Wn,t,e,n,i,r),!0;case"mouseover":return Hn=Yr(Hn,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return Os.set(s,Yr(Os.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,ks.set(s,Yr(ks.get(s)||null,t,e,n,i,r)),!0}return!1}function rv(t){var e=gi(t.target);if(e!==null){var n=Ii(e);if(n!==null){if(e=n.tag,e===13){if(e=$0(n),e!==null){t.blockedOn=e,iv(t.priority,function(){tv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ya(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Gu(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Du=i,n.target.dispatchEvent(i),Du=null}else return e=lo(n),e!==null&&ch(e),t.blockedOn=n,!1;e.shift()}return!0}function lp(t,e,n){ya(t)&&n.delete(e)}function _w(){ju=!1,Gn!==null&&ya(Gn)&&(Gn=null),Wn!==null&&ya(Wn)&&(Wn=null),Hn!==null&&ya(Hn)&&(Hn=null),Os.forEach(lp),ks.forEach(lp)}function Zr(t,e){t.blockedOn===e&&(t.blockedOn=null,ju||(ju=!0,ft.unstable_scheduleCallback(ft.unstable_NormalPriority,_w)))}function Ns(t){function e(r){return Zr(r,t)}if(0<Bo.length){Zr(Bo[0],t);for(var n=1;n<Bo.length;n++){var i=Bo[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Gn!==null&&Zr(Gn,t),Wn!==null&&Zr(Wn,t),Hn!==null&&Zr(Hn,t),Os.forEach(e),ks.forEach(e),n=0;n<Dn.length;n++)i=Dn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Dn.length&&(n=Dn[0],n.blockedOn===null);)rv(n),n.blockedOn===null&&Dn.shift()}var ur=Sn.ReactCurrentBatchConfig,Ha=!0;function Ew(t,e,n,i){var r=q,s=ur.transition;ur.transition=null;try{q=1,uh(t,e,n,i)}finally{q=r,ur.transition=s}}function ww(t,e,n,i){var r=q,s=ur.transition;ur.transition=null;try{q=4,uh(t,e,n,i)}finally{q=r,ur.transition=s}}function uh(t,e,n,i){if(Ha){var r=Gu(t,e,n,i);if(r===null)Ic(t,e,i,$a,n),ap(t,i);else if(yw(r,t,e,n,i))i.stopPropagation();else if(ap(t,i),e&4&&-1<vw.indexOf(t)){for(;r!==null;){var s=lo(r);if(s!==null&&ev(s),s=Gu(t,e,n,i),s===null&&Ic(t,e,i,$a,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else Ic(t,e,i,null,n)}}var $a=null;function Gu(t,e,n,i){if($a=null,t=oh(i),t=gi(t),t!==null)if(e=Ii(t),e===null)t=null;else if(n=e.tag,n===13){if(t=$0(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return $a=t,null}function sv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(lw()){case ah:return 1;case K0:return 4;case Ga:case cw:return 16;case q0:return 536870912;default:return 16}default:return 16}}var Un=null,fh=null,_a=null;function ov(){if(_a)return _a;var t,e=fh,n=e.length,i,r="value"in Un?Un.value:Un.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return _a=r.slice(t,1<i?1-i:void 0)}function Ea(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Vo(){return!0}function cp(){return!1}function pt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Vo:cp,this.isPropagationStopped=cp,this}return fe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Vo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Vo)},persist:function(){},isPersistent:Vo}),e}var Rr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hh=pt(Rr),ao=fe({},Rr,{view:0,detail:0}),xw=pt(ao),xc,Tc,Kr,Ml=fe({},ao,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Kr&&(Kr&&t.type==="mousemove"?(xc=t.screenX-Kr.screenX,Tc=t.screenY-Kr.screenY):Tc=xc=0,Kr=t),xc)},movementY:function(t){return"movementY"in t?t.movementY:Tc}}),up=pt(Ml),Tw=fe({},Ml,{dataTransfer:0}),Sw=pt(Tw),Pw=fe({},ao,{relatedTarget:0}),Sc=pt(Pw),bw=fe({},Rr,{animationName:0,elapsedTime:0,pseudoElement:0}),Aw=pt(bw),Cw=fe({},Rr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Lw=pt(Cw),Mw=fe({},Rr,{data:0}),fp=pt(Mw),Iw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ow={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kw(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Ow[t])?!!e[t]:!1}function dh(){return kw}var Nw=fe({},ao,{key:function(t){if(t.key){var e=Iw[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Ea(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Rw[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dh,charCode:function(t){return t.type==="keypress"?Ea(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ea(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Fw=pt(Nw),Dw=fe({},Ml,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hp=pt(Dw),zw=fe({},ao,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dh}),Uw=pt(zw),Bw=fe({},Rr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Vw=pt(Bw),jw=fe({},Ml,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Gw=pt(jw),Ww=[9,13,27,32],ph=vn&&"CompositionEvent"in window,vs=null;vn&&"documentMode"in document&&(vs=document.documentMode);var Hw=vn&&"TextEvent"in window&&!vs,av=vn&&(!ph||vs&&8<vs&&11>=vs),dp=String.fromCharCode(32),pp=!1;function lv(t,e){switch(t){case"keyup":return Ww.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Xi=!1;function $w(t,e){switch(t){case"compositionend":return cv(e);case"keypress":return e.which!==32?null:(pp=!0,dp);case"textInput":return t=e.data,t===dp&&pp?null:t;default:return null}}function Xw(t,e){if(Xi)return t==="compositionend"||!ph&&lv(t,e)?(t=ov(),_a=fh=Un=null,Xi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return av&&e.locale!=="ko"?null:e.data;default:return null}}var Yw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Yw[t.type]:e==="textarea"}function uv(t,e,n,i){V0(i),e=Xa(e,"onChange"),0<e.length&&(n=new hh("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var ys=null,Fs=null;function Zw(t){wv(t,0)}function Il(t){var e=Ki(t);if(k0(e))return t}function Kw(t,e){if(t==="change")return e}var fv=!1;if(vn){var Pc;if(vn){var bc="oninput"in document;if(!bc){var mp=document.createElement("div");mp.setAttribute("oninput","return;"),bc=typeof mp.oninput=="function"}Pc=bc}else Pc=!1;fv=Pc&&(!document.documentMode||9<document.documentMode)}function vp(){ys&&(ys.detachEvent("onpropertychange",hv),Fs=ys=null)}function hv(t){if(t.propertyName==="value"&&Il(Fs)){var e=[];uv(e,Fs,t,oh(t)),H0(Zw,e)}}function qw(t,e,n){t==="focusin"?(vp(),ys=e,Fs=n,ys.attachEvent("onpropertychange",hv)):t==="focusout"&&vp()}function Qw(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Il(Fs)}function Jw(t,e){if(t==="click")return Il(e)}function ex(t,e){if(t==="input"||t==="change")return Il(e)}function tx(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Vt=typeof Object.is=="function"?Object.is:tx;function Ds(t,e){if(Vt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Pu.call(e,r)||!Vt(t[r],e[r]))return!1}return!0}function yp(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function _p(t,e){var n=yp(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=yp(n)}}function dv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?dv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function pv(){for(var t=window,e=Ba();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ba(t.document)}return e}function gh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function nx(t){var e=pv(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&dv(n.ownerDocument.documentElement,n)){if(i!==null&&gh(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=_p(n,s);var o=_p(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var ix=vn&&"documentMode"in document&&11>=document.documentMode,Yi=null,Wu=null,_s=null,Hu=!1;function Ep(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Hu||Yi==null||Yi!==Ba(i)||(i=Yi,"selectionStart"in i&&gh(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),_s&&Ds(_s,i)||(_s=i,i=Xa(Wu,"onSelect"),0<i.length&&(e=new hh("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Yi)))}function jo(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Zi={animationend:jo("Animation","AnimationEnd"),animationiteration:jo("Animation","AnimationIteration"),animationstart:jo("Animation","AnimationStart"),transitionend:jo("Transition","TransitionEnd")},Ac={},gv={};vn&&(gv=document.createElement("div").style,"AnimationEvent"in window||(delete Zi.animationend.animation,delete Zi.animationiteration.animation,delete Zi.animationstart.animation),"TransitionEvent"in window||delete Zi.transitionend.transition);function Rl(t){if(Ac[t])return Ac[t];if(!Zi[t])return t;var e=Zi[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in gv)return Ac[t]=e[n];return t}var mv=Rl("animationend"),vv=Rl("animationiteration"),yv=Rl("animationstart"),_v=Rl("transitionend"),Ev=new Map,wp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ni(t,e){Ev.set(t,e),Mi(e,[t])}for(var Cc=0;Cc<wp.length;Cc++){var Lc=wp[Cc],rx=Lc.toLowerCase(),sx=Lc[0].toUpperCase()+Lc.slice(1);ni(rx,"on"+sx)}ni(mv,"onAnimationEnd");ni(vv,"onAnimationIteration");ni(yv,"onAnimationStart");ni("dblclick","onDoubleClick");ni("focusin","onFocus");ni("focusout","onBlur");ni(_v,"onTransitionEnd");mr("onMouseEnter",["mouseout","mouseover"]);mr("onMouseLeave",["mouseout","mouseover"]);mr("onPointerEnter",["pointerout","pointerover"]);mr("onPointerLeave",["pointerout","pointerover"]);Mi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Mi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Mi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Mi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Mi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Mi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ox=new Set("cancel close invalid load scroll toggle".split(" ").concat(fs));function xp(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,rw(i,e,void 0,t),t.currentTarget=null}function wv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;xp(r,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;xp(r,a,c),s=l}}}if(ja)throw t=Bu,ja=!1,Bu=null,t}function ie(t,e){var n=e[Ku];n===void 0&&(n=e[Ku]=new Set);var i=t+"__bubble";n.has(i)||(xv(e,t,2,!1),n.add(i))}function Mc(t,e,n){var i=0;e&&(i|=4),xv(n,t,i,e)}var Go="_reactListening"+Math.random().toString(36).slice(2);function zs(t){if(!t[Go]){t[Go]=!0,L0.forEach(function(n){n!=="selectionchange"&&(ox.has(n)||Mc(n,!1,t),Mc(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Go]||(e[Go]=!0,Mc("selectionchange",!1,e))}}function xv(t,e,n,i){switch(sv(e)){case 1:var r=Ew;break;case 4:r=ww;break;default:r=uh}n=r.bind(null,e,n,t),r=void 0,!Uu||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Ic(t,e,n,i,r){var s=i;if((e&1)===0&&(e&2)===0&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=gi(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}H0(function(){var c=s,u=oh(n),f=[];e:{var h=Ev.get(t);if(h!==void 0){var p=hh,g=t;switch(t){case"keypress":if(Ea(n)===0)break e;case"keydown":case"keyup":p=Fw;break;case"focusin":g="focus",p=Sc;break;case"focusout":g="blur",p=Sc;break;case"beforeblur":case"afterblur":p=Sc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=up;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Sw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=Uw;break;case mv:case vv:case yv:p=Aw;break;case _v:p=Vw;break;case"scroll":p=xw;break;case"wheel":p=Gw;break;case"copy":case"cut":case"paste":p=Lw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=hp}var _=(e&4)!==0,x=!_&&t==="scroll",y=_?h!==null?h+"Capture":null:h;_=[];for(var v=c,w;v!==null;){w=v;var S=w.stateNode;if(w.tag===5&&S!==null&&(w=S,y!==null&&(S=Rs(v,y),S!=null&&_.push(Us(v,S,w)))),x)break;v=v.return}0<_.length&&(h=new p(h,g,null,n,u),f.push({event:h,listeners:_}))}}if((e&7)===0){e:{if(h=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",h&&n!==Du&&(g=n.relatedTarget||n.fromElement)&&(gi(g)||g[yn]))break e;if((p||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,p?(g=n.relatedTarget||n.toElement,p=c,g=g?gi(g):null,g!==null&&(x=Ii(g),g!==x||g.tag!==5&&g.tag!==6)&&(g=null)):(p=null,g=c),p!==g)){if(_=up,S="onMouseLeave",y="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(_=hp,S="onPointerLeave",y="onPointerEnter",v="pointer"),x=p==null?h:Ki(p),w=g==null?h:Ki(g),h=new _(S,v+"leave",p,n,u),h.target=x,h.relatedTarget=w,S=null,gi(u)===c&&(_=new _(y,v+"enter",g,n,u),_.target=w,_.relatedTarget=x,S=_),x=S,p&&g)t:{for(_=p,y=g,v=0,w=_;w;w=Fi(w))v++;for(w=0,S=y;S;S=Fi(S))w++;for(;0<v-w;)_=Fi(_),v--;for(;0<w-v;)y=Fi(y),w--;for(;v--;){if(_===y||y!==null&&_===y.alternate)break t;_=Fi(_),y=Fi(y)}_=null}else _=null;p!==null&&Tp(f,h,p,_,!1),g!==null&&x!==null&&Tp(f,x,g,_,!0)}}e:{if(h=c?Ki(c):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var P=Kw;else if(gp(h))if(fv)P=ex;else{P=Qw;var A=qw}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(P=Jw);if(P&&(P=P(t,c))){uv(f,P,n,u);break e}A&&A(t,h,c),t==="focusout"&&(A=h._wrapperState)&&A.controlled&&h.type==="number"&&Ru(h,"number",h.value)}switch(A=c?Ki(c):window,t){case"focusin":(gp(A)||A.contentEditable==="true")&&(Yi=A,Wu=c,_s=null);break;case"focusout":_s=Wu=Yi=null;break;case"mousedown":Hu=!0;break;case"contextmenu":case"mouseup":case"dragend":Hu=!1,Ep(f,n,u);break;case"selectionchange":if(ix)break;case"keydown":case"keyup":Ep(f,n,u)}var C;if(ph)e:{switch(t){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else Xi?lv(t,n)&&(M="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(M="onCompositionStart");M&&(av&&n.locale!=="ko"&&(Xi||M!=="onCompositionStart"?M==="onCompositionEnd"&&Xi&&(C=ov()):(Un=u,fh="value"in Un?Un.value:Un.textContent,Xi=!0)),A=Xa(c,M),0<A.length&&(M=new fp(M,t,null,n,u),f.push({event:M,listeners:A}),C?M.data=C:(C=cv(n),C!==null&&(M.data=C)))),(C=Hw?$w(t,n):Xw(t,n))&&(c=Xa(c,"onBeforeInput"),0<c.length&&(u=new fp("onBeforeInput","beforeinput",null,n,u),f.push({event:u,listeners:c}),u.data=C))}wv(f,e)})}function Us(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Xa(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Rs(t,n),s!=null&&i.unshift(Us(t,s,r)),s=Rs(t,e),s!=null&&i.push(Us(t,s,r))),t=t.return}return i}function Fi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Tp(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,r?(l=Rs(n,s),l!=null&&o.unshift(Us(n,l,a))):r||(l=Rs(n,s),l!=null&&o.push(Us(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var ax=/\r\n?/g,lx=/\u0000|\uFFFD/g;function Sp(t){return(typeof t=="string"?t:""+t).replace(ax,`
`).replace(lx,"")}function Wo(t,e,n){if(e=Sp(e),Sp(t)!==e&&n)throw Error(I(425))}function Ya(){}var $u=null,Xu=null;function Yu(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Zu=typeof setTimeout=="function"?setTimeout:void 0,cx=typeof clearTimeout=="function"?clearTimeout:void 0,Pp=typeof Promise=="function"?Promise:void 0,ux=typeof queueMicrotask=="function"?queueMicrotask:typeof Pp!="undefined"?function(t){return Pp.resolve(null).then(t).catch(fx)}:Zu;function fx(t){setTimeout(function(){throw t})}function Rc(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Ns(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Ns(e)}function $n(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function bp(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Or=Math.random().toString(36).slice(2),Kt="__reactFiber$"+Or,Bs="__reactProps$"+Or,yn="__reactContainer$"+Or,Ku="__reactEvents$"+Or,hx="__reactListeners$"+Or,dx="__reactHandles$"+Or;function gi(t){var e=t[Kt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[yn]||n[Kt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=bp(t);t!==null;){if(n=t[Kt])return n;t=bp(t)}return e}t=n,n=t.parentNode}return null}function lo(t){return t=t[Kt]||t[yn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ki(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(I(33))}function Ol(t){return t[Bs]||null}var qu=[],qi=-1;function ii(t){return{current:t}}function re(t){0>qi||(t.current=qu[qi],qu[qi]=null,qi--)}function te(t,e){qi++,qu[qi]=t.current,t.current=e}var Jn={},ze=ii(Jn),qe=ii(!1),Ti=Jn;function vr(t,e){var n=t.type.contextTypes;if(!n)return Jn;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Qe(t){return t=t.childContextTypes,t!=null}function Za(){re(qe),re(ze)}function Ap(t,e,n){if(ze.current!==Jn)throw Error(I(168));te(ze,e),te(qe,n)}function Tv(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(I(108,qE(t)||"Unknown",r));return fe({},n,i)}function Ka(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Jn,Ti=ze.current,te(ze,t),te(qe,qe.current),!0}function Cp(t,e,n){var i=t.stateNode;if(!i)throw Error(I(169));n?(t=Tv(t,e,Ti),i.__reactInternalMemoizedMergedChildContext=t,re(qe),re(ze),te(ze,t)):re(qe),te(qe,n)}var fn=null,kl=!1,Oc=!1;function Sv(t){fn===null?fn=[t]:fn.push(t)}function px(t){kl=!0,Sv(t)}function ri(){if(!Oc&&fn!==null){Oc=!0;var t=0,e=q;try{var n=fn;for(q=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}fn=null,kl=!1}catch(r){throw fn!==null&&(fn=fn.slice(t+1)),Z0(ah,ri),r}finally{q=e,Oc=!1}}return null}var Qi=[],Ji=0,qa=null,Qa=0,_t=[],Et=0,Si=null,dn=1,pn="";function hi(t,e){Qi[Ji++]=Qa,Qi[Ji++]=qa,qa=t,Qa=e}function Pv(t,e,n){_t[Et++]=dn,_t[Et++]=pn,_t[Et++]=Si,Si=t;var i=dn;t=pn;var r=32-zt(i)-1;i&=~(1<<r),n+=1;var s=32-zt(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,dn=1<<32-zt(e)+r|n<<r|i,pn=s+t}else dn=1<<s|n<<r|i,pn=t}function mh(t){t.return!==null&&(hi(t,1),Pv(t,1,0))}function vh(t){for(;t===qa;)qa=Qi[--Ji],Qi[Ji]=null,Qa=Qi[--Ji],Qi[Ji]=null;for(;t===Si;)Si=_t[--Et],_t[Et]=null,pn=_t[--Et],_t[Et]=null,dn=_t[--Et],_t[Et]=null}var ct=null,lt=null,oe=!1,kt=null;function bv(t,e){var n=wt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Lp(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ct=t,lt=$n(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ct=t,lt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Si!==null?{id:dn,overflow:pn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=wt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ct=t,lt=null,!0):!1;default:return!1}}function Qu(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Ju(t){if(oe){var e=lt;if(e){var n=e;if(!Lp(t,e)){if(Qu(t))throw Error(I(418));e=$n(n.nextSibling);var i=ct;e&&Lp(t,e)?bv(i,n):(t.flags=t.flags&-4097|2,oe=!1,ct=t)}}else{if(Qu(t))throw Error(I(418));t.flags=t.flags&-4097|2,oe=!1,ct=t}}}function Mp(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ct=t}function Ho(t){if(t!==ct)return!1;if(!oe)return Mp(t),oe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Yu(t.type,t.memoizedProps)),e&&(e=lt)){if(Qu(t))throw Av(),Error(I(418));for(;e;)bv(t,e),e=$n(e.nextSibling)}if(Mp(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(I(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){lt=$n(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}lt=null}}else lt=ct?$n(t.stateNode.nextSibling):null;return!0}function Av(){for(var t=lt;t;)t=$n(t.nextSibling)}function yr(){lt=ct=null,oe=!1}function yh(t){kt===null?kt=[t]:kt.push(t)}var gx=Sn.ReactCurrentBatchConfig;function It(t,e){if(t&&t.defaultProps){e=fe({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Ja=ii(null),el=null,er=null,_h=null;function Eh(){_h=er=el=null}function wh(t){var e=Ja.current;re(Ja),t._currentValue=e}function ef(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function fr(t,e){el=t,_h=er=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(Ze=!0),t.firstContext=null)}function St(t){var e=t._currentValue;if(_h!==t)if(t={context:t,memoizedValue:e,next:null},er===null){if(el===null)throw Error(I(308));er=t,el.dependencies={lanes:0,firstContext:t}}else er=er.next=t;return e}var mi=null;function xh(t){mi===null?mi=[t]:mi.push(t)}function Cv(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,xh(e)):(n.next=r.next,r.next=n),e.interleaved=n,_n(t,i)}function _n(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Fn=!1;function Th(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Lv(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function gn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Xn(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,(K&2)!==0){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,_n(t,n)}return r=i.interleaved,r===null?(e.next=e,xh(i)):(e.next=r.next,r.next=e),i.interleaved=e,_n(t,n)}function wa(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,lh(t,n)}}function Ip(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function tl(t,e,n,i){var r=t.updateQueue;Fn=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var f=r.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,p=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=t,_=a;switch(h=e,p=n,_.tag){case 1:if(g=_.payload,typeof g=="function"){f=g.call(p,f,h);break e}f=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=_.payload,h=typeof g=="function"?g.call(p,f,h):g,h==null)break e;f=fe({},f,h);break e;case 2:Fn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=p,l=f):u=u.next=p,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(1);if(u===null&&(l=f),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);bi|=o,t.lanes=o,t.memoizedState=f}}function Rp(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(I(191,r));r.call(i)}}}var Mv=new C0.Component().refs;function tf(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:fe({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Nl={isMounted:function(t){return(t=t._reactInternals)?Ii(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Ge(),r=Zn(t),s=gn(i,r);s.payload=e,n!=null&&(s.callback=n),e=Xn(t,s,r),e!==null&&(Ut(e,t,r,i),wa(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Ge(),r=Zn(t),s=gn(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Xn(t,s,r),e!==null&&(Ut(e,t,r,i),wa(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ge(),i=Zn(t),r=gn(n,i);r.tag=2,e!=null&&(r.callback=e),e=Xn(t,r,i),e!==null&&(Ut(e,t,i,n),wa(e,t,i))}};function Op(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Ds(n,i)||!Ds(r,s):!0}function Iv(t,e,n){var i=!1,r=Jn,s=e.contextType;return typeof s=="object"&&s!==null?s=St(s):(r=Qe(e)?Ti:ze.current,i=e.contextTypes,s=(i=i!=null)?vr(t,r):Jn),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Nl,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function kp(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Nl.enqueueReplaceState(e,e.state,null)}function nf(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=Mv,Th(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=St(s):(s=Qe(e)?Ti:ze.current,r.context=vr(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(tf(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Nl.enqueueReplaceState(r,r.state,null),tl(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function qr(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(I(309));var i=n.stateNode}if(!i)throw Error(I(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;a===Mv&&(a=r.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(I(284));if(!n._owner)throw Error(I(290,t))}return t}function $o(t,e){throw t=Object.prototype.toString.call(e),Error(I(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Np(t){var e=t._init;return e(t._payload)}function Rv(t){function e(y,v){if(t){var w=y.deletions;w===null?(y.deletions=[v],y.flags|=16):w.push(v)}}function n(y,v){if(!t)return null;for(;v!==null;)e(y,v),v=v.sibling;return null}function i(y,v){for(y=new Map;v!==null;)v.key!==null?y.set(v.key,v):y.set(v.index,v),v=v.sibling;return y}function r(y,v){return y=Kn(y,v),y.index=0,y.sibling=null,y}function s(y,v,w){return y.index=w,t?(w=y.alternate,w!==null?(w=w.index,w<v?(y.flags|=2,v):w):(y.flags|=2,v)):(y.flags|=1048576,v)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,v,w,S){return v===null||v.tag!==6?(v=Bc(w,y.mode,S),v.return=y,v):(v=r(v,w),v.return=y,v)}function l(y,v,w,S){var P=w.type;return P===$i?u(y,v,w.props.children,S,w.key):v!==null&&(v.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===Nn&&Np(P)===v.type)?(S=r(v,w.props),S.ref=qr(y,v,w),S.return=y,S):(S=Aa(w.type,w.key,w.props,null,y.mode,S),S.ref=qr(y,v,w),S.return=y,S)}function c(y,v,w,S){return v===null||v.tag!==4||v.stateNode.containerInfo!==w.containerInfo||v.stateNode.implementation!==w.implementation?(v=Vc(w,y.mode,S),v.return=y,v):(v=r(v,w.children||[]),v.return=y,v)}function u(y,v,w,S,P){return v===null||v.tag!==7?(v=Ei(w,y.mode,S,P),v.return=y,v):(v=r(v,w),v.return=y,v)}function f(y,v,w){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Bc(""+v,y.mode,w),v.return=y,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case No:return w=Aa(v.type,v.key,v.props,null,y.mode,w),w.ref=qr(y,null,v),w.return=y,w;case Hi:return v=Vc(v,y.mode,w),v.return=y,v;case Nn:var S=v._init;return f(y,S(v._payload),w)}if(cs(v)||$r(v))return v=Ei(v,y.mode,w,null),v.return=y,v;$o(y,v)}return null}function h(y,v,w,S){var P=v!==null?v.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return P!==null?null:a(y,v,""+w,S);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case No:return w.key===P?l(y,v,w,S):null;case Hi:return w.key===P?c(y,v,w,S):null;case Nn:return P=w._init,h(y,v,P(w._payload),S)}if(cs(w)||$r(w))return P!==null?null:u(y,v,w,S,null);$o(y,w)}return null}function p(y,v,w,S,P){if(typeof S=="string"&&S!==""||typeof S=="number")return y=y.get(w)||null,a(v,y,""+S,P);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case No:return y=y.get(S.key===null?w:S.key)||null,l(v,y,S,P);case Hi:return y=y.get(S.key===null?w:S.key)||null,c(v,y,S,P);case Nn:var A=S._init;return p(y,v,w,A(S._payload),P)}if(cs(S)||$r(S))return y=y.get(w)||null,u(v,y,S,P,null);$o(v,S)}return null}function g(y,v,w,S){for(var P=null,A=null,C=v,M=v=0,R=null;C!==null&&M<w.length;M++){C.index>M?(R=C,C=null):R=C.sibling;var O=h(y,C,w[M],S);if(O===null){C===null&&(C=R);break}t&&C&&O.alternate===null&&e(y,C),v=s(O,v,M),A===null?P=O:A.sibling=O,A=O,C=R}if(M===w.length)return n(y,C),oe&&hi(y,M),P;if(C===null){for(;M<w.length;M++)C=f(y,w[M],S),C!==null&&(v=s(C,v,M),A===null?P=C:A.sibling=C,A=C);return oe&&hi(y,M),P}for(C=i(y,C);M<w.length;M++)R=p(C,y,M,w[M],S),R!==null&&(t&&R.alternate!==null&&C.delete(R.key===null?M:R.key),v=s(R,v,M),A===null?P=R:A.sibling=R,A=R);return t&&C.forEach(function(U){return e(y,U)}),oe&&hi(y,M),P}function _(y,v,w,S){var P=$r(w);if(typeof P!="function")throw Error(I(150));if(w=P.call(w),w==null)throw Error(I(151));for(var A=P=null,C=v,M=v=0,R=null,O=w.next();C!==null&&!O.done;M++,O=w.next()){C.index>M?(R=C,C=null):R=C.sibling;var U=h(y,C,O.value,S);if(U===null){C===null&&(C=R);break}t&&C&&U.alternate===null&&e(y,C),v=s(U,v,M),A===null?P=U:A.sibling=U,A=U,C=R}if(O.done)return n(y,C),oe&&hi(y,M),P;if(C===null){for(;!O.done;M++,O=w.next())O=f(y,O.value,S),O!==null&&(v=s(O,v,M),A===null?P=O:A.sibling=O,A=O);return oe&&hi(y,M),P}for(C=i(y,C);!O.done;M++,O=w.next())O=p(C,y,M,O.value,S),O!==null&&(t&&O.alternate!==null&&C.delete(O.key===null?M:O.key),v=s(O,v,M),A===null?P=O:A.sibling=O,A=O);return t&&C.forEach(function(B){return e(y,B)}),oe&&hi(y,M),P}function x(y,v,w,S){if(typeof w=="object"&&w!==null&&w.type===$i&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case No:e:{for(var P=w.key,A=v;A!==null;){if(A.key===P){if(P=w.type,P===$i){if(A.tag===7){n(y,A.sibling),v=r(A,w.props.children),v.return=y,y=v;break e}}else if(A.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===Nn&&Np(P)===A.type){n(y,A.sibling),v=r(A,w.props),v.ref=qr(y,A,w),v.return=y,y=v;break e}n(y,A);break}else e(y,A);A=A.sibling}w.type===$i?(v=Ei(w.props.children,y.mode,S,w.key),v.return=y,y=v):(S=Aa(w.type,w.key,w.props,null,y.mode,S),S.ref=qr(y,v,w),S.return=y,y=S)}return o(y);case Hi:e:{for(A=w.key;v!==null;){if(v.key===A)if(v.tag===4&&v.stateNode.containerInfo===w.containerInfo&&v.stateNode.implementation===w.implementation){n(y,v.sibling),v=r(v,w.children||[]),v.return=y,y=v;break e}else{n(y,v);break}else e(y,v);v=v.sibling}v=Vc(w,y.mode,S),v.return=y,y=v}return o(y);case Nn:return A=w._init,x(y,v,A(w._payload),S)}if(cs(w))return g(y,v,w,S);if($r(w))return _(y,v,w,S);$o(y,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,v!==null&&v.tag===6?(n(y,v.sibling),v=r(v,w),v.return=y,y=v):(n(y,v),v=Bc(w,y.mode,S),v.return=y,y=v),o(y)):n(y,v)}return x}var _r=Rv(!0),Ov=Rv(!1),co={},Jt=ii(co),Vs=ii(co),js=ii(co);function vi(t){if(t===co)throw Error(I(174));return t}function Sh(t,e){switch(te(js,e),te(Vs,t),te(Jt,co),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ku(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ku(e,t)}re(Jt),te(Jt,e)}function Er(){re(Jt),re(Vs),re(js)}function kv(t){vi(js.current);var e=vi(Jt.current),n=ku(e,t.type);e!==n&&(te(Vs,t),te(Jt,n))}function Ph(t){Vs.current===t&&(re(Jt),re(Vs))}var le=ii(0);function nl(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&128)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var kc=[];function bh(){for(var t=0;t<kc.length;t++)kc[t]._workInProgressVersionPrimary=null;kc.length=0}var xa=Sn.ReactCurrentDispatcher,Nc=Sn.ReactCurrentBatchConfig,Pi=0,ue=null,we=null,Se=null,il=!1,Es=!1,Gs=0,mx=0;function Re(){throw Error(I(321))}function Ah(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Vt(t[n],e[n]))return!1;return!0}function Ch(t,e,n,i,r,s){if(Pi=s,ue=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,xa.current=t===null||t.memoizedState===null?Ex:wx,t=n(i,r),Es){s=0;do{if(Es=!1,Gs=0,25<=s)throw Error(I(301));s+=1,Se=we=null,e.updateQueue=null,xa.current=xx,t=n(i,r)}while(Es)}if(xa.current=rl,e=we!==null&&we.next!==null,Pi=0,Se=we=ue=null,il=!1,e)throw Error(I(300));return t}function Lh(){var t=Gs!==0;return Gs=0,t}function Zt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Se===null?ue.memoizedState=Se=t:Se=Se.next=t,Se}function Pt(){if(we===null){var t=ue.alternate;t=t!==null?t.memoizedState:null}else t=we.next;var e=Se===null?ue.memoizedState:Se.next;if(e!==null)Se=e,we=t;else{if(t===null)throw Error(I(310));we=t,t={memoizedState:we.memoizedState,baseState:we.baseState,baseQueue:we.baseQueue,queue:we.queue,next:null},Se===null?ue.memoizedState=Se=t:Se=Se.next=t}return Se}function Ws(t,e){return typeof e=="function"?e(t):e}function Fc(t){var e=Pt(),n=e.queue;if(n===null)throw Error(I(311));n.lastRenderedReducer=t;var i=we,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Pi&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var f={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=f,o=i):l=l.next=f,ue.lanes|=u,bi|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,Vt(i,e.memoizedState)||(Ze=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,ue.lanes|=s,bi|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Dc(t){var e=Pt(),n=e.queue;if(n===null)throw Error(I(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Vt(s,e.memoizedState)||(Ze=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function Nv(){}function Fv(t,e){var n=ue,i=Pt(),r=e(),s=!Vt(i.memoizedState,r);if(s&&(i.memoizedState=r,Ze=!0),i=i.queue,Mh(Uv.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Se!==null&&Se.memoizedState.tag&1){if(n.flags|=2048,Hs(9,zv.bind(null,n,i,r,e),void 0,null),be===null)throw Error(I(349));(Pi&30)!==0||Dv(n,e,r)}return r}function Dv(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ue.updateQueue,e===null?(e={lastEffect:null,stores:null},ue.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function zv(t,e,n,i){e.value=n,e.getSnapshot=i,Bv(e)&&Vv(t)}function Uv(t,e,n){return n(function(){Bv(e)&&Vv(t)})}function Bv(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Vt(t,n)}catch{return!0}}function Vv(t){var e=_n(t,1);e!==null&&Ut(e,t,1,-1)}function Fp(t){var e=Zt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ws,lastRenderedState:t},e.queue=t,t=t.dispatch=_x.bind(null,ue,t),[e.memoizedState,t]}function Hs(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=ue.updateQueue,e===null?(e={lastEffect:null,stores:null},ue.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function jv(){return Pt().memoizedState}function Ta(t,e,n,i){var r=Zt();ue.flags|=t,r.memoizedState=Hs(1|e,n,void 0,i===void 0?null:i)}function Fl(t,e,n,i){var r=Pt();i=i===void 0?null:i;var s=void 0;if(we!==null){var o=we.memoizedState;if(s=o.destroy,i!==null&&Ah(i,o.deps)){r.memoizedState=Hs(e,n,s,i);return}}ue.flags|=t,r.memoizedState=Hs(1|e,n,s,i)}function Dp(t,e){return Ta(8390656,8,t,e)}function Mh(t,e){return Fl(2048,8,t,e)}function Gv(t,e){return Fl(4,2,t,e)}function Wv(t,e){return Fl(4,4,t,e)}function Hv(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function $v(t,e,n){return n=n!=null?n.concat([t]):null,Fl(4,4,Hv.bind(null,e,t),n)}function Ih(){}function Xv(t,e){var n=Pt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Ah(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Yv(t,e){var n=Pt();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Ah(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function Zv(t,e,n){return(Pi&21)===0?(t.baseState&&(t.baseState=!1,Ze=!0),t.memoizedState=n):(Vt(n,e)||(n=Q0(),ue.lanes|=n,bi|=n,t.baseState=!0),e)}function vx(t,e){var n=q;q=n!==0&&4>n?n:4,t(!0);var i=Nc.transition;Nc.transition={};try{t(!1),e()}finally{q=n,Nc.transition=i}}function Kv(){return Pt().memoizedState}function yx(t,e,n){var i=Zn(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},qv(t))Qv(e,n);else if(n=Cv(t,e,n,i),n!==null){var r=Ge();Ut(n,t,i,r),Jv(n,e,i)}}function _x(t,e,n){var i=Zn(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(qv(t))Qv(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Vt(a,o)){var l=e.interleaved;l===null?(r.next=r,xh(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=Cv(t,e,r,i),n!==null&&(r=Ge(),Ut(n,t,i,r),Jv(n,e,i))}}function qv(t){var e=t.alternate;return t===ue||e!==null&&e===ue}function Qv(t,e){Es=il=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Jv(t,e,n){if((n&4194240)!==0){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,lh(t,n)}}var rl={readContext:St,useCallback:Re,useContext:Re,useEffect:Re,useImperativeHandle:Re,useInsertionEffect:Re,useLayoutEffect:Re,useMemo:Re,useReducer:Re,useRef:Re,useState:Re,useDebugValue:Re,useDeferredValue:Re,useTransition:Re,useMutableSource:Re,useSyncExternalStore:Re,useId:Re,unstable_isNewReconciler:!1},Ex={readContext:St,useCallback:function(t,e){return Zt().memoizedState=[t,e===void 0?null:e],t},useContext:St,useEffect:Dp,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Ta(4194308,4,Hv.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Ta(4194308,4,t,e)},useInsertionEffect:function(t,e){return Ta(4,2,t,e)},useMemo:function(t,e){var n=Zt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Zt();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=yx.bind(null,ue,t),[i.memoizedState,t]},useRef:function(t){var e=Zt();return t={current:t},e.memoizedState=t},useState:Fp,useDebugValue:Ih,useDeferredValue:function(t){return Zt().memoizedState=t},useTransition:function(){var t=Fp(!1),e=t[0];return t=vx.bind(null,t[1]),Zt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=ue,r=Zt();if(oe){if(n===void 0)throw Error(I(407));n=n()}else{if(n=e(),be===null)throw Error(I(349));(Pi&30)!==0||Dv(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,Dp(Uv.bind(null,i,s,t),[t]),i.flags|=2048,Hs(9,zv.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=Zt(),e=be.identifierPrefix;if(oe){var n=pn,i=dn;n=(i&~(1<<32-zt(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Gs++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=mx++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},wx={readContext:St,useCallback:Xv,useContext:St,useEffect:Mh,useImperativeHandle:$v,useInsertionEffect:Gv,useLayoutEffect:Wv,useMemo:Yv,useReducer:Fc,useRef:jv,useState:function(){return Fc(Ws)},useDebugValue:Ih,useDeferredValue:function(t){var e=Pt();return Zv(e,we.memoizedState,t)},useTransition:function(){var t=Fc(Ws)[0],e=Pt().memoizedState;return[t,e]},useMutableSource:Nv,useSyncExternalStore:Fv,useId:Kv,unstable_isNewReconciler:!1},xx={readContext:St,useCallback:Xv,useContext:St,useEffect:Mh,useImperativeHandle:$v,useInsertionEffect:Gv,useLayoutEffect:Wv,useMemo:Yv,useReducer:Dc,useRef:jv,useState:function(){return Dc(Ws)},useDebugValue:Ih,useDeferredValue:function(t){var e=Pt();return we===null?e.memoizedState=t:Zv(e,we.memoizedState,t)},useTransition:function(){var t=Dc(Ws)[0],e=Pt().memoizedState;return[t,e]},useMutableSource:Nv,useSyncExternalStore:Fv,useId:Kv,unstable_isNewReconciler:!1};function wr(t,e){try{var n="",i=e;do n+=KE(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function zc(t,e,n){return{value:t,source:null,stack:n!=null?n:null,digest:e!=null?e:null}}function rf(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Tx=typeof WeakMap=="function"?WeakMap:Map;function ey(t,e,n){n=gn(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){ol||(ol=!0,pf=i),rf(t,e)},n}function ty(t,e,n){n=gn(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){rf(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){rf(t,e),typeof i!="function"&&(Yn===null?Yn=new Set([this]):Yn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function zp(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Tx;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=Dx.bind(null,t,e,n),e.then(t,t))}function Up(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Bp(t,e,n,i,r){return(t.mode&1)===0?(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=gn(-1,1),e.tag=2,Xn(n,e,1))),n.lanes|=1),t):(t.flags|=65536,t.lanes=r,t)}var Sx=Sn.ReactCurrentOwner,Ze=!1;function Ve(t,e,n,i){e.child=t===null?Ov(e,null,n,i):_r(e,t.child,n,i)}function Vp(t,e,n,i,r){n=n.render;var s=e.ref;return fr(e,r),i=Ch(t,e,n,i,s,r),n=Lh(),t!==null&&!Ze?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,En(t,e,r)):(oe&&n&&mh(e),e.flags|=1,Ve(t,e,i,r),e.child)}function jp(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!Uh(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,ny(t,e,s,i,r)):(t=Aa(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,(t.lanes&r)===0){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Ds,n(o,i)&&t.ref===e.ref)return En(t,e,r)}return e.flags|=1,t=Kn(s,i),t.ref=e.ref,t.return=e,e.child=t}function ny(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Ds(s,i)&&t.ref===e.ref)if(Ze=!1,e.pendingProps=i=s,(t.lanes&r)!==0)(t.flags&131072)!==0&&(Ze=!0);else return e.lanes=t.lanes,En(t,e,r)}return sf(t,e,n,i,r)}function iy(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if((e.mode&1)===0)e.memoizedState={baseLanes:0,cachePool:null,transitions:null},te(nr,st),st|=n;else{if((n&1073741824)===0)return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,te(nr,st),st|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,te(nr,st),st|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,te(nr,st),st|=i;return Ve(t,e,r,n),e.child}function ry(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function sf(t,e,n,i,r){var s=Qe(n)?Ti:ze.current;return s=vr(e,s),fr(e,r),n=Ch(t,e,n,i,s,r),i=Lh(),t!==null&&!Ze?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,En(t,e,r)):(oe&&i&&mh(e),e.flags|=1,Ve(t,e,n,r),e.child)}function Gp(t,e,n,i,r){if(Qe(n)){var s=!0;Ka(e)}else s=!1;if(fr(e,r),e.stateNode===null)Sa(t,e),Iv(e,n,i),nf(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=St(c):(c=Qe(n)?Ti:ze.current,c=vr(e,c));var u=n.getDerivedStateFromProps,f=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&kp(e,o,i,c),Fn=!1;var h=e.memoizedState;o.state=h,tl(e,i,o,r),l=e.memoizedState,a!==i||h!==l||qe.current||Fn?(typeof u=="function"&&(tf(e,n,u,i),l=e.memoizedState),(a=Fn||Op(e,n,a,i,h,l,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Lv(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:It(e.type,a),o.props=c,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=St(l):(l=Qe(n)?Ti:ze.current,l=vr(e,l));var p=n.getDerivedStateFromProps;(u=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&kp(e,o,i,l),Fn=!1,h=e.memoizedState,o.state=h,tl(e,i,o,r);var g=e.memoizedState;a!==f||h!==g||qe.current||Fn?(typeof p=="function"&&(tf(e,n,p,i),g=e.memoizedState),(c=Fn||Op(e,n,c,i,h,g,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,g,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=g),o.props=i,o.state=g,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return of(t,e,n,i,s,r)}function of(t,e,n,i,r,s){ry(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&Cp(e,n,!1),En(t,e,s);i=e.stateNode,Sx.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=_r(e,t.child,null,s),e.child=_r(e,null,a,s)):Ve(t,e,a,s),e.memoizedState=i.state,r&&Cp(e,n,!0),e.child}function sy(t){var e=t.stateNode;e.pendingContext?Ap(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Ap(t,e.context,!1),Sh(t,e.containerInfo)}function Wp(t,e,n,i,r){return yr(),yh(r),e.flags|=256,Ve(t,e,n,i),e.child}var af={dehydrated:null,treeContext:null,retryLane:0};function lf(t){return{baseLanes:t,cachePool:null,transitions:null}}function oy(t,e,n){var i=e.pendingProps,r=le.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),te(le,r&1),t===null)return Ju(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((e.mode&1)===0?e.lanes=1:t.data==="$!"?e.lanes=8:e.lanes=1073741824,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},(i&1)===0&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Ul(o,i,0,null),t=Ei(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=lf(n),e.memoizedState=af,t):Rh(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return Px(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:i.children};return(o&1)===0&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=Kn(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=Kn(a,s):(s=Ei(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?lf(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=af,i}return s=t.child,t=s.sibling,i=Kn(s,{mode:"visible",children:i.children}),(e.mode&1)===0&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Rh(t,e){return e=Ul({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Xo(t,e,n,i){return i!==null&&yh(i),_r(e,t.child,null,n),t=Rh(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Px(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=zc(Error(I(422))),Xo(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=Ul({mode:"visible",children:i.children},r,0,null),s=Ei(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,(e.mode&1)!==0&&_r(e,t.child,null,o),e.child.memoizedState=lf(o),e.memoizedState=af,s);if((e.mode&1)===0)return Xo(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(I(419)),i=zc(s,i,void 0),Xo(t,e,o,i)}if(a=(o&t.childLanes)!==0,Ze||a){if(i=be,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=(r&(i.suspendedLanes|o))!==0?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,_n(t,r),Ut(i,t,r,-1))}return zh(),i=zc(Error(I(421))),Xo(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=zx.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,lt=$n(r.nextSibling),ct=e,oe=!0,kt=null,t!==null&&(_t[Et++]=dn,_t[Et++]=pn,_t[Et++]=Si,dn=t.id,pn=t.overflow,Si=e),e=Rh(e,i.children),e.flags|=4096,e)}function Hp(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),ef(t.return,e,n)}function Uc(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function ay(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Ve(t,e,i.children,n),i=le.current,(i&2)!==0)i=i&1|2,e.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Hp(t,n,e);else if(t.tag===19)Hp(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(te(le,i),(e.mode&1)===0)e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&nl(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Uc(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&nl(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Uc(e,!0,n,null,s);break;case"together":Uc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Sa(t,e){(e.mode&1)===0&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function En(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),bi|=e.lanes,(n&e.childLanes)===0)return null;if(t!==null&&e.child!==t.child)throw Error(I(153));if(e.child!==null){for(t=e.child,n=Kn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Kn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function bx(t,e,n){switch(e.tag){case 3:sy(e),yr();break;case 5:kv(e);break;case 1:Qe(e.type)&&Ka(e);break;case 4:Sh(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;te(Ja,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(te(le,le.current&1),e.flags|=128,null):(n&e.child.childLanes)!==0?oy(t,e,n):(te(le,le.current&1),t=En(t,e,n),t!==null?t.sibling:null);te(le,le.current&1);break;case 19:if(i=(n&e.childLanes)!==0,(t.flags&128)!==0){if(i)return ay(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),te(le,le.current),i)break;return null;case 22:case 23:return e.lanes=0,iy(t,e,n)}return En(t,e,n)}var ly,cf,cy,uy;ly=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};cf=function(){};cy=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,vi(Jt.current);var s=null;switch(n){case"input":r=Mu(t,r),i=Mu(t,i),s=[];break;case"select":r=fe({},r,{value:void 0}),i=fe({},i,{value:void 0}),s=[];break;case"textarea":r=Ou(t,r),i=Ou(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Ya)}Nu(n,i);var o;n=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Ms.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Ms.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ie("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};uy=function(t,e,n,i){n!==i&&(e.flags|=4)};function Qr(t,e){if(!oe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Oe(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Ax(t,e,n){var i=e.pendingProps;switch(vh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Oe(e),null;case 1:return Qe(e.type)&&Za(),Oe(e),null;case 3:return i=e.stateNode,Er(),re(qe),re(ze),bh(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Ho(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&(e.flags&256)===0||(e.flags|=1024,kt!==null&&(vf(kt),kt=null))),cf(t,e),Oe(e),null;case 5:Ph(e);var r=vi(js.current);if(n=e.type,t!==null&&e.stateNode!=null)cy(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(I(166));return Oe(e),null}if(t=vi(Jt.current),Ho(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Kt]=e,i[Bs]=s,t=(e.mode&1)!==0,n){case"dialog":ie("cancel",i),ie("close",i);break;case"iframe":case"object":case"embed":ie("load",i);break;case"video":case"audio":for(r=0;r<fs.length;r++)ie(fs[r],i);break;case"source":ie("error",i);break;case"img":case"image":case"link":ie("error",i),ie("load",i);break;case"details":ie("toggle",i);break;case"input":ep(i,s),ie("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ie("invalid",i);break;case"textarea":np(i,s),ie("invalid",i)}Nu(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Wo(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Wo(i.textContent,a,t),r=["children",""+a]):Ms.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ie("scroll",i)}switch(n){case"input":Fo(i),tp(i,s,!0);break;case"textarea":Fo(i),ip(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Ya)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=D0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Kt]=e,t[Bs]=i,ly(t,e,!1,!1),e.stateNode=t;e:{switch(o=Fu(n,i),n){case"dialog":ie("cancel",t),ie("close",t),r=i;break;case"iframe":case"object":case"embed":ie("load",t),r=i;break;case"video":case"audio":for(r=0;r<fs.length;r++)ie(fs[r],t);r=i;break;case"source":ie("error",t),r=i;break;case"img":case"image":case"link":ie("error",t),ie("load",t),r=i;break;case"details":ie("toggle",t),r=i;break;case"input":ep(t,i),r=Mu(t,i),ie("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=fe({},i,{value:void 0}),ie("invalid",t);break;case"textarea":np(t,i),r=Ou(t,i),ie("invalid",t);break;default:r=i}Nu(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?B0(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&z0(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Is(t,l):typeof l=="number"&&Is(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ms.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ie("scroll",t):l!=null&&nh(t,s,l,o))}switch(n){case"input":Fo(t),tp(t,i,!1);break;case"textarea":Fo(t),ip(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Qn(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?ar(t,!!i.multiple,s,!1):i.defaultValue!=null&&ar(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Ya)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Oe(e),null;case 6:if(t&&e.stateNode!=null)uy(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(I(166));if(n=vi(js.current),vi(Jt.current),Ho(e)){if(i=e.stateNode,n=e.memoizedProps,i[Kt]=e,(s=i.nodeValue!==n)&&(t=ct,t!==null))switch(t.tag){case 3:Wo(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Wo(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Kt]=e,e.stateNode=i}return Oe(e),null;case 13:if(re(le),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(oe&&lt!==null&&(e.mode&1)!==0&&(e.flags&128)===0)Av(),yr(),e.flags|=98560,s=!1;else if(s=Ho(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(I(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(I(317));s[Kt]=e}else yr(),(e.flags&128)===0&&(e.memoizedState=null),e.flags|=4;Oe(e),s=!1}else kt!==null&&(vf(kt),kt=null),s=!0;if(!s)return e.flags&65536?e:null}return(e.flags&128)!==0?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,(e.mode&1)!==0&&(t===null||(le.current&1)!==0?xe===0&&(xe=3):zh())),e.updateQueue!==null&&(e.flags|=4),Oe(e),null);case 4:return Er(),cf(t,e),t===null&&zs(e.stateNode.containerInfo),Oe(e),null;case 10:return wh(e.type._context),Oe(e),null;case 17:return Qe(e.type)&&Za(),Oe(e),null;case 19:if(re(le),s=e.memoizedState,s===null)return Oe(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Qr(s,!1);else{if(xe!==0||t!==null&&(t.flags&128)!==0)for(t=e.child;t!==null;){if(o=nl(t),o!==null){for(e.flags|=128,Qr(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return te(le,le.current&1|2),e.child}t=t.sibling}s.tail!==null&&pe()>xr&&(e.flags|=128,i=!0,Qr(s,!1),e.lanes=4194304)}else{if(!i)if(t=nl(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Qr(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!oe)return Oe(e),null}else 2*pe()-s.renderingStartTime>xr&&n!==1073741824&&(e.flags|=128,i=!0,Qr(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=pe(),e.sibling=null,n=le.current,te(le,i?n&1|2:n&1),e):(Oe(e),null);case 22:case 23:return Dh(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&(e.mode&1)!==0?(st&1073741824)!==0&&(Oe(e),e.subtreeFlags&6&&(e.flags|=8192)):Oe(e),null;case 24:return null;case 25:return null}throw Error(I(156,e.tag))}function Cx(t,e){switch(vh(e),e.tag){case 1:return Qe(e.type)&&Za(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Er(),re(qe),re(ze),bh(),t=e.flags,(t&65536)!==0&&(t&128)===0?(e.flags=t&-65537|128,e):null;case 5:return Ph(e),null;case 13:if(re(le),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(I(340));yr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return re(le),null;case 4:return Er(),null;case 10:return wh(e.type._context),null;case 22:case 23:return Dh(),null;case 24:return null;default:return null}}var Yo=!1,Fe=!1,Lx=typeof WeakSet=="function"?WeakSet:Set,D=null;function tr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){de(t,e,i)}else n.current=null}function uf(t,e,n){try{n()}catch(i){de(t,e,i)}}var $p=!1;function Mx(t,e){if($u=Ha,t=pv(),gh(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,f=t,h=null;t:for(;;){for(var p;f!==n||r!==0&&f.nodeType!==3||(a=o+r),f!==s||i!==0&&f.nodeType!==3||(l=o+i),f.nodeType===3&&(o+=f.nodeValue.length),(p=f.firstChild)!==null;)h=f,f=p;for(;;){if(f===t)break t;if(h===n&&++c===r&&(a=o),h===s&&++u===i&&(l=o),(p=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Xu={focusedElem:t,selectionRange:n},Ha=!1,D=e;D!==null;)if(e=D,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,D=t;else for(;D!==null;){e=D;try{var g=e.alternate;if((e.flags&1024)!==0)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var _=g.memoizedProps,x=g.memoizedState,y=e.stateNode,v=y.getSnapshotBeforeUpdate(e.elementType===e.type?_:It(e.type,_),x);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(I(163))}}catch(S){de(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,D=t;break}D=e.return}return g=$p,$p=!1,g}function ws(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&uf(e,n,s)}r=r.next}while(r!==i)}}function Dl(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function ff(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function fy(t){var e=t.alternate;e!==null&&(t.alternate=null,fy(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Kt],delete e[Bs],delete e[Ku],delete e[hx],delete e[dx])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function hy(t){return t.tag===5||t.tag===3||t.tag===4}function Xp(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||hy(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function hf(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ya));else if(i!==4&&(t=t.child,t!==null))for(hf(t,e,n),t=t.sibling;t!==null;)hf(t,e,n),t=t.sibling}function df(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(df(t,e,n),t=t.sibling;t!==null;)df(t,e,n),t=t.sibling}var Le=null,Ot=!1;function Ln(t,e,n){for(n=n.child;n!==null;)dy(t,e,n),n=n.sibling}function dy(t,e,n){if(Qt&&typeof Qt.onCommitFiberUnmount=="function")try{Qt.onCommitFiberUnmount(Ll,n)}catch{}switch(n.tag){case 5:Fe||tr(n,e);case 6:var i=Le,r=Ot;Le=null,Ln(t,e,n),Le=i,Ot=r,Le!==null&&(Ot?(t=Le,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Le.removeChild(n.stateNode));break;case 18:Le!==null&&(Ot?(t=Le,n=n.stateNode,t.nodeType===8?Rc(t.parentNode,n):t.nodeType===1&&Rc(t,n),Ns(t)):Rc(Le,n.stateNode));break;case 4:i=Le,r=Ot,Le=n.stateNode.containerInfo,Ot=!0,Ln(t,e,n),Le=i,Ot=r;break;case 0:case 11:case 14:case 15:if(!Fe&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&((s&2)!==0||(s&4)!==0)&&uf(n,e,o),r=r.next}while(r!==i)}Ln(t,e,n);break;case 1:if(!Fe&&(tr(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){de(n,e,a)}Ln(t,e,n);break;case 21:Ln(t,e,n);break;case 22:n.mode&1?(Fe=(i=Fe)||n.memoizedState!==null,Ln(t,e,n),Fe=i):Ln(t,e,n);break;default:Ln(t,e,n)}}function Yp(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Lx),e.forEach(function(i){var r=Ux.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Mt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Le=a.stateNode,Ot=!1;break e;case 3:Le=a.stateNode.containerInfo,Ot=!0;break e;case 4:Le=a.stateNode.containerInfo,Ot=!0;break e}a=a.return}if(Le===null)throw Error(I(160));dy(s,o,r),Le=null,Ot=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){de(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)py(e,t),e=e.sibling}function py(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Mt(e,t),$t(t),i&4){try{ws(3,t,t.return),Dl(3,t)}catch(_){de(t,t.return,_)}try{ws(5,t,t.return)}catch(_){de(t,t.return,_)}}break;case 1:Mt(e,t),$t(t),i&512&&n!==null&&tr(n,n.return);break;case 5:if(Mt(e,t),$t(t),i&512&&n!==null&&tr(n,n.return),t.flags&32){var r=t.stateNode;try{Is(r,"")}catch(_){de(t,t.return,_)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&N0(r,s),Fu(a,o);var c=Fu(a,s);for(o=0;o<l.length;o+=2){var u=l[o],f=l[o+1];u==="style"?B0(r,f):u==="dangerouslySetInnerHTML"?z0(r,f):u==="children"?Is(r,f):nh(r,u,f,c)}switch(a){case"input":Iu(r,s);break;case"textarea":F0(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?ar(r,!!s.multiple,p,!1):h!==!!s.multiple&&(s.defaultValue!=null?ar(r,!!s.multiple,s.defaultValue,!0):ar(r,!!s.multiple,s.multiple?[]:"",!1))}r[Bs]=s}catch(_){de(t,t.return,_)}}break;case 6:if(Mt(e,t),$t(t),i&4){if(t.stateNode===null)throw Error(I(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(_){de(t,t.return,_)}}break;case 3:if(Mt(e,t),$t(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Ns(e.containerInfo)}catch(_){de(t,t.return,_)}break;case 4:Mt(e,t),$t(t);break;case 13:Mt(e,t),$t(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(Nh=pe())),i&4&&Yp(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Fe=(c=Fe)||u,Mt(e,t),Fe=c):Mt(e,t),$t(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&(t.mode&1)!==0)for(D=t,u=t.child;u!==null;){for(f=D=u;D!==null;){switch(h=D,p=h.child,h.tag){case 0:case 11:case 14:case 15:ws(4,h,h.return);break;case 1:tr(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(_){de(i,n,_)}}break;case 5:tr(h,h.return);break;case 22:if(h.memoizedState!==null){Kp(f);continue}}p!==null?(p.return=h,D=p):Kp(f)}u=u.sibling}e:for(u=null,f=t;;){if(f.tag===5){if(u===null){u=f;try{r=f.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=U0("display",o))}catch(_){de(t,t.return,_)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(_){de(t,t.return,_)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Mt(e,t),$t(t),i&4&&Yp(t);break;case 21:break;default:Mt(e,t),$t(t)}}function $t(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(hy(n)){var i=n;break e}n=n.return}throw Error(I(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Is(r,""),i.flags&=-33);var s=Xp(t);df(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Xp(t);hf(t,a,o);break;default:throw Error(I(161))}}catch(l){de(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Ix(t,e,n){D=t,gy(t)}function gy(t,e,n){for(var i=(t.mode&1)!==0;D!==null;){var r=D,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||Yo;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||Fe;a=Yo;var c=Fe;if(Yo=o,(Fe=l)&&!c)for(D=r;D!==null;)o=D,l=o.child,o.tag===22&&o.memoizedState!==null?qp(r):l!==null?(l.return=o,D=l):qp(r);for(;s!==null;)D=s,gy(s),s=s.sibling;D=r,Yo=a,Fe=c}Zp(t)}else(r.subtreeFlags&8772)!==0&&s!==null?(s.return=r,D=s):Zp(t)}}function Zp(t){for(;D!==null;){var e=D;if((e.flags&8772)!==0){var n=e.alternate;try{if((e.flags&8772)!==0)switch(e.tag){case 0:case 11:case 15:Fe||Dl(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Fe)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:It(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Rp(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Rp(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&Ns(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(I(163))}Fe||e.flags&512&&ff(e)}catch(h){de(e,e.return,h)}}if(e===t){D=null;break}if(n=e.sibling,n!==null){n.return=e.return,D=n;break}D=e.return}}function Kp(t){for(;D!==null;){var e=D;if(e===t){D=null;break}var n=e.sibling;if(n!==null){n.return=e.return,D=n;break}D=e.return}}function qp(t){for(;D!==null;){var e=D;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Dl(4,e)}catch(l){de(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){de(e,r,l)}}var s=e.return;try{ff(e)}catch(l){de(e,s,l)}break;case 5:var o=e.return;try{ff(e)}catch(l){de(e,o,l)}}}catch(l){de(e,e.return,l)}if(e===t){D=null;break}var a=e.sibling;if(a!==null){a.return=e.return,D=a;break}D=e.return}}var Rx=Math.ceil,sl=Sn.ReactCurrentDispatcher,Oh=Sn.ReactCurrentOwner,xt=Sn.ReactCurrentBatchConfig,K=0,be=null,ye=null,Me=0,st=0,nr=ii(0),xe=0,$s=null,bi=0,zl=0,kh=0,xs=null,Ye=null,Nh=0,xr=1/0,un=null,ol=!1,pf=null,Yn=null,Zo=!1,Bn=null,al=0,Ts=0,gf=null,Pa=-1,ba=0;function Ge(){return(K&6)!==0?pe():Pa!==-1?Pa:Pa=pe()}function Zn(t){return(t.mode&1)===0?1:(K&2)!==0&&Me!==0?Me&-Me:gx.transition!==null?(ba===0&&(ba=Q0()),ba):(t=q,t!==0||(t=window.event,t=t===void 0?16:sv(t.type)),t)}function Ut(t,e,n,i){if(50<Ts)throw Ts=0,gf=null,Error(I(185));oo(t,n,i),((K&2)===0||t!==be)&&(t===be&&((K&2)===0&&(zl|=n),xe===4&&zn(t,Me)),Je(t,i),n===1&&K===0&&(e.mode&1)===0&&(xr=pe()+500,kl&&ri()))}function Je(t,e){var n=t.callbackNode;gw(t,e);var i=Wa(t,t===be?Me:0);if(i===0)n!==null&&op(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&op(n),e===1)t.tag===0?px(Qp.bind(null,t)):Sv(Qp.bind(null,t)),ux(function(){(K&6)===0&&ri()}),n=null;else{switch(J0(i)){case 1:n=ah;break;case 4:n=K0;break;case 16:n=Ga;break;case 536870912:n=q0;break;default:n=Ga}n=Ty(n,my.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function my(t,e){if(Pa=-1,ba=0,(K&6)!==0)throw Error(I(327));var n=t.callbackNode;if(hr()&&t.callbackNode!==n)return null;var i=Wa(t,t===be?Me:0);if(i===0)return null;if((i&30)!==0||(i&t.expiredLanes)!==0||e)e=ll(t,i);else{e=i;var r=K;K|=2;var s=yy();(be!==t||Me!==e)&&(un=null,xr=pe()+500,_i(t,e));do try{Nx();break}catch(a){vy(t,a)}while(1);Eh(),sl.current=s,K=r,ye!==null?e=0:(be=null,Me=0,e=xe)}if(e!==0){if(e===2&&(r=Vu(t),r!==0&&(i=r,e=mf(t,r))),e===1)throw n=$s,_i(t,0),zn(t,i),Je(t,pe()),n;if(e===6)zn(t,i);else{if(r=t.current.alternate,(i&30)===0&&!Ox(r)&&(e=ll(t,i),e===2&&(s=Vu(t),s!==0&&(i=s,e=mf(t,s))),e===1))throw n=$s,_i(t,0),zn(t,i),Je(t,pe()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(I(345));case 2:di(t,Ye,un);break;case 3:if(zn(t,i),(i&130023424)===i&&(e=Nh+500-pe(),10<e)){if(Wa(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Ge(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Zu(di.bind(null,t,Ye,un),e);break}di(t,Ye,un);break;case 4:if(zn(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-zt(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=pe()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Rx(i/1960))-i,10<i){t.timeoutHandle=Zu(di.bind(null,t,Ye,un),i);break}di(t,Ye,un);break;case 5:di(t,Ye,un);break;default:throw Error(I(329))}}}return Je(t,pe()),t.callbackNode===n?my.bind(null,t):null}function mf(t,e){var n=xs;return t.current.memoizedState.isDehydrated&&(_i(t,e).flags|=256),t=ll(t,e),t!==2&&(e=Ye,Ye=n,e!==null&&vf(e)),t}function vf(t){Ye===null?Ye=t:Ye.push.apply(Ye,t)}function Ox(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Vt(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function zn(t,e){for(e&=~kh,e&=~zl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-zt(e),i=1<<n;t[n]=-1,e&=~i}}function Qp(t){if((K&6)!==0)throw Error(I(327));hr();var e=Wa(t,0);if((e&1)===0)return Je(t,pe()),null;var n=ll(t,e);if(t.tag!==0&&n===2){var i=Vu(t);i!==0&&(e=i,n=mf(t,i))}if(n===1)throw n=$s,_i(t,0),zn(t,e),Je(t,pe()),n;if(n===6)throw Error(I(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,di(t,Ye,un),Je(t,pe()),null}function Fh(t,e){var n=K;K|=1;try{return t(e)}finally{K=n,K===0&&(xr=pe()+500,kl&&ri())}}function Ai(t){Bn!==null&&Bn.tag===0&&(K&6)===0&&hr();var e=K;K|=1;var n=xt.transition,i=q;try{if(xt.transition=null,q=1,t)return t()}finally{q=i,xt.transition=n,K=e,(K&6)===0&&ri()}}function Dh(){st=nr.current,re(nr)}function _i(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,cx(n)),ye!==null)for(n=ye.return;n!==null;){var i=n;switch(vh(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Za();break;case 3:Er(),re(qe),re(ze),bh();break;case 5:Ph(i);break;case 4:Er();break;case 13:re(le);break;case 19:re(le);break;case 10:wh(i.type._context);break;case 22:case 23:Dh()}n=n.return}if(be=t,ye=t=Kn(t.current,null),Me=st=e,xe=0,$s=null,kh=zl=bi=0,Ye=xs=null,mi!==null){for(e=0;e<mi.length;e++)if(n=mi[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}mi=null}return t}function vy(t,e){do{var n=ye;try{if(Eh(),xa.current=rl,il){for(var i=ue.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}il=!1}if(Pi=0,Se=we=ue=null,Es=!1,Gs=0,Oh.current=null,n===null||n.return===null){xe=1,$s=e,ye=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Me,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,f=u.tag;if((u.mode&1)===0&&(f===0||f===11||f===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=Up(o);if(p!==null){p.flags&=-257,Bp(p,o,a,s,e),p.mode&1&&zp(s,c,e),e=p,l=c;var g=e.updateQueue;if(g===null){var _=new Set;_.add(l),e.updateQueue=_}else g.add(l);break e}else{if((e&1)===0){zp(s,c,e),zh();break e}l=Error(I(426))}}else if(oe&&a.mode&1){var x=Up(o);if(x!==null){(x.flags&65536)===0&&(x.flags|=256),Bp(x,o,a,s,e),yh(wr(l,a));break e}}s=l=wr(l,a),xe!==4&&(xe=2),xs===null?xs=[s]:xs.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=ey(s,l,e);Ip(s,y);break e;case 1:a=l;var v=s.type,w=s.stateNode;if((s.flags&128)===0&&(typeof v.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Yn===null||!Yn.has(w)))){s.flags|=65536,e&=-e,s.lanes|=e;var S=ty(s,a,e);Ip(s,S);break e}}s=s.return}while(s!==null)}Ey(n)}catch(P){e=P,ye===n&&n!==null&&(ye=n=n.return);continue}break}while(1)}function yy(){var t=sl.current;return sl.current=rl,t===null?rl:t}function zh(){(xe===0||xe===3||xe===2)&&(xe=4),be===null||(bi&268435455)===0&&(zl&268435455)===0||zn(be,Me)}function ll(t,e){var n=K;K|=2;var i=yy();(be!==t||Me!==e)&&(un=null,_i(t,e));do try{kx();break}catch(r){vy(t,r)}while(1);if(Eh(),K=n,sl.current=i,ye!==null)throw Error(I(261));return be=null,Me=0,xe}function kx(){for(;ye!==null;)_y(ye)}function Nx(){for(;ye!==null&&!ow();)_y(ye)}function _y(t){var e=xy(t.alternate,t,st);t.memoizedProps=t.pendingProps,e===null?Ey(t):ye=e,Oh.current=null}function Ey(t){var e=t;do{var n=e.alternate;if(t=e.return,(e.flags&32768)===0){if(n=Ax(n,e,st),n!==null){ye=n;return}}else{if(n=Cx(n,e),n!==null){n.flags&=32767,ye=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{xe=6,ye=null;return}}if(e=e.sibling,e!==null){ye=e;return}ye=e=t}while(e!==null);xe===0&&(xe=5)}function di(t,e,n){var i=q,r=xt.transition;try{xt.transition=null,q=1,Fx(t,e,n,i)}finally{xt.transition=r,q=i}return null}function Fx(t,e,n,i){do hr();while(Bn!==null);if((K&6)!==0)throw Error(I(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(I(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(mw(t,s),t===be&&(ye=be=null,Me=0),(n.subtreeFlags&2064)===0&&(n.flags&2064)===0||Zo||(Zo=!0,Ty(Ga,function(){return hr(),null})),s=(n.flags&15990)!==0,(n.subtreeFlags&15990)!==0||s){s=xt.transition,xt.transition=null;var o=q;q=1;var a=K;K|=4,Oh.current=null,Mx(t,n),py(n,t),nx(Xu),Ha=!!$u,Xu=$u=null,t.current=n,Ix(n),aw(),K=a,q=o,xt.transition=s}else t.current=n;if(Zo&&(Zo=!1,Bn=t,al=r),s=t.pendingLanes,s===0&&(Yn=null),uw(n.stateNode),Je(t,pe()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(ol)throw ol=!1,t=pf,pf=null,t;return(al&1)!==0&&t.tag!==0&&hr(),s=t.pendingLanes,(s&1)!==0?t===gf?Ts++:(Ts=0,gf=t):Ts=0,ri(),null}function hr(){if(Bn!==null){var t=J0(al),e=xt.transition,n=q;try{if(xt.transition=null,q=16>t?16:t,Bn===null)var i=!1;else{if(t=Bn,Bn=null,al=0,(K&6)!==0)throw Error(I(331));var r=K;for(K|=4,D=t.current;D!==null;){var s=D,o=s.child;if((D.flags&16)!==0){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(D=c;D!==null;){var u=D;switch(u.tag){case 0:case 11:case 15:ws(8,u,s)}var f=u.child;if(f!==null)f.return=u,D=f;else for(;D!==null;){u=D;var h=u.sibling,p=u.return;if(fy(u),u===c){D=null;break}if(h!==null){h.return=p,D=h;break}D=p}}}var g=s.alternate;if(g!==null){var _=g.child;if(_!==null){g.child=null;do{var x=_.sibling;_.sibling=null,_=x}while(_!==null)}}D=s}}if((s.subtreeFlags&2064)!==0&&o!==null)o.return=s,D=o;else e:for(;D!==null;){if(s=D,(s.flags&2048)!==0)switch(s.tag){case 0:case 11:case 15:ws(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,D=y;break e}D=s.return}}var v=t.current;for(D=v;D!==null;){o=D;var w=o.child;if((o.subtreeFlags&2064)!==0&&w!==null)w.return=o,D=w;else e:for(o=v;D!==null;){if(a=D,(a.flags&2048)!==0)try{switch(a.tag){case 0:case 11:case 15:Dl(9,a)}}catch(P){de(a,a.return,P)}if(a===o){D=null;break e}var S=a.sibling;if(S!==null){S.return=a.return,D=S;break e}D=a.return}}if(K=r,ri(),Qt&&typeof Qt.onPostCommitFiberRoot=="function")try{Qt.onPostCommitFiberRoot(Ll,t)}catch{}i=!0}return i}finally{q=n,xt.transition=e}}return!1}function Jp(t,e,n){e=wr(n,e),e=ey(t,e,1),t=Xn(t,e,1),e=Ge(),t!==null&&(oo(t,1,e),Je(t,e))}function de(t,e,n){if(t.tag===3)Jp(t,t,n);else for(;e!==null;){if(e.tag===3){Jp(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Yn===null||!Yn.has(i))){t=wr(n,t),t=ty(e,t,1),e=Xn(e,t,1),t=Ge(),e!==null&&(oo(e,1,t),Je(e,t));break}}e=e.return}}function Dx(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Ge(),t.pingedLanes|=t.suspendedLanes&n,be===t&&(Me&n)===n&&(xe===4||xe===3&&(Me&130023424)===Me&&500>pe()-Nh?_i(t,0):kh|=n),Je(t,e)}function wy(t,e){e===0&&((t.mode&1)===0?e=1:(e=Uo,Uo<<=1,(Uo&130023424)===0&&(Uo=4194304)));var n=Ge();t=_n(t,e),t!==null&&(oo(t,e,n),Je(t,n))}function zx(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),wy(t,n)}function Ux(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(I(314))}i!==null&&i.delete(e),wy(t,n)}var xy;xy=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||qe.current)Ze=!0;else{if((t.lanes&n)===0&&(e.flags&128)===0)return Ze=!1,bx(t,e,n);Ze=(t.flags&131072)!==0}else Ze=!1,oe&&(e.flags&1048576)!==0&&Pv(e,Qa,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Sa(t,e),t=e.pendingProps;var r=vr(e,ze.current);fr(e,n),r=Ch(null,e,i,t,r,n);var s=Lh();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qe(i)?(s=!0,Ka(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Th(e),r.updater=Nl,e.stateNode=r,r._reactInternals=e,nf(e,i,t,n),e=of(null,e,i,!0,s,n)):(e.tag=0,oe&&s&&mh(e),Ve(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Sa(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=Vx(i),t=It(i,t),r){case 0:e=sf(null,e,i,t,n);break e;case 1:e=Gp(null,e,i,t,n);break e;case 11:e=Vp(null,e,i,t,n);break e;case 14:e=jp(null,e,i,It(i.type,t),n);break e}throw Error(I(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:It(i,r),sf(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:It(i,r),Gp(t,e,i,r,n);case 3:e:{if(sy(e),t===null)throw Error(I(387));i=e.pendingProps,s=e.memoizedState,r=s.element,Lv(t,e),tl(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=wr(Error(I(423)),e),e=Wp(t,e,i,n,r);break e}else if(i!==r){r=wr(Error(I(424)),e),e=Wp(t,e,i,n,r);break e}else for(lt=$n(e.stateNode.containerInfo.firstChild),ct=e,oe=!0,kt=null,n=Ov(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(yr(),i===r){e=En(t,e,n);break e}Ve(t,e,i,n)}e=e.child}return e;case 5:return kv(e),t===null&&Ju(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Yu(i,r)?o=null:s!==null&&Yu(i,s)&&(e.flags|=32),ry(t,e),Ve(t,e,o,n),e.child;case 6:return t===null&&Ju(e),null;case 13:return oy(t,e,n);case 4:return Sh(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=_r(e,null,i,n):Ve(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:It(i,r),Vp(t,e,i,r,n);case 7:return Ve(t,e,e.pendingProps,n),e.child;case 8:return Ve(t,e,e.pendingProps.children,n),e.child;case 12:return Ve(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,te(Ja,i._currentValue),i._currentValue=o,s!==null)if(Vt(s.value,o)){if(s.children===r.children&&!qe.current){e=En(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=gn(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),ef(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(I(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),ef(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ve(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,fr(e,n),r=St(r),i=i(r),e.flags|=1,Ve(t,e,i,n),e.child;case 14:return i=e.type,r=It(i,e.pendingProps),r=It(i.type,r),jp(t,e,i,r,n);case 15:return ny(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:It(i,r),Sa(t,e),e.tag=1,Qe(i)?(t=!0,Ka(e)):t=!1,fr(e,n),Iv(e,i,r),nf(e,i,r,n),of(null,e,i,!0,t,n);case 19:return ay(t,e,n);case 22:return iy(t,e,n)}throw Error(I(156,e.tag))};function Ty(t,e){return Z0(t,e)}function Bx(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wt(t,e,n,i){return new Bx(t,e,n,i)}function Uh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Vx(t){if(typeof t=="function")return Uh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===rh)return 11;if(t===sh)return 14}return 2}function Kn(t,e){var n=t.alternate;return n===null?(n=wt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Aa(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")Uh(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case $i:return Ei(n.children,r,s,e);case ih:o=8,r|=8;break;case bu:return t=wt(12,n,e,r|2),t.elementType=bu,t.lanes=s,t;case Au:return t=wt(13,n,e,r),t.elementType=Au,t.lanes=s,t;case Cu:return t=wt(19,n,e,r),t.elementType=Cu,t.lanes=s,t;case R0:return Ul(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case M0:o=10;break e;case I0:o=9;break e;case rh:o=11;break e;case sh:o=14;break e;case Nn:o=16,i=null;break e}throw Error(I(130,t==null?t:typeof t,""))}return e=wt(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function Ei(t,e,n,i){return t=wt(7,t,i,e),t.lanes=n,t}function Ul(t,e,n,i){return t=wt(22,t,i,e),t.elementType=R0,t.lanes=n,t.stateNode={isHidden:!1},t}function Bc(t,e,n){return t=wt(6,t,null,e),t.lanes=n,t}function Vc(t,e,n){return e=wt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function jx(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wc(0),this.expirationTimes=wc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wc(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Bh(t,e,n,i,r,s,o,a,l){return t=new jx(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=wt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Th(s),t}function Gx(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Hi,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function Sy(t){if(!t)return Jn;t=t._reactInternals;e:{if(Ii(t)!==t||t.tag!==1)throw Error(I(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qe(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(I(171))}if(t.tag===1){var n=t.type;if(Qe(n))return Tv(t,n,e)}return e}function Py(t,e,n,i,r,s,o,a,l){return t=Bh(n,i,!0,t,r,s,o,a,l),t.context=Sy(null),n=t.current,i=Ge(),r=Zn(n),s=gn(i,r),s.callback=e!=null?e:null,Xn(n,s,r),t.current.lanes=r,oo(t,r,i),Je(t,i),t}function Bl(t,e,n,i){var r=e.current,s=Ge(),o=Zn(r);return n=Sy(n),e.context===null?e.context=n:e.pendingContext=n,e=gn(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Xn(r,e,o),t!==null&&(Ut(t,r,o,s),wa(t,r,o)),o}function cl(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function eg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Vh(t,e){eg(t,e),(t=t.alternate)&&eg(t,e)}function Wx(){return null}var by=typeof reportError=="function"?reportError:function(t){console.error(t)};function jh(t){this._internalRoot=t}Vl.prototype.render=jh.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(I(409));Bl(t,e,null,null)};Vl.prototype.unmount=jh.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ai(function(){Bl(null,t,null,null)}),e[yn]=null}};function Vl(t){this._internalRoot=t}Vl.prototype.unstable_scheduleHydration=function(t){if(t){var e=nv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Dn.length&&e!==0&&e<Dn[n].priority;n++);Dn.splice(n,0,t),n===0&&rv(t)}};function Gh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function jl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function tg(){}function Hx(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=cl(o);s.call(c)}}var o=Py(e,i,t,0,null,!1,!1,"",tg);return t._reactRootContainer=o,t[yn]=o.current,zs(t.nodeType===8?t.parentNode:t),Ai(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var c=cl(l);a.call(c)}}var l=Bh(t,0,!1,null,null,!1,!1,"",tg);return t._reactRootContainer=l,t[yn]=l.current,zs(t.nodeType===8?t.parentNode:t),Ai(function(){Bl(e,l,n,i)}),l}function Gl(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=cl(o);a.call(l)}}Bl(e,o,t,r)}else o=Hx(n,e,t,r,i);return cl(o)}ev=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=us(e.pendingLanes);n!==0&&(lh(e,n|1),Je(e,pe()),(K&6)===0&&(xr=pe()+500,ri()))}break;case 13:Ai(function(){var i=_n(t,1);if(i!==null){var r=Ge();Ut(i,t,1,r)}}),Vh(t,1)}};ch=function(t){if(t.tag===13){var e=_n(t,134217728);if(e!==null){var n=Ge();Ut(e,t,134217728,n)}Vh(t,134217728)}};tv=function(t){if(t.tag===13){var e=Zn(t),n=_n(t,e);if(n!==null){var i=Ge();Ut(n,t,e,i)}Vh(t,e)}};nv=function(){return q};iv=function(t,e){var n=q;try{return q=t,e()}finally{q=n}};zu=function(t,e,n){switch(e){case"input":if(Iu(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=Ol(i);if(!r)throw Error(I(90));k0(i),Iu(i,r)}}}break;case"textarea":F0(t,n);break;case"select":e=n.value,e!=null&&ar(t,!!n.multiple,e,!1)}};G0=Fh;W0=Ai;var $x={usingClientEntryPoint:!1,Events:[lo,Ki,Ol,V0,j0,Fh]},Jr={findFiberByHostInstance:gi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Xx={bundleType:Jr.bundleType,version:Jr.version,rendererPackageName:Jr.rendererPackageName,rendererConfig:Jr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Sn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=X0(t),t===null?null:t.stateNode},findFiberByHostInstance:Jr.findFiberByHostInstance||Wx,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var Ko=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ko.isDisabled&&Ko.supportsFiber)try{Ll=Ko.inject(Xx),Qt=Ko}catch{}}dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$x;dt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Gh(e))throw Error(I(200));return Gx(t,e,null,n)};dt.createRoot=function(t,e){if(!Gh(t))throw Error(I(299));var n=!1,i="",r=by;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Bh(t,1,!1,null,null,n,!1,i,r),t[yn]=e.current,zs(t.nodeType===8?t.parentNode:t),new jh(e)};dt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(I(188)):(t=Object.keys(t).join(","),Error(I(268,t)));return t=X0(e),t=t===null?null:t.stateNode,t};dt.flushSync=function(t){return Ai(t)};dt.hydrate=function(t,e,n){if(!jl(e))throw Error(I(200));return Gl(null,t,e,!0,n)};dt.hydrateRoot=function(t,e,n){if(!Gh(t))throw Error(I(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=by;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Py(e,null,t,1,n!=null?n:null,r,!1,s,o),t[yn]=e.current,zs(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Vl(e)};dt.render=function(t,e,n){if(!jl(e))throw Error(I(200));return Gl(null,t,e,!1,n)};dt.unmountComponentAtNode=function(t){if(!jl(t))throw Error(I(40));return t._reactRootContainer?(Ai(function(){Gl(null,null,t,!1,function(){t._reactRootContainer=null,t[yn]=null})}),!0):!1};dt.unstable_batchedUpdates=Fh;dt.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!jl(n))throw Error(I(200));if(t==null||t._reactInternals===void 0)throw Error(I(38));return Gl(t,e,n,!1,i)};dt.version="18.2.0-next-9e3b772b8-20220608";function Ay(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Ay)}catch(t){console.error(t)}}Ay(),P0.exports=dt;var ng=P0.exports;Su.createRoot=ng.createRoot,Su.hydrateRoot=ng.hydrateRoot;function ul(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Wh=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),ig=typeof process!="undefined"&&process.version&&/v([0-9]*)/.exec(process.version);ig&&parseFloat(ig[1]);const Yx="3.2.4";function wn(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const yf=typeof process!="object"||String(process)!=="[object process]"||process.browser,Zx=typeof window!="undefined"&&typeof window.orientation!="undefined",rg=typeof process!="undefined"&&process.version&&/v([0-9]*)/.exec(process.version);rg&&parseFloat(rg[1]);function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class Kx{constructor(e,n){d(this,"name",void 0),d(this,"workerThread",void 0),d(this,"isRunning",!0),d(this,"result",void 0),d(this,"_resolve",()=>{}),d(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){wn(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){wn(this.isRunning),this.isRunning=!1,this._reject(e)}}class jc{}const Gc=new Map;function qx(t){wn(t.source&&!t.url||!t.source&&t.url);let e=Gc.get(t.source||t.url);return e||(t.url&&(e=Qx(t.url),Gc.set(t.url,e)),t.source&&(e=Cy(t.source),Gc.set(t.source,e))),wn(e),e}function Qx(t){if(!t.startsWith("http"))return t;const e=Jx(t);return Cy(e)}function Cy(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Jx(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function Ly(t,e=!0,n){const i=n||new Set;if(t){if(sg(t))i.add(t);else if(sg(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)Ly(t[r],e,i)}}return n===void 0?Array.from(i):[]}function sg(t){return t?t instanceof ArrayBuffer||typeof MessagePort!="undefined"&&t instanceof MessagePort||typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&t instanceof OffscreenCanvas:!1}const Wc=()=>{};class _f{static isSupported(){return typeof Worker!="undefined"&&yf||typeof jc!==void 0}constructor(e){d(this,"name",void 0),d(this,"source",void 0),d(this,"url",void 0),d(this,"terminated",!1),d(this,"worker",void 0),d(this,"onMessage",void 0),d(this,"onError",void 0),d(this,"_loadableURL","");const{name:n,source:i,url:r}=e;wn(i||r),this.name=n,this.source=i,this.url=r,this.onMessage=Wc,this.onError=s=>console.log(s),this.worker=yf?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Wc,this.onError=Wc,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,n){n=n||Ly(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=qx({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new jc(i,{eval:!1})}else if(this.source)e=new jc(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class eT{static isSupported(){return _f.isSupported()}constructor(e){d(this,"name","unnamed"),d(this,"source",void 0),d(this,"url",void 0),d(this,"maxConcurrency",1),d(this,"maxMobileConcurrency",1),d(this,"onDebug",()=>{}),d(this,"reuseWorkers",!0),d(this,"props",{}),d(this,"jobQueue",[]),d(this,"idleQueue",[]),d(this,"count",0),d(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(r,s,o)=>r.done(o),i=(r,s)=>r.error(s)){const r=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:s}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new Kx(n.name,e);e.onMessage=r=>n.onMessage(i,r.type,r.payload),e.onError=r=>n.onError(i,r),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new _f({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Zx?this.maxMobileConcurrency:this.maxConcurrency}}const tT={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class hn{static isSupported(){return _f.isSupported()}static getWorkerFarm(e={}){return hn._workerFarm=hn._workerFarm||new hn({}),hn._workerFarm.setProps(e),hn._workerFarm}constructor(e){d(this,"props",void 0),d(this,"workerPools",new Map),this.props={...tT},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:r}=e;let s=this.workerPools.get(n);return s||(s=new eT({name:n,source:i,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}d(hn,"_workerFarm",void 0);const nT="latest";function iT(t,e={}){const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(r="modules/".concat(t.module,"/dist/").concat(i)),!r){let s=t.version;s==="latest"&&(s=nT);const o=s?"@".concat(s):"";r="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(i)}return wn(r),r}function rT(t,e=Yx){wn(t,"no worker provided");const n=t.version;return!(!e||!n)}function sT(t,e){return!hn.isSupported()||!yf&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function oT(t,e,n,i,r){const s=t.id,o=iT(t,n),l=hn.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const c=await l.startJob("process-on-worker",aT.bind(null,r));return c.postMessage("process",{input:e,options:n,context:i}),await(await c.result).result}async function aT(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:s,options:o}=i;try{const a=await t(s,o);e.postMessage("done",{id:r,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:r,error:l})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function My(t){return t&&typeof t=="object"&&t.isBuffer}function lT(t){return My(t)?new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer:t}function Iy(t){if(My(t))return lT(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function cT(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}function uT(...t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),i=new Uint8Array(n);let r=0;for(const s of e)i.set(s,r),r+=s.byteLength;return i.buffer}async function fT(t){const e=[];for await(const n of t)e.push(n);return uT(...e)}function og(){let t;if(typeof window!="undefined"&&window.performance)t=window.performance.now();else if(typeof process!="undefined"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class ag{constructor(e,n){d(this,"name",void 0),d(this,"type",void 0),d(this,"sampleSize",1),d(this,"time",void 0),d(this,"count",void 0),d(this,"samples",void 0),d(this,"lastTiming",void 0),d(this,"lastSampleTime",void 0),d(this,"lastSampleCount",void 0),d(this,"_count",0),d(this,"_time",0),d(this,"_samples",0),d(this,"_startTime",0),d(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=og(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(og()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Hh{constructor(e){d(this,"id",void 0),d(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof ag?this.stats[n]=e:this.stats[n]=new ag(n,i)),this.stats[n]}}let hT="";const lg={};function dT(t){for(const e in lg)if(t.startsWith(e)){const n=lg[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(hT).concat(t)),t}function pT(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}const gT=t=>typeof t=="boolean",Ss=t=>typeof t=="function",uo=t=>t!==null&&typeof t=="object",cg=t=>uo(t)&&t.constructor==={}.constructor,mT=t=>t&&typeof t[Symbol.iterator]=="function",vT=t=>t&&typeof t[Symbol.asyncIterator]=="function",kr=t=>typeof Response!="undefined"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Nr=t=>typeof Blob!="undefined"&&t instanceof Blob,yT=t=>t&&typeof t=="object"&&t.isBuffer,_T=t=>typeof ReadableStream!="undefined"&&t instanceof ReadableStream||uo(t)&&Ss(t.tee)&&Ss(t.cancel)&&Ss(t.getReader),ET=t=>uo(t)&&Ss(t.read)&&Ss(t.pipe)&&gT(t.readable),Ry=t=>_T(t)||ET(t),wT=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,xT=/^([-\w.]+\/[-\w.+]+)/;function TT(t){const e=xT.exec(t);return e?e[1]:t}function ug(t){const e=wT.exec(t);return e?e[1]:""}const ST=/\?.*/;function Wl(t){if(kr(t)){const e=Hc(t.url||""),n=t.headers.get("content-type")||"";return{url:e,type:TT(n)||ug(e)}}return Nr(t)?{url:Hc(t.name||""),type:t.type||""}:typeof t=="string"?{url:Hc(t),type:ug(t)}:{url:"",type:""}}function PT(t){return kr(t)?t.headers["content-length"]||-1:Nr(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function Hc(t){return t.replace(ST,"")}async function Oy(t){if(kr(t))return t;const e={},n=PT(t);n>=0&&(e["content-length"]=String(n));const{url:i,type:r}=Wl(t);r&&(e["content-type"]=r);const s=await CT(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function bT(t){if(!t.ok){const e=await AT(t);throw new Error(e)}}async function AT(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function CT(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=s=>{var o;return i(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=LT(n);return"data:base64,".concat(i)}return null}function LT(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function fg(t,e){if(typeof t=="string"){t=dT(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await Oy(t)}function ky(t){if(typeof window!="undefined"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process!="undefined"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Pn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||ky()}const Ca={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof global!="undefined"&&global,document:typeof document!="undefined"&&document,process:typeof process=="object"&&process},qo=Ca.window||Ca.self||Ca.global,es=Ca.process||{},Ny=typeof __VERSION__!="undefined"?__VERSION__:"untranspiled source";Pn();const $c=globalThis;function Fy(t){if(!t&&!Pn())return"Node";if(ky(t))return"Electron";const n=t||(typeof navigator!="undefined"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r?"IE":$c.chrome?"Chrome":$c.safari?"Safari":$c.mozInnerScreenX?"Firefox":"Unknown"}function MT(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class IT{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";d(this,"storage",void 0),d(this,"id",void 0),d(this,"config",{}),this.storage=MT(i),this.id=e,this.config={},Object.assign(this.config,n),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}return this}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function RT(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function OT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Xc(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let fl;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(fl||(fl={}));function hg(t){return typeof t=="string"?fl[t.toUpperCase()]||fl.WHITE:t}function kT(t,e,n){return!Pn&&typeof t=="string"&&(e&&(e=hg(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=hg(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function NT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const r of i)typeof t[r]=="function"&&(e.find(s=>r===s)||(t[r]=t[r].bind(t)))}function hl(t,e){if(!t)throw new Error(e||"Assertion failed")}function Di(){let t;if(Pn&&"performance"in qo){var e,n;t=qo==null||(e=qo.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in es){var i;const r=es==null||(i=es.hrtime)===null||i===void 0?void 0:i.call(es);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const zi={debug:Pn&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},FT={enabled:!0,level:0};function yt(){}const dg={},pg={once:!0};class fo{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};d(this,"id",void 0),d(this,"VERSION",Ny),d(this,"_startTs",Di()),d(this,"_deltaTs",Di()),d(this,"_storage",void 0),d(this,"userData",{}),d(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new IT("__probe-".concat(this.id,"__"),FT),this.userData={},this.timeStamp("".concat(this.id," started")),NT(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Di()-this._startTs).toPrecision(10))}getDelta(){return Number((Di()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.updateConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){hl(e,n)}warn(e){return this._getLogFunction(0,e,zi.warn,arguments,pg)}error(e){return this._getLogFunction(0,e,zi.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,zi.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,zi.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,r=new Array(i>2?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];return this._getLogFunction(e,n,zi.debug||zi.info,arguments,pg)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||yt,i&&[i],{tag:BT(n)}):yt}image(e){let{logLevel:n,priority:i,image:r,message:s="",scale:o=1}=e;return this._shouldLog(n||i)?Pn?UT({image:r,message:s,scale:o}):zT({image:r,message:s,scale:o}):yt}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||yt)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=gg({logLevel:e,message:n,opts:i}),{collapsed:s}=i;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||yt)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Dy(e)}_getLogFunction(e,n,i,r,s){if(this._shouldLog(e)){s=gg({logLevel:e,message:n,args:r,opts:s}),i=i||s.method,hl(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Di();const o=s.tag||s.message;if(s.once)if(!dg[o])dg[o]=Di();else return yt;return n=DT(this.id,s.message,s),i.bind(console,n,...s.args)}return yt}}d(fo,"VERSION",Ny);function Dy(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return hl(Number.isFinite(e)&&e>=0),e}function gg(t){const{logLevel:e,message:n}=t;t.logLevel=Dy(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return hl(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function DT(t,e,n){if(typeof e=="string"){const i=n.time?OT(RT(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=kT(e,n.color,n.background)}return e}function zT(t){let{image:e,message:n="",scale:i=1}=t,r=null;try{r=eE.require("asciify-image")}catch{}return r?()=>r(e,{fit:"box",width:"".concat(Math.round(80*i),"%")}).then(s=>console.log(s)):yt}function UT(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=Xc(s,n,i);console.log(...o)},s.src=e,yt}const r=e.nodeName||"";if(r.toLowerCase()==="img")return console.log(...Xc(e,n,i)),yt;if(r.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Xc(s,n,i)),s.src=e.toDataURL(),yt}return yt}function BT(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const mg=new fo({id:"loaders.gl"});class VT{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class jT{constructor(){d(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const zy={fetch:null,mimeType:void 0,nothrow:!1,log:new jT,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Wh,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},GT={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Uy(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const By=()=>{const t=Uy();return t.globalOptions=t.globalOptions||{...zy},t.globalOptions};function WT(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],HT(t,n),XT(e,t,i)}function Vy(t,e){const n=By(),i=t||n;return typeof i.fetch=="function"?i.fetch:uo(i.fetch)?r=>fg(r,i):e!=null&&e.fetch?e==null?void 0:e.fetch:fg}function HT(t,e){vg(t,null,zy,GT,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};vg(i,n.id,r,s,e)}}function vg(t,e,n,i,r){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const l=!e&&uo(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in i)mg.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!l){const f=$T(a,r);mg.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(f))()}}}}function $T(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const s in r.options){if(t===s)return"Did you mean '".concat(r.id,".").concat(s,"'?");const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(s,"'?"))}return i}function XT(t,e,n){const r={...t.options||{}};return YT(r,n),r.log===null&&(r.log=new VT),yg(r,By()),yg(r,e),r}function yg(t,e){for(const n in e)if(n in e){const i=e[n];cg(i)&&cg(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function YT(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function $h(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Xh(t){var e,n;ul(t,"null loader"),ul($h(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const jy=()=>{const t=Uy();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function ZT(t){const e=jy();t=Array.isArray(t)?t:[t];for(const n of t){const i=Xh(n);e.find(r=>i===r)||e.unshift(i)}}function KT(){return jy()}const qT=new fo({id:"loaders.gl"}),QT=/\.([^.]+)$/;async function JT(t,e=[],n,i){if(!Gy(t))return null;let r=_g(t,e,{...n,nothrow:!0},i);if(r)return r;if(Nr(t)&&(t=await t.slice(0,10).arrayBuffer(),r=_g(t,e,n,i)),!r&&!(n!=null&&n.nothrow))throw new Error(Wy(t));return r}function _g(t,e=[],n,i){if(!Gy(t))return null;if(e&&!Array.isArray(e))return Xh(e);let r=[];e&&(r=r.concat(e)),n!=null&&n.ignoreRegisteredLoaders||r.push(...KT()),tS(r);const s=eS(t,r,n,i);if(!s&&!(n!=null&&n.nothrow))throw new Error(Wy(t));return s}function eS(t,e,n,i){const{url:r,type:s}=Wl(t),o=r||(i==null?void 0:i.url);let a=null,l="";if(n!=null&&n.mimeType&&(a=Yc(e,n==null?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),a=a||nS(e,o),l=l||(a?"matched url ".concat(o):""),a=a||Yc(e,s),l=l||(a?"matched MIME type ".concat(s):""),a=a||rS(e,t),l=l||(a?"matched initial data ".concat(Hy(t)):""),a=a||Yc(e,n==null?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(s):""),l){var c;qT.log(1,"selectLoader selected ".concat((c=a)===null||c===void 0?void 0:c.name,": ").concat(l,"."))}return a}function Gy(t){return!(t instanceof Response&&t.status===204)}function Wy(t){const{url:e,type:n}=Wl(t);let i="No valid loader found (";i+=e?"".concat(pT(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=t?Hy(t):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function tS(t){for(const e of t)Xh(e)}function nS(t,e){const n=e&&QT.exec(e),i=n&&n[1];return i?iS(t,i):null}function iS(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function Yc(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function rS(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(sS(e,n))return n}else if(ArrayBuffer.isView(e)){if(Eg(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Eg(e,0,n))return n;return null}function sS(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function Eg(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>oS(t,e,n,r))}function oS(t,e,n,i){if(i instanceof ArrayBuffer)return cT(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const r=Ef(t,e,i.length);return i===r;default:return!1}}function Hy(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Ef(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Ef(t,0,e):""}function Ef(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}const aS=256*1024;function*lS(t,e){const n=(e==null?void 0:e.chunkSize)||aS;let i=0;const r=new TextEncoder;for(;i<t.length;){const s=Math.min(t.length-i,n),o=t.slice(i,i+s);i+=s,yield r.encode(o)}}const cS=256*1024;function*uS(t,e={}){const{chunkSize:n=cS}=e;let i=0;for(;i<t.byteLength;){const r=Math.min(t.byteLength-i,n),s=new ArrayBuffer(r),o=new Uint8Array(t,i,r);new Uint8Array(s).set(o),i+=r,yield s}}const fS=1024*1024;async function*hS(t,e){const n=(e==null?void 0:e.chunkSize)||fS;let i=0;for(;i<t.size;){const r=i+n,s=await t.slice(i,r).arrayBuffer();i=r,yield s}}function wg(t,e){return Wh?dS(t,e):pS(t)}async function*dS(t,e){const n=t.getReader();let i;try{for(;;){const r=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:s,value:o}=await r;if(s)return;yield Iy(o)}}catch{n.releaseLock()}}async function*pS(t,e){for await(const n of t)yield Iy(n)}function gS(t,e){if(typeof t=="string")return lS(t,e);if(t instanceof ArrayBuffer)return uS(t,e);if(Nr(t))return hS(t,e);if(Ry(t))return wg(t,e);if(kr(t))return wg(t.body,e);throw new Error("makeIterator")}const $y="Cannot convert supplied data type";function mS(t,e,n){if(e.text&&typeof t=="string")return t;if(yT(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error($y)}async function vS(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return mS(t,e);if(Nr(t)&&(t=await Oy(t)),kr(t)){const r=t;return await bT(r),e.binary?await r.arrayBuffer():await r.text()}if(Ry(t)&&(t=gS(t,n)),mT(t)||vT(t))return fT(t);throw new Error($y)}function yS(t,e,n=null){if(n)return n;const i={fetch:Vy(e,t),...t};return Array.isArray(i.loaders)||(i.loaders=null),i}function _S(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function Yh(t,e,n,i){wn(!i||typeof i=="object"),e&&!Array.isArray(e)&&!$h(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:r}=Wl(t),o=_S(e,i),a=await JT(t,o,n);return a?(n=WT(n,a,o,r),i=yS({url:r,parse:Yh,loaders:o},n,i),await ES(a,t,n,i)):null}async function ES(t,e,n,i){if(rT(t),kr(e)){const r=e,{ok:s,redirected:o,status:a,statusText:l,type:c,url:u}=r,f=Object.fromEntries(r.headers.entries());i.response={headers:f,ok:s,redirected:o,status:a,statusText:l,type:c,url:u}}if(e=await vS(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(sT(t,n))return await oT(t,e,n,i,Yh);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw wn(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function dl(t,e,n,i){!Array.isArray(e)&&!$h(e)&&(n=e,e=void 0);const r=Vy(n);let s=t;return typeof t=="string"&&(s=await r(t)),Nr(t)&&(s=await r(t)),await Yh(s,e,n)}const wS="3.2.4",{_parseImageNode:xS}=globalThis,wf=typeof Image!="undefined",xf=typeof ImageBitmap!="undefined",TS=Boolean(xS),Tf=Wh?!0:TS;function SS(t){switch(t){case"auto":return xf||wf||Tf;case"imagebitmap":return xf;case"image":return wf;case"data":return Tf;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function PS(){if(xf)return"imagebitmap";if(wf)return"image";if(Tf)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function bS(t){const e=CS(t);if(!e)throw new Error("Not an image");return e}function AS(t){switch(bS(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function CS(t){return typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap?"imagebitmap":typeof Image!="undefined"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const LS=/^data:image\/svg\+xml/,MS=/\.svg((\?|#).*)?$/;function Zh(t){return t&&(LS.test(t)||MS.test(t))}function IS(t,e){if(Zh(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return Xy(t,e)}function Xy(t,e){if(Zh(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Yy(t,e,n){const i=IS(t,n),r=self.URL||self.webkitURL,s=typeof i!="string"&&r.createObjectURL(i);try{return await RS(s||i,e)}finally{s&&r.revokeObjectURL(s)}}async function RS(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,r)=>{try{n.onload=()=>i(n),n.onerror=s=>r(new Error("Could not load image ".concat(t,": ").concat(s)))}catch(s){r(s)}})}const OS={};let xg=!0;async function kS(t,e,n){let i;Zh(n)?i=await Yy(t,e,n):i=Xy(t,n);const r=e&&e.imagebitmap;return await NS(i,r)}async function NS(t,e=null){if((FS(e)||!xg)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),xg=!1}return await createImageBitmap(t)}function FS(t){for(const e in t||OS)return!1;return!0}const qt=!1,Ps=!0;function Zy(t){const e=ho(t);return DS(e)||BS(e)||zS(e)||US(e)}function DS(t){const e=ho(t);return e.byteLength>=24&&e.getUint32(0,qt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,qt),height:e.getUint32(20,qt)}:null}function zS(t){const e=ho(t);return e.byteLength>=10&&e.getUint32(0,qt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Ps),height:e.getUint16(8,Ps)}:null}function US(t){const e=ho(t);return e.byteLength>=14&&e.getUint16(0,qt)===16973&&e.getUint32(2,Ps)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Ps),height:e.getUint32(22,Ps)}:null}function BS(t){const e=ho(t);if(!(e.byteLength>=3&&e.getUint16(0,qt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=VS();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,qt);if(r.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,qt),width:e.getUint16(s+7,qt)};if(!i.has(o))return null;s+=2,s+=e.getUint16(s,qt)}return null}function VS(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function ho(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function jS(t,e){const{mimeType:n}=Zy(t)||{},i=globalThis._parseImageNode;return ul(i),await i(t,n)}async function GS(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:s}=n||{},o=WS(r);let a;switch(o){case"imagebitmap":a=await kS(t,e,s);break;case"image":a=await Yy(t,e,s);break;case"data":a=await jS(t);break;default:ul(!1)}return r==="data"&&(a=AS(a)),a}function WS(t){switch(t){case"auto":case"data":return PS();default:return SS(t),t}}const HS=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],$S=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],XS={image:{type:"auto",decode:!0}},Ky={id:"image",module:"images",name:"Images",version:wS,mimeTypes:$S,extensions:HS,parse:GS,tests:[t=>Boolean(Zy(new DataView(t)))],options:XS};var W=new fo({id:"deck"});let Sf={};function YS(t){Sf=t}function Ne(t,e,n,i){W.level>0&&Sf[t]&&Sf[t].call(null,e,n,i)}function ZS(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}var KS={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:ZS,parseTextSync:JSON.parse};const bs="8.8.2",La=globalThis.deck&&globalThis.deck.VERSION;if(La&&La!==bs)throw new Error("deck.gl - multiple versions detected: ".concat(La," vs ").concat(bs));La||(W.log(1,"deck.gl ".concat(bs))(),globalThis.deck={...globalThis.deck,VERSION:bs,version:bs,log:W,_registerLoggers:YS},ZT([KS,[Ky,{imagebitmap:{premultiplyAlpha:"none"}}]]));var qS=globalThis.deck;const z=new fo({id:"luma.gl"});function je(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const QS="Invalid WebGLRenderingContext",JS="Requires WebGL2";function Hl(t){return typeof WebGLRenderingContext!="undefined"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function X(t){return typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function eP(t){return X(t)?t:null}function $l(t){return je(Hl(t),QS),t}function De(t){return je(X(t),JS),t}const hs={};function tP(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function nP(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function iP(t,e){hs[t]=!0,e!==void 0&&tP(e)}function rP(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(hs[i]=!0);while(i!==0);for(i in hs)if(hs[i])return delete hs[i],parseInt(i,10);return 0}}const po=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const r=new t.VertexAttrib(n);this.attribs[i]=r}this.maxAttrib=0};po.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};po.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Ri=function(e){const n=this;this.gl=e,rP(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(s){return s===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(s,o){switch(s){case 34962:n.currentArrayBuffer=o;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=o;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(s,o){const l=n.currentVertexArrayObject.attribs[s];switch(o){case 34975:return l.buffer;case 34338:return l.enabled;case 34339:return l.size;case 34340:return l.stride;case 34341:return l.type;case 34922:return l.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(s,o,a,l,c,u){const f=n.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,s);const h=f.attribs[s];return h.buffer=n.currentArrayBuffer,h.size=o,h.type=a,h.normalized=l,h.stride=c,h.offset=u,h.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{nP("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Ri.prototype.VERTEX_ARRAY_BINDING_OES=34229;Ri.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new po(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Ri.prototype.createVertexArrayOES=function(){const e=new po(this);return this.vertexArrayObjects.push(e),e};Ri.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Ri.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof po&&e.hasBeenBound&&e.ext===this)};Ri.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){iP(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(r===s)return;(!r||s.elementArrayBuffer!==r.elementArrayBuffer)&&i.bindBuffer.call(n,34963,s.elementArrayBuffer);let o=this.currentArrayBuffer;const a=Math.max(r?r.maxAttrib:0,s.maxAttrib);for(let l=0;l<=a;l++){const c=s.attribs[l],u=r?r.attribs[l]:null;if((!r||c.enabled!==u.enabled)&&(c.enabled?i.enableVertexAttribArray.call(n,l):i.disableVertexAttribArray.call(n,l)),c.enabled){let f=!1;(!r||c.buffer!==u.buffer)&&(o!==c.buffer&&(i.bindBuffer.call(n,34962,c.buffer),o=c.buffer),f=!0),(f||c.cached!==u.cached)&&i.vertexAttribPointer.call(n,l,c.size,c.type,c.normalized,c.stride,c.offset)}}this.currentArrayBuffer!==o&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function sP(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const r=e.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const n=t.getExtension;t.getExtension=function(r){const s=n.call(this,r);return s||(r!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Ri(this)),this.__OESVertexArrayObject))}}const Tg="OES_element_index",Sg="WEBGL_draw_buffers",oP="EXT_disjoint_timer_query",aP="EXT_disjoint_timer_query_webgl2",lP="EXT_texture_filter_anisotropic",Pg="WEBGL_debug_renderer_info",cP=35723,uP=4352,fP=36795,hP=34047,dP=37445,pP=37446,J=t=>X(t)?void 0:0,gP={[3074]:t=>X(t)?void 0:36064,[cP]:t=>X(t)?void 0:uP,[35977]:J,[32937]:J,[fP]:(t,e)=>{const n=X(t)?t.getExtension(aP):t.getExtension(oP);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[dP]:(t,e)=>{const n=t.getExtension(Pg);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[pP]:(t,e)=>{const n=t.getExtension(Pg);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[hP]:(t,e)=>{const n=t.luma.extensions[lP];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:J,[35071]:J,[37447]:J,[36063]:(t,e)=>{if(!X(t)){const n=t.getExtension(Sg);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:J,[35374]:J,[35377]:J,[34852]:t=>{if(!X(t)){const e=t.getExtension(Sg);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(Tg)?2147483647:65535,[33001]:t=>t.getExtension(Tg)?16777216:65535,[33e3]:t=>16777216,[37157]:J,[35373]:J,[35657]:J,[36183]:J,[37137]:J,[34045]:J,[35978]:J,[35979]:J,[35968]:J,[35376]:J,[35375]:J,[35659]:J,[37154]:J,[35371]:J,[35658]:J,[35076]:J,[35077]:J,[35380]:J};function mP(t,e,n){const i=gP[n],r=typeof i=="function"?i(t,e,n):i;return r!==void 0?r:e(n)}const vP="OES_vertex_array_object",qy="ANGLE_instanced_arrays",yP="WEBGL_draw_buffers",_P="EXT_disjoint_timer_query",EP="EXT_texture_filter_anisotropic",wP="VertexArray requires WebGL2 or OES_vertex_array_object extension";function xP(t,e){return{webgl2:X(t),ext:t.getExtension(e)}}const Qy={[vP]:{meta:{suffix:"OES"},createVertexArray:()=>{je(!1,wP)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[qy]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){je(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[yP]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{je(!1)}},[_P]:{meta:{suffix:"EXT"},createQuery:()=>{je(!1)},deleteQuery:()=>{je(!1)},beginQuery:()=>{je(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},Zc={readBuffer:(t,e,n)=>{X(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:r,ext:s}=xP(t,qy);let o;switch(i){case 35069:o=r?void 0:!1;break;case 35070:o=!r&&!s?0:void 0;break}return o!==void 0?o:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!X(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,r)=>{if(!X(t))switch(r){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,r)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:r}=t.luma,s=r[EP];i=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:mP,hint(t,e,n,i){return e(n,i)}};function TP(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(sP(t),SP(t),bP(t,Qy),PP(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=TP;function SP(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function PP(t,{target:e,target2:n}){Object.keys(Zc).forEach(i=>{if(typeof Zc[i]=="function"){const r=t[i]?t[i].bind(t):()=>{},s=Zc[i].bind(null,t,r);e[i]=s,n[i]=s}})}function bP(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&AP(t,{extension:n,target:t.luma,target2:t})}function AP(t,{extension:e,target:n,target2:i}){const r=Qy[e];je(r);const{meta:s={}}=r,{suffix:o=""}=s,a=t.getExtension(e);for(const l of Object.keys(r)){const c=`${l}${o}`;let u=null;l==="meta"||typeof t[l]=="function"||(a&&typeof a[c]=="function"?u=(...f)=>a[c](...f):typeof r[l]=="function"&&(u=r[l].bind(n))),u&&(n[l]=u,i[l]=u)}}const Kh={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},Mn=(t,e,n)=>e?t.enable(n):t.disable(n),bg=(t,e,n)=>t.hint(n,e),tt=(t,e,n)=>t.pixelStorei(n,e),CP=(t,e)=>{const n=X(t)?36009:36160;return t.bindFramebuffer(n,e)},LP=(t,e)=>t.bindFramebuffer(36008,e);function ts(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const MP={[3042]:Mn,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:Mn,[2885]:(t,e)=>t.cullFace(e),[2929]:Mn,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:Mn,[35723]:bg,[36006]:CP,[2886]:(t,e)=>t.frontFace(e),[33170]:bg,[2849]:(t,e)=>t.lineWidth(e),[32823]:Mn,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:Mn,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:Mn,[3088]:(t,e)=>t.scissor(...e),[2960]:Mn,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:tt,[3317]:tt,[37440]:tt,[37441]:tt,[37443]:tt,[3330]:tt,[3332]:tt,[3331]:tt,[36010]:LP,[3314]:tt,[32878]:tt,[3316]:tt,[3315]:tt,[32877]:tt,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=ts(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=ts(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=ts(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=ts(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=ts(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function he(t,e,n){return e[t]!==void 0?e[t]:n[t]}const IP={blendEquation:(t,e,n)=>t.blendEquationSeparate(he(32777,e,n),he(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(he(32969,e,n),he(32968,e,n),he(32971,e,n),he(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(he(32824,e,n),he(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(he(32938,e,n),he(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,he(2962,e,n),he(2967,e,n),he(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,he(34816,e,n),he(36003,e,n),he(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,he(2964,e,n),he(2965,e,n),he(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,he(34817,e,n),he(34818,e,n),he(34819,e,n))},Ag={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({[36006]:n,[36010]:n});case 36009:return t({[36006]:n});case 36008:return t({[36010]:n});default:return null}},blendColor:(t,e,n,i,r)=>t({[32773]:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,n)=>t({[32777]:e,[34877]:n}),blendFunc:(t,e,n)=>t({[32969]:e,[32968]:n,[32971]:e,[32970]:n}),blendFuncSeparate:(t,e,n,i,r)=>t({[32969]:e,[32968]:n,[32971]:i,[32970]:r}),clearColor:(t,e,n,i,r)=>t({[3106]:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,n,i,r)=>t({[3107]:[e,n,i,r]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,n)=>t({[2928]:new Float32Array([e,n])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,n)=>t({[32824]:e,[10752]:n}),sampleCoverage:(t,e,n)=>t({[32938]:e,[32939]:n}),scissor:(t,e,n,i,r)=>t({[3088]:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({[2962]:e,[2967]:n,[2963]:i,[34816]:e,[36003]:n,[36004]:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({[2964]:e,[2965]:n,[2966]:i,[34817]:e,[34818]:n,[34819]:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({[2978]:[e,n,i,r]})},Xt=(t,e)=>t.isEnabled(e),Cg={[3042]:Xt,[2884]:Xt,[2929]:Xt,[3024]:Xt,[32823]:Xt,[32926]:Xt,[32928]:Xt,[3089]:Xt,[2960]:Xt,[35977]:Xt};function Jy(t){for(const e in t)return!1;return!0}function RP(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}function Lg(t,e){const n=t[e].bind(t);t[e]=function(...r){const s=r[0];return s in t.state.cache?t.state.enable?t.state.cache[s]:n(...r):n(...r)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function OP(t,e,n){const i=t[e].bind(t);t[e]=function(...s){const{valueChanged:o,oldValue:a}=n(t.state._updateCache,...s);return o&&i(...s),a},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function kP(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class NP{constructor(e,{copyState:n=!1,log:i=()=>{}}={}){this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?DP(e):Object.assign({},Kh),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){je(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];xn(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in e){je(s!==void 0);const o=e[s],a=this.cache[s];RP(o,a)||(n=!0,i=a,r&&!(s in r)&&(r[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:i}}}function e_(t,e={}){const{enable:n=!0,copyState:i}=e;if(je(i!==void 0),!t.state){const{polyfillContext:r}=globalThis;r&&r(t),t.state=new NP(t,{copyState:i}),kP(t);for(const s in Ag){const o=Ag[s];OP(t,s,o)}Lg(t,"getParameter"),Lg(t,"isEnabled")}return t.state.enable=n,t}function FP(t){t.state||e_(t,{copyState:!1}),t.state.push()}function Mg(t){je(t.state),t.state.pop()}function xn(t,e){if(je(Hl(t),"setParameters requires a WebGL context"),Jy(e))return;const n={};for(const r in e){const s=Number(r),o=MP[r];o&&(typeof o=="string"?n[o]=!0:o(t,e[r],s))}const i=t.state&&t.state.cache;if(i)for(const r in n){const s=IP[r];s(t,e,i)}}function DP(t,e){if(e=e||Kh,typeof e=="number"){const r=e,s=Cg[r];return s?s(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const s=Cg[r];i[r]=s?s(t,Number(r)):t.getParameter(Number(r))}return i}function zP(t){xn(t,Kh)}function Tt(t,e,n){if(Jy(e))return n(t);const{nocatch:i=!0}=e;FP(t),xn(t,e);let r;if(i)r=n(t),Mg(t);else try{r=n(t)}finally{Mg(t)}return r}function Tr(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function Kc(t,e,n=!0){const i=Tr(t),r=t.drawingBufferWidth,s=t.drawingBufferHeight;return BP(e,i,r,s,n)}function UP(t){const e=typeof window=="undefined"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function BP(t,e,n,i,r){const s=Ig(t[0],e,n);let o=Rg(t[1],e,i,r),a=Ig(t[0]+1,e,n);const l=a===n-1?a:a-1;a=Rg(t[1]+1,e,i,r);let c;return r?(a=a===0?a:a+1,c=o,o=a):c=a===i-1?a:a-1,{x:s,y:o,width:Math.max(l-s+1,1),height:Math.max(c-o+1,1)}}function Ig(t,e,n){return Math.min(Math.round(t*e),n-1)}function Rg(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const qh=Pn(),VP=qh&&typeof document!="undefined",t_={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function n_(t={}){je(qh,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},t_,t);const{width:e,height:n}=t;function i(a){if(t.throwOnError)throw new Error(a);return console.error(a),null}t.onError=i;let r;const{canvas:s}=t,o=HP({canvas:s,width:e,height:n,onError:i});return r=WP(o,t),r?(r=Qh(r,t),$P(r),r):null}function Qh(t,e={}){if(!t||t._instrumented)return t;t._version=t._version||XP(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},t_,e);const{manageState:n,debug:i}=e;return n&&e_(t,{copyState:!1,log:(...r)=>z.log(1,...r)()}),qh&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),z.level=Math.max(z.level,1)):z.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function jP(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),r=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),s=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||e,renderer:s||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function GP(t,e={}){if(t.canvas){const i=UP(e.useDevicePixels);YP(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function WP(t,e){const{onError:n}=e;let i=null;const r=l=>i=l.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:s=!0,webgl2:o=!0}=e;let a=null;return o&&(a=a||t.getContext("webgl2",e),a=a||t.getContext("experimental-webgl2",e)),s&&(a=a||t.getContext("webgl",e),a=a||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",r,!1),a?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),a):n(`Failed to create ${o&&!s?"WebGL2":"WebGL"} context: ${i||"Unknown error"}`)}function HP({canvas:t,width:e=800,height:n=600,onError:i}){let r;return typeof t=="string"?(VP&&document.readyState==="complete"||i(`createGLContext called on canvas '${t}' before page was loaded`),r=document.getElementById(t)):t?r=t:(r=document.createElement("canvas"),r.id="lumagl-canvas",r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",document.body.insertBefore(r,document.body.firstChild)),r}function $P(t){const e=X(t)?"WebGL2":"WebGL1",n=jP(t),i=n?`(${n.vendor},${n.renderer})`:"",r=t.debug?" debug":"";z.info(1,`${e}${r} context ${i}`)()}function XP(t){return typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext?2:1}function YP(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,r="height"in n?n.height:t.canvas.clientHeight;(!i||!r)&&(z.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,r=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==e){let o=e;const a=Math.floor(i*o),l=Math.floor(r*o);t.canvas.width=a,t.canvas.height=l,(t.drawingBufferWidth!==a||t.drawingBufferHeight!==l)&&(z.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/r),t.canvas.width=Math.floor(i*o),t.canvas.height=Math.floor(r*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:e})}}const As="8.5.14",ZP="set luma.log.level=1 (or higher) to trace rendering";class KP{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Hh({id:e})),this.stats.get(e)}}const yi=new KP;if(globalThis.luma&&globalThis.luma.VERSION!==As)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${As}`);globalThis.luma||(Pn()&&z.log(1,`luma.gl ${As} - ${ZP}`)(),globalThis.luma=globalThis.luma||{VERSION:As,version:As,log:z,stats:yi,globals:{modules:{},nodeIO:{}}});function qP(t){return typeof window!="undefined"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function QP(t){return typeof window!="undefined"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function k(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function qc(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return k(i!==void 0,`Accessing undefined constant GL.${e}`),i}function qn(t,e){e=Number(e);for(const n in t)if(t[n]===e)return`GL.${n}`;return String(e)}const Qc={};function en(t="id"){Qc[t]=Qc[t]||1;const e=Qc[t]++;return`${t}-${e}`}function Og(t){return k(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Sr(t){let e=!0;for(const n in t){e=!1;break}return e}function i_(t,e,n,i){const r=`See luma.gl ${n} Upgrade Guide at https://luma.gl/docs/upgrade-guide`,s=Object.getPrototypeOf(t);i.forEach(o=>{s.methodName||(s[o]=()=>{throw z.removed(`Calling removed method ${e}.${o}: `,r)(),new Error(o)})})}const Ui="Resource subclass must define virtual methods";class bn{get[Symbol.toStringTag](){return"Resource"}constructor(e,n={}){$l(e);const{id:i,userData:r={}}=n;this.gl=e,this.gl2=e,this.id=i||en(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}get handle(){return this._handle}delete({deleteChildren:e=!1}={}){const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(e=this.handle){if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e,n={}){e=qc(this.gl,e),k(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=X(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const a=r.webgl1,l="webgl2"in r?r.webgl2:r.webgl1;return s?l:a}}return this._getParameter(e,n)}getParameters(e={}){const{parameters:n,keys:i}=e,r=this.constructor.PARAMETERS||{},s=X(this.gl),o={},a=n||Object.keys(r);for(const l of a){const c=r[l];if(c&&(!("webgl2"in c)||s)&&(!("extension"in c)||this.gl.getExtension(c.extension))){const f=i?qn(this.gl,l):l;o[f]=this.getParameter(l,e),i&&c.type==="GLenum"&&(o[f]=qn(this.gl,o[f]))}}return o}setParameter(e,n){e=qc(this.gl,e),k(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=X(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");r.type==="GLenum"&&(n=qc(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return i_(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(Ui)}_deleteHandle(){throw new Error(Ui)}_bindHandle(e){throw new Error(Ui)}_getOptsFromHandle(){throw new Error(Ui)}_getParameter(e,n){throw new Error(Ui)}_setParameter(e,n){throw new Error(Ui)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=yi.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get(`${e}s Created`).incrementCount(),n.get(`${e}s Active`).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];yi.get("Resource Counts").get(`${e}s Active`).decrementCount()}_trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const i=yi.get("Memory Usage");i.get("GPU Memory").addCount(e),i.get(`${n} Memory`).addCount(e),this.byteLength=e}_trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=yi.get("Memory Usage");n.get("GPU Memory").subtractCount(this.byteLength),n.get(`${e} Memory`).subtractCount(this.byteLength),this.byteLength=0}}const JP="Failed to deduce GL constant from typed array";function Pf(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(JP)}}function Xs(t,{clamped:e=!0}={}){switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function eb({data:t,width:e,height:n,bytesPerPixel:i=4,temp:r}){const s=e*i;r=r||new Uint8Array(s);for(let o=0;o<n/2;++o){const a=o*s,l=(n-o-1)*s;r.set(t.subarray(a,a+s)),t.copyWithin(a,l,l+s),t.set(r,l)}}function tb({data:t,width:e,height:n}){const i=Math.round(e/2),r=Math.round(n/2),s=new Uint8Array(i*r*4);for(let o=0;o<r;o++)for(let a=0;a<i;a++)for(let l=0;l<4;l++)s[(o*i+a)*4+l]=t[(o*2*e+a*2)*4+l];return{data:s,width:i,height:r}}function bf(t,e,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=n;for(const a in i)if(a in e){const c=i[a]?`${t}.${i[a]}`:"N/A";z.removed(`${t}.${a}`,c)()}for(const a in r)if(a in e){const l=r[a];z.deprecated(`${t}.${a}`,`${t}.${l}`)()}let o=null;for(const a in s)if(a in e){const l=s[a];z.deprecated(`${t}.${a}`,`${t}.${l}`)(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]}return o||e}const nb={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},ib={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class at{static getBytesPerElement(e){return Xs(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return k(e.size),Xs(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new at(nb,...e)}constructor(...e){e.forEach(n=>this._assign(n)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return at.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return at.getBytesPerVertex(this)}_assign(e={}){return e=bf("Accessor",e,ib),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const kg=10,r_={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},rb={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:r_},sb={removedProps:r_};class Q extends bn{get[Symbol.toStringTag](){return"Buffer"}constructor(e,n={}){super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(e=this.accessor){return Math.round(this.byteLength/at.getBytesPerElement(e))}getVertexCount(e=this.accessor){return Math.round(this.byteLength/at.getBytesPerVertex(e))}initialize(e={}){return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=bf("Buffer",e,rb),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=bf("Buffer",e,sb),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new at(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:r=0}=e,s=e.byteLength||e.length;k(n);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),r!==0||s!==void 0?(De(this.gl),this.gl.bufferSubData(this.target,i,n,r,s)):this.gl.bufferSubData(o,i,n),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(n),this}copyData({sourceBuffer:e,readOffset:n=0,writeOffset:i=0,size:r}){const{gl:s}=this;return De(s),s.bindBuffer(36662,e.handle),s.bindBuffer(36663,this.handle),s.copyBufferSubData(36662,36663,n,i,r),s.bindBuffer(36662,null),s.bindBuffer(36663,null),this.debugData=null,this}getData({dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:r=0}={}){De(this.gl);const s=Xs(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(n),a=i;let l,c;e?(c=e.length,l=c-a):(l=Math.min(o,r||o),c=a+l);const u=Math.min(o,l);return r=r||u,k(r<=u),e=e||new s(c),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,r),this.gl.bindBuffer(36662,null),e}bind({target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:r}={}){return e===35345||e===35982?r!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,r):(k(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind({target:e=this.target,index:n=this.accessor&&this.accessor.index}={}){return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(kg,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e,n=0,i=e.byteLength+n){k(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.usage),this.gl.bufferSubData(r,n,e),this.gl.bindBuffer(r,null),this.debugData=e.slice(0,kg),this.bytesUsed=i,this._trackAllocatedMemory(i);const s=Pf(e);return k(s),this.setAccessor(new at(this.accessor,{type:s})),this}_setByteLength(e,n=this.usage){k(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,n),this.gl.bindBuffer(r,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=Xs(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new at(this.accessor,{type:Pf(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return z.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return z.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return z.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return z.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new at(this.accessor,e),this}}const Jh={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},s_={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},o_={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function ob(t,e){const n=Jh[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=X(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function ab(t,e){const n=Jh[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const lb=[9729,9728],Ng=globalThis.WebGLBuffer||function(){};class Ci extends bn{get[Symbol.toStringTag](){return"Texture"}static isSupported(e,n={}){const{format:i,linearFiltering:r}=n;let s=!0;return i&&(s=s&&ob(e,i),s=s&&(!r||ab(e,i))),s}constructor(e,n){const{id:i=en("texture"),handle:r,target:s}=n;super(e,{id:i,handle:r}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return`Texture(${this.id},${this.width}x${this.height})`}initialize(e={}){let n=e.data;if(n instanceof Promise)return n.then(v=>this.initialize(Object.assign({},e,{pixels:v,data:v}))),this;const i=typeof HTMLVideoElement!="undefined"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:r=null,format:s=6408,border:o=0,recreate:a=!1,parameters:l={},pixelStore:c={},textureUnit:u=void 0}=e;n||(n=r);let{width:f,height:h,dataFormat:p,type:g,compressed:_=!1,mipmaps:x=!0}=e;const{depth:y=0}=e;return{width:f,height:h,compressed:_,dataFormat:p,type:g}=this._deduceParameters({format:s,type:g,dataFormat:p,compressed:_,data:n,width:f,height:h}),this.width=f,this.height=h,this.depth=y,this.format=s,this.type=g,this.dataFormat=p,this.border=o,this.textureUnit=u,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),x&&this._isNPOT()&&(z.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),x=!1,this._updateForNPOT(l)),this.mipmaps=x,this.setImageData({data:n,width:f,height:h,depth:y,format:s,type:g,dataFormat:p,border:o,mipmaps:x,parameters:c,compressed:_}),x&&this.generateMipmap(),this.setParameters(l),a&&(this.data=n),i&&(this._video={video:n,parameters:l,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize({height:e,width:n,mipmaps:i=!1}){return n!==this.width||e!==this.height?this.initialize({width:n,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(e={}){return this._isNPOT()?(z.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Tt(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:r=0,format:s=this.format,border:o=this.border,offset:a=0,parameters:l={}}=e;let{data:c=null,type:u=this.type,width:f=this.width,height:h=this.height,dataFormat:p=this.dataFormat,compressed:g=!1}=e;c||(c=i),{type:u,dataFormat:p,compressed:g,width:f,height:h}=this._deduceParameters({format:s,type:u,dataFormat:p,compressed:g,data:c,width:f,height:h});const{gl:_}=this;_.bindTexture(this.target,this.handle);let x=null;({data:c,dataType:x}=this._getDataType({data:c,compressed:g}));let y,v=0;if(Tt(this.gl,l,()=>{switch(x){case"null":_.texImage2D(n,r,s,f,h,o,p,u,c);break;case"typed-array":_.texImage2D(n,r,s,f,h,o,p,u,c,a);break;case"buffer":y=De(_),y.bindBuffer(35052,c.handle||c),y.texImage2D(n,r,s,f,h,o,p,u,a),y.bindBuffer(35052,null);break;case"browser-object":X(_)?_.texImage2D(n,r,s,f,h,o,p,u,c):_.texImage2D(n,r,s,p,u,c);break;case"compressed":for(const[w,S]of c.entries())_.compressedTexImage2D(n,w,S.format,S.width,S.height,o,S.data),v+=S.levelSize;break;default:k(!1,"Unknown image data type")}}),x==="compressed")this._trackAllocatedMemory(v,"Texture");else if(c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{const w=s_[this.dataFormat]||4,S=o_[this.type]||1;this._trackAllocatedMemory(this.width*this.height*w*S,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:n=null,data:i=null,x:r=0,y:s=0,width:o=this.width,height:a=this.height,level:l=0,format:c=this.format,type:u=this.type,dataFormat:f=this.dataFormat,compressed:h=!1,offset:p=0,border:g=this.border,parameters:_={}}){if({type:u,dataFormat:f,compressed:h,width:o,height:a}=this._deduceParameters({format:c,type:u,dataFormat:f,compressed:h,data:i,width:o,height:a}),k(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const x=i;i=x.data,o=x.shape[0],a=x.shape[1]}i instanceof Q&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Tt(this.gl,_,()=>{if(h)this.gl.compressedTexSubImage2D(e,l,r,s,o,a,c,i);else if(i===null)this.gl.texSubImage2D(e,l,r,s,o,a,f,u,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(e,l,r,s,o,a,f,u,i,p);else if(i instanceof Ng){const x=De(this.gl);x.bindBuffer(35052,i),x.texSubImage2D(e,l,r,s,o,a,f,u,p),x.bindBuffer(35052,null)}else X(this.gl)?De(this.gl).texSubImage2D(e,l,r,s,o,a,f,u,i):this.gl.texSubImage2D(e,l,r,s,f,u,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return z.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e=this.textureUnit){const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType({data:e,compressed:n=!1}){return n?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof Q?{data:e.handle,dataType:"buffer"}:e instanceof Ng?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:r,height:s,dataFormat:o,type:a,compressed:l}=e;const c=Jh[n];return o=o||c&&c.dataFormat,a=a||c&&c.types[0],l=l||c&&c.compressed,{width:r,height:s}=this._deduceImageSize(i,r,s),{dataFormat:o,type:a,compressed:l,width:r,height:s,format:n,data:i}}_deduceImageSize(e,n,i){let r;return typeof ImageData!="undefined"&&e instanceof ImageData?r={width:e.width,height:e.height}:typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement?r={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement?r={width:e.width,height:e.height}:typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap?r={width:e.width,height:e.height}:typeof HTMLVideoElement!="undefined"&&e instanceof HTMLVideoElement?r={width:e.videoWidth,height:e.videoHeight}:e?r={width:n,height:i}:r={width:n>=0?n:1,height:i>=0?i:1},k(r,"Could not deduced texture size"),k(n===void 0||r.width===n,"Deduced texture width does not match supplied width"),k(i===void 0||r.height===i,"Deduced texture height does not match supplied height"),r}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:k(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return X(this.gl)||!this.width||!this.height?!1:!Og(this.width)||!Og(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:lb.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let cb="";function ub(t,e){return k(typeof t=="string"),t=cb+t,new Promise((n,i)=>{try{const r=new Image;r.onload=()=>n(r),r.onerror=()=>i(new Error(`Could not load image ${t}.`)),r.crossOrigin=e&&e.crossOrigin||"anonymous",r.src=t}catch(r){i(r)}})}class et extends Ci{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return Ci.isSupported(e,n)}constructor(e,n={}){$l(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:ub(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const Af=[34069,34070,34071,34072,34073,34074];class a_ extends Ci{get[Symbol.toStringTag](){return"TextureCube"}constructor(e,n={}){$l(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(e={}){const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage({face:e,data:n,x:i=0,y:r=0,mipmapLevel:s=0}){return this._subImage({target:e,data:n,x:i,y:r,mipmapLevel:s})}async setCubeMapImageData({width:e,height:n,pixels:i,data:r,border:s=0,format:o=6408,type:a=5121}){const{gl:l}=this,c=i||r,u=await Promise.all(Af.map(f=>{const h=c[f];return Promise.all(Array.isArray(h)?h:[h])}));this.bind(),Af.forEach((f,h)=>{u[h].length>1&&this.opts.mipmaps!==!1&&z.warn(`${this.id} has mipmap and multiple LODs.`)(),u[h].forEach((p,g)=>{e&&n?l.texImage2D(f,g,o,e,n,s,o,a,p):l.texImage2D(f,g,o,o,a,p)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:r,pixels:s,data:o,border:a=0,format:l=6408,type:c=5121}=e,{gl:u}=this,f=s||o;return this.bind(),f instanceof Promise?f.then(h=>this.setImageDataForFace(Object.assign({},e,{face:n,data:h,pixels:h}))):this.width||this.height?u.texImage2D(n,0,l,i,r,a,l,c,f):u.texImage2D(n,0,l,l,c,f),this}}a_.FACES=Af;class fb extends Ci{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return X(e)}constructor(e,n={}){De(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData({level:e=0,dataFormat:n=6408,width:i,height:r,depth:s=1,border:o=0,format:a,type:l=5121,offset:c=0,data:u,parameters:f={}}){if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Tt(this.gl,f,()=>{ArrayBuffer.isView(u)&&this.gl.texImage3D(this.target,e,n,i,r,s,o,a,l,u),u instanceof Q&&(this.gl.bindBuffer(35052,u.handle),this.gl.texImage3D(this.target,e,n,i,r,s,o,a,l,c))}),u&&u.byteLength)this._trackAllocatedMemory(u.byteLength,"Texture");else{const h=s_[this.dataFormat]||4,p=o_[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*h*p,"Texture")}return this.loaded=!0,this}}const ci="EXT_color_buffer_float";var Fg={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:ci,bpp:2},[33327]:{gl2:ci,bpp:4},[34842]:{gl2:ci,bpp:8},[33326]:{gl2:ci,bpp:4},[33328]:{gl2:ci,bpp:8},[34836]:{gl2:ci,bpp:16},[35898]:{gl2:ci,bpp:4}};function hb(t,e,n){const i=n[e];if(!i)return!1;const r=X(t)&&i.gl2||i.gl1;return typeof r=="string"?t.getExtension(r):r}class ir extends bn{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e,{format:n}={format:null}){return!n||hb(e,n,Fg)}static getSamplesForFormat(e,{format:n}){return e.getInternalformatParameter(36161,n,32937)}constructor(e,n={}){super(e,n),this.initialize(n),Object.seal(this)}initialize({format:e,width:n=1,height:i=1,samples:r=0}){return k(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),r!==0&&X(this.gl)?this.gl.renderbufferStorageMultisample(36161,r,e,n,i):this.gl.renderbufferStorage(36161,e,n,i),this.format=e,this.width=n,this.height=i,this.samples=r,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Fg[this.format].bpp),this}resize({width:e,height:n}){return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const db=256,pb=1024,gb=16384,Dg=6144,zg=6145,Ug=6146,Bg=34041,l_="clear: bad arguments";function ed(t,{framebuffer:e=null,color:n=null,depth:i=null,stencil:r=null}={}){const s={};e&&(s.framebuffer=e);let o=0;n&&(o|=gb,n!==!0&&(s.clearColor=n)),i&&(o|=db,i!==!0&&(s.clearDepth=i)),r&&(o|=pb,i!==!0&&(s.clearStencil=i)),k(o!==0,l_),Tt(t,s,()=>{t.clear(o)})}function mb(t,{framebuffer:e=null,buffer:n=Dg,drawBuffer:i=0,value:r=[0,0,0,0]}={}){De(t),Tt(t,{framebuffer:e},()=>{switch(n){case Dg:switch(r.constructor){case Int32Array:t.clearBufferiv(n,i,r);break;case Uint32Array:t.clearBufferuiv(n,i,r);break;case Float32Array:default:t.clearBufferfv(n,i,r)}break;case zg:t.clearBufferfv(zg,0,[r]);break;case Ug:t.clearBufferiv(Ug,0,[r]);break;case Bg:const[s,o]=r;t.clearBufferfi(Bg,0,s,o);break;default:k(!1,l_)}})}function vb(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return k(!1),0}}function Xl(t,e={}){const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=e;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e;const{framebuffer:u,deleteFramebuffer:f}=c_(t);k(u);const{gl:h,handle:p,attachments:g}=u;a=a||u.width,l=l||u.height,s===36064&&p===null&&(s=1028),k(g[s]),c=c||g[s].type,o=_b(o,c,r,a,l),c=c||Pf(o);const _=h.bindFramebuffer(36160,p);return h.readPixels(n,i,a,l,r,c,o),h.bindFramebuffer(36160,_||null),f&&u.delete(),o}function Vg(t,{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}={}){let i=Xl(t,{sourceAttachment:e}),{width:r,height:s}=t;for(;s>n;)({data:i,width:r,height:s}=tb({data:i,width:r,height:s}));eb({data:i,width:r,height:s});const o=document.createElement("canvas");o.width=r,o.height=s;const a=o.getContext("2d"),l=a.createImageData(r,s);return l.data.set(i),a.putImageData(l,0,0),o.toDataURL()}function yb(t,e,n={}){const{sourceX:i=0,sourceY:r=0,targetMipmaplevel:s=0,targetInternalFormat:o=6408}=n;let{targetX:a,targetY:l,targetZ:c,width:u,height:f}=n;const{framebuffer:h,deleteFramebuffer:p}=c_(t);k(h);const{gl:g,handle:_}=h,x=typeof a!="undefined"||typeof l!="undefined"||typeof c!="undefined";a=a||0,l=l||0,c=c||0;const y=g.bindFramebuffer(36160,_);k(e);let v=null;if(e instanceof Ci&&(v=e,u=Number.isFinite(u)?u:v.width,f=Number.isFinite(f)?f:v.height,v.bind(0),e=v.target),!x)g.copyTexImage2D(e,s,o,i,r,u,f,0);else switch(e){case 3553:case 34067:g.copyTexSubImage2D(e,s,a,l,i,r,u,f);break;case 35866:case 32879:De(g).copyTexSubImage3D(e,s,a,l,c,i,r,u,f);break}return v&&v.unbind(),g.bindFramebuffer(36160,y||null),p&&h.delete(),v}function c_(t){return t instanceof _e?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Ab(t),deleteFramebuffer:!0}}function _b(t,e,n,i,r){if(t)return t;e=e||5121;const s=Xs(e,{clamped:!1}),o=vb(n);return new s(i*r*o)}const ee={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function Eb(t){const e=new et(t,{format:6408,type:5126,dataFormat:6408}),n=new _e(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}var u_={[ee.WEBGL2]:[!1,!0],[ee.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[ee.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[ee.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[ee.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[ee.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[ee.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[ee.FLOAT_BLEND]:["EXT_float_blend"],[ee.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[ee.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[ee.TEXTURE_FLOAT]:["OES_texture_float",!0],[ee.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[ee.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[ee.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[ee.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[ee.COLOR_ATTACHMENT_RGBA32F]:[Eb,"EXT_color_buffer_float"],[ee.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[ee.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[ee.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[ee.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[ee.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[ee.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]};const wb=2;function f_(t,e){return td(t,e)}function td(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>h_(t,n))}function xb(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in u_)t.luma.caps[e]===void 0&&(t.luma.caps[e]=h_(t,e));return t.luma.caps}function h_(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=Tb(t,e)),t.luma.caps[e]||z.log(wb,`Feature: ${e} not supported`)(),t.luma.caps[e]}function Tb(t,e){const n=u_[e];k(n,e);let i;const r=X(t)&&n[1]||n[0];if(typeof r=="function")i=r(t);else if(Array.isArray(r)){i=!0;for(const s of r)i=i&&Boolean(t.getExtension(s))}else typeof r=="string"?i=Boolean(t.getExtension(r)):typeof r=="boolean"?i=r:k(!1);return i}const jg="Multiple render targets not supported";class _e extends bn{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e,n={}){const{colorBufferFloat:i,colorBufferHalfFloat:r}=n;let s=!0;return i&&(s=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),r&&(s=s&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new _e(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=De(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=De(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e,n={}){super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize({width:e=1,height:n=1,attachments:i=null,color:r=!0,depth:s=!0,stencil:o=!1,check:a=!0,readBuffer:l=void 0,drawBuffers:c=void 0}){if(k(e>=0&&n>=0,"Width and height need to be integers"),this.width=e,this.height=n,i)for(const u in i){const f=i[u];(Array.isArray(f)?f[0]:f).resize({width:e,height:n})}else i=this._createDefaultAttachments(r,s,o,e,n);this.update({clearAttachments:!0,attachments:i,readBuffer:l,drawBuffers:c}),i&&a&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update({attachments:e={},readBuffer:n,drawBuffers:i,clearAttachments:r=!1,resizeAttachments:s=!0}){this.attach(e,{clearAttachments:r,resizeAttachments:s});const{gl:o}=this,a=o.bindFramebuffer(36160,this.handle);return n&&this._setReadBuffer(n),i&&this._setDrawBuffers(i),o.bindFramebuffer(36160,a||null),this}resize(e={}){let{width:n,height:i}=e;if(this.handle===null)return k(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&z.log(2,`Resizing framebuffer ${this.id} to ${n}x${i}`)();for(const r in this.attachments)this.attachments[r].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e,{clearAttachments:n=!1,resizeAttachments:i=!0}={}){const r={};n&&Object.keys(this.attachments).forEach(o=>{r[o]=null}),Object.assign(r,e);const s=this.gl.bindFramebuffer(36160,this.handle);for(const o in r){k(o!==void 0,"Misspelled framebuffer binding point?");const a=Number(o),l=r[a];let c=l;if(!c)this._unattach(a);else if(c instanceof ir)this._attachRenderbuffer({attachment:a,renderbuffer:c});else if(Array.isArray(l)){const[u,f=0,h=0]=l;c=u,this._attachTexture({attachment:a,texture:u,layer:f,level:h})}else this._attachTexture({attachment:a,texture:c,layer:0,level:0});i&&c&&c.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(o=>!this.attachments[o]).forEach(o=>{delete this.attachments[o]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(Pb(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(e={}){const{color:n,depth:i,stencil:r,drawBuffers:s=[]}=e,o=this.gl.bindFramebuffer(36160,this.handle);return(n||i||r)&&ed(this.gl,{color:n,depth:i,stencil:r}),s.forEach((a,l)=>{mb(this.gl,{drawBuffer:l,value:a})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(e={}){return z.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(e={}){return z.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(e={}){return z.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(e={}){return z.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(e={}){return z.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(e={}){return z.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate({attachments:e=[],x:n=0,y:i=0,width:r,height:s}){const o=De(this.gl),a=o.bindFramebuffer(36008,this.handle);return n===0&&i===0&&r===void 0&&s===void 0?o.invalidateFramebuffer(36008,e):o.invalidateFramebuffer(36008,e,n,i,r,s),o.bindFramebuffer(36008,a),this}getAttachmentParameter(e,n,i){let r=this._getAttachmentParameterFallback(n);return r===null&&(this.gl.bindFramebuffer(36160,this.handle),r=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&r>1e3&&(r=qn(this.gl,r)),r}getAttachmentParameters(e=36064,n,i=this.constructor.ATTACHMENT_PARAMETERS||[]){const r={};for(const s of i){const o=n?qn(this.gl,s):s;r[o]=this.getAttachmentParameter(e,s,n)}return r}getParameters(e=!0){const n=Object.keys(this.attachments),i={};for(const r of n){const s=Number(r),o=e?qn(this.gl,s):s;i[o]=this.getAttachmentParameters(s,e)}return i}show(){return typeof window!="undefined"&&window.open(Vg(this),"luma-debug-texture"),this}log(e=0,n=""){if(e>z.level||typeof window=="undefined")return this;n=n||`Framebuffer ${this.id}`;const i=Vg(this,{targetMaxHeight:100});return z.image({logLevel:e,message:n,image:i},n)(),this}bind({target:e=36160}={}){return this.gl.bindFramebuffer(e,this.handle),this}unbind({target:e=36160}={}){return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,r,s){let o=null;return e&&(o=o||{},o[36064]=new et(this.gl,{id:`${this.id}-color0`,pixels:null,format:6408,type:5121,width:r,height:s,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(o[36064])),n&&i?(o=o||{},o[33306]=new ir(this.gl,{id:`${this.id}-depth-stencil`,format:35056,width:r,height:111}),this.ownResources.push(o[33306])):n?(o=o||{},o[36096]=new ir(this.gl,{id:`${this.id}-depth`,format:33189,width:r,height:s}),this.ownResources.push(o[36096])):i&&k(!1),o}_unattach(e){const n=this.attachments[e];!n||(n instanceof ir?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer({attachment:e=36064,renderbuffer:n}){const{gl:i}=this;i.framebufferRenderbuffer(36160,e,36161,n.handle),this.attachments[e]=n}_attachTexture({attachment:e=36064,texture:n,layer:i,level:r}){const{gl:s}=this;switch(s.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:De(s).framebufferTextureLayer(36160,e,n.target,r,i);break;case 34067:const a=Sb(i);s.framebufferTexture2D(36160,e,a,n.handle,r);break;case 3553:s.framebufferTexture2D(36160,e,3553,n.handle,r);break;default:k(!1,"Illegal texture type")}s.bindTexture(n.target,null),this.attachments[e]=n}_setReadBuffer(e){const n=eP(this.gl);n?n.readBuffer(e):k(e===36064||e===1029,jg),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=De(n);if(i)i.drawBuffers(e);else{const r=n.getExtension("WEBGL_draw_buffers");r?r.drawBuffersWEBGL(e):k(e.length===1&&(e[0]===36064||e[0]===1029),jg)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=xb(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function Sb(t){return t<34069?t+34069:t}function Pb(t){return(_e.STATUS||{})[t]||`Framebuffer error ${t}`}const bb=[36049,36048,33296,33298,33299,33300,33301,33302,33303];_e.ATTACHMENT_PARAMETERS=bb;function d_(t,e){k(t instanceof et||t instanceof a_||t instanceof fb);const n=t.constructor,{gl:i,width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u}=t,f=Object.assign({width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u},e);return new n(i,f)}function Ab(t,e){const{gl:n,width:i,height:r,id:s}=t;return new _e(n,Object.assign({},e,{id:`framebuffer-for-${s}`,width:i,height:r,attachments:{[36064]:t}}))}function Ma(t,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const Cb=35632,Lb=35633;function Mb(t){switch(t){case Cb:return"fragment";case Lb:return"vertex";default:return"unknown type"}}function Ib(t,e,n,i){const r=t.split(/\r?\n/),s={},o={},a=i||Ma(e)||"(unnamed)",l=`${Mb(n)} shader ${a}`;for(let u=0;u<r.length;u++){const f=r[u];if(f.length<=1)continue;const h=f.split(":"),p=h[0],g=parseInt(h[2],10);if(isNaN(g))throw new Error(`GLSL compilation error in ${l}: ${t}`);p!=="WARNING"?s[g]=f:o[g]=f}const c=Rb(e);return{shaderName:l,errors:Gg(s,c),warnings:Gg(o,c)}}function Gg(t,e){let n="";for(let i=0;i<e.length;i++){const r=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+=`${r}
`,t[i+1])){const s=t[i+1],o=s.split(":",3),a=o[0],l=parseInt(o[1],10)||0,c=s.substring(o.join(":").length+1).trim();n+=p_(`^^^ ${a}: ${c}

`,l)}}return n}function Rb(t,e=1,n=": "){const i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map((s,o)=>{const a=String(o+e),l=a.length;return p_(a,r-l)+n+s})}function p_(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return`${n}${t}`}function g_(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const Ob="Shader: GLSL source code must be a JavaScript string";class Ys extends bn{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return k(!1),"unknown"}}constructor(e,n){$l(e),k(typeof n.source=="string",Ob);const i=Ma(n.source,null)||n.id||en(`unnamed ${Ys.getTypeName(n.shaderType)}`);super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize({source:e}){const n=Ma(e,null);n&&(this.id=en(n)),this._compile(e)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return`${Ys.getTypeName(this.shaderType)}:${this.id}`}getName(){return Ma(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(e=this.source){if(e.startsWith("#version ")||(e=`#version 100
${e}`),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:s,warnings:o}=Ib(i,this.source,this.shaderType,this.id);throw z.error(`GLSL compilation errors in ${r}
${s}`)(),z.warn(`GLSL compilation warnings in ${r}
${o}`)(),new Error(`GLSL compilation errors in ${r}`)}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Jc extends Ys{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class eu extends Ys{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const kb={[5126]:ne.bind(null,"uniform1fv",nt,1,ke),[35664]:ne.bind(null,"uniform2fv",nt,2,ke),[35665]:ne.bind(null,"uniform3fv",nt,3,ke),[35666]:ne.bind(null,"uniform4fv",nt,4,ke),[5124]:ne.bind(null,"uniform1iv",In,1,ke),[35667]:ne.bind(null,"uniform2iv",In,2,ke),[35668]:ne.bind(null,"uniform3iv",In,3,ke),[35669]:ne.bind(null,"uniform4iv",In,4,ke),[35670]:ne.bind(null,"uniform1iv",In,1,ke),[35671]:ne.bind(null,"uniform2iv",In,2,ke),[35672]:ne.bind(null,"uniform3iv",In,3,ke),[35673]:ne.bind(null,"uniform4iv",In,4,ke),[35674]:ne.bind(null,"uniformMatrix2fv",nt,4,cn),[35675]:ne.bind(null,"uniformMatrix3fv",nt,9,cn),[35676]:ne.bind(null,"uniformMatrix4fv",nt,16,cn),[35678]:Ce,[35680]:Ce,[5125]:ne.bind(null,"uniform1uiv",Qo,1,ke),[36294]:ne.bind(null,"uniform2uiv",Qo,2,ke),[36295]:ne.bind(null,"uniform3uiv",Qo,3,ke),[36296]:ne.bind(null,"uniform4uiv",Qo,4,ke),[35685]:ne.bind(null,"uniformMatrix2x3fv",nt,6,cn),[35686]:ne.bind(null,"uniformMatrix2x4fv",nt,8,cn),[35687]:ne.bind(null,"uniformMatrix3x2fv",nt,6,cn),[35688]:ne.bind(null,"uniformMatrix3x4fv",nt,12,cn),[35689]:ne.bind(null,"uniformMatrix4x2fv",nt,8,cn),[35690]:ne.bind(null,"uniformMatrix4x3fv",nt,12,cn),[35678]:Ce,[35680]:Ce,[35679]:Ce,[35682]:Ce,[36289]:Ce,[36292]:Ce,[36293]:Ce,[36298]:Ce,[36299]:Ce,[36300]:Ce,[36303]:Ce,[36306]:Ce,[36307]:Ce,[36308]:Ce,[36311]:Ce},Nb={},Fb={},Db={},Wg=[0];function nd(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(Wg[0]=t,t=Wg);const r=t.length;if(r%e&&z.warn(`Uniform size should be multiples of ${e}`,t)(),t instanceof n)return t;let s=i[r];s||(s=new n(r),i[r]=s);for(let o=0;o<r;o++)s[o]=t[o];return s}function nt(t,e){return nd(t,e,Float32Array,Nb)}function In(t,e){return nd(t,e,Int32Array,Fb)}function Qo(t,e){return nd(t,e,Uint32Array,Db)}function Hg(t,e,n){const i=kb[n.type];if(!i)throw new Error(`Unknown GLSL uniform type ${n.type}`);return i().bind(null,t,e)}function zb(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]||1,isArray:Boolean(n[2])}}function Ub(t,e,n){for(const i in t){const r=t[i];if((!n||Boolean(n[i]))&&!Bb(r))throw e=e?`${e} `:"",console.error(`${e} Bad uniform ${i}`,r),new Error(`${e} Bad uniform ${i}`)}return!0}function Bb(t){return Array.isArray(t)||ArrayBuffer.isView(t)?jb(t):isFinite(t)||t===!0||t===!1||t instanceof Ci||t instanceof ir?!0:t instanceof _e?Boolean(t.texture):!1}function Vb(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let r=0,s=n.length;r<s;++r)i[r]=n[r]}else t[e]=n.slice();else t[e]=n}function jb(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ce(){let t=null;return(e,n,i)=>{const r=t!==i;return r&&(e.uniform1i(n,i),t=i),r}}function ne(t,e,n,i){let r=null,s=null;return(o,a,l)=>{const c=e(l,n),u=c.length;let f=!1;if(r===null)r=new Float32Array(u),s=u,f=!0;else{k(s===u,"Uniform length cannot change.");for(let h=0;h<u;++h)if(c[h]!==r[h]){f=!0;break}}return f&&(i(o,t,a,c),r.set(c)),f}}function ke(t,e,n,i){t[e](n,i)}function cn(t,e,n,i){t[e](n,!1,i)}const Gb=5120,Wb=5121,Hb=5122,$b=5123,$g=0,Jo=1,Xb=2,Yb=3,ea=4,Zb=5,Kb=6,Ee=5126,qb=35664,Qb=35665,Jb=35666,ns=5124,eA=35667,tA=35668,nA=35669,is=5125,iA=36294,rA=36295,sA=36296,oA=35670,aA=35671,lA=35672,cA=35673,uA=35674,fA=35675,hA=35676,dA=35685,pA=35686,gA=35687,mA=35688,vA=35689,yA=35690,Cf={[Ee]:[Ee,1,"float"],[qb]:[Ee,2,"vec2"],[Qb]:[Ee,3,"vec3"],[Jb]:[Ee,4,"vec4"],[ns]:[ns,1,"int"],[eA]:[ns,2,"ivec2"],[tA]:[ns,3,"ivec3"],[nA]:[ns,4,"ivec4"],[is]:[is,1,"uint"],[iA]:[is,2,"uvec2"],[rA]:[is,3,"uvec3"],[sA]:[is,4,"uvec4"],[oA]:[Ee,1,"bool"],[aA]:[Ee,2,"bvec2"],[lA]:[Ee,3,"bvec3"],[cA]:[Ee,4,"bvec4"],[uA]:[Ee,8,"mat2"],[dA]:[Ee,8,"mat2x3"],[pA]:[Ee,8,"mat2x4"],[fA]:[Ee,12,"mat3"],[gA]:[Ee,12,"mat3x2"],[mA]:[Ee,12,"mat3x4"],[hA]:[Ee,16,"mat4"],[vA]:[Ee,16,"mat4x2"],[yA]:[Ee,16,"mat4x3"]};function _A(t){switch(t){case $g:return $g;case Jo:return Jo;case Yb:return Jo;case Xb:return Jo;case ea:return ea;case Zb:return ea;case Kb:return ea;default:return k(!1),0}}function Xg(t){const e=Cf[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function m_(t,e){switch(t){case Gb:case Wb:case Hb:case $b:t=Ee;break}for(const n in Cf){const[i,r,s]=Cf[n];if(i===t&&r===e)return{glType:n,name:s}}return null}class EA{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getActiveAttrib(e.handle,r),l=n.getAttribLocation(e.handle,s);l>=0&&this._addAttribute(l,s,o,a)}this.attributeInfos.sort((r,s)=>r.location-s.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!X(n))return;const i=n.getProgramParameter(e.handle,35971);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getTransformFeedbackVarying(e.handle,r);this._addVarying(r,s,o,a)}this.varyingInfos.sort((r,s)=>r.location-s.location)}_addAttribute(e,n,i,r){const{type:s,components:o}=Xg(i),a={type:s,size:r*o};this._inferProperties(e,n,a);const l={location:e,name:n,accessor:new at(a)};this.attributeInfos.push(l),this.attributeInfosByLocation[e]=l,this.attributeInfosByName[l.name]=l}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,r){const{type:s,components:o}=Xg(i),a=new at({type:s,size:r*o}),l={location:e,name:n,accessor:a};this.varyingInfos.push(l),this.varyingInfosByName[l.name]=l}}const Yg=4,wA=35981,xA=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class v_ extends bn{get[Symbol.toStringTag](){return"Program"}constructor(e,n={}){super(e,n),this.stubRemovedMethods("Program","v6.0",xA),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(e={}){const{hash:n,vs:i,fs:r,varyings:s,bufferMode:o=wA}=e;return this.hash=n||"",this.vs=typeof i=="string"?new Jc(this.gl,{id:`${e.id}-vs`,source:i}):i,this.fs=typeof r=="string"?new eu(this.gl,{id:`${e.id}-fs`,source:r}):r,k(this.vs instanceof Jc),k(this.fs instanceof eu),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(De(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new EA(this),this.setProps(e)}delete(e={}){return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw({logPriority:e,drawMode:n=4,vertexCount:i,offset:r=0,start:s,end:o,isIndexed:a=!1,indexType:l=5123,instanceCount:c=0,isInstanced:u=c>0,vertexArray:f=null,transformFeedback:h,framebuffer:p,parameters:g={},uniforms:_,samplers:x}){if((_||x)&&(z.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(_||{})),z.priority>=e){const y=p?p.id:"default",v=`mode=${qn(this.gl,n)} verts=${i} instances=${c} indexType=${qn(this.gl,l)} isInstanced=${u} isIndexed=${a} Framebuffer=${y}`;z.log(e,v)()}return k(f),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||u&&c===0?!1:(f.bindForDraw(i,c,()=>{if(p!==void 0&&(g=Object.assign({},g,{framebuffer:p})),h){const y=_A(n);h.begin(y)}this._bindTextures(),Tt(this.gl,g,()=>{a&&u?this.gl2.drawElementsInstanced(n,i,l,r,c):a&&X(this.gl)&&!isNaN(s)&&!isNaN(o)?this.gl2.drawRangeElements(n,s,o,i,l,r):a?this.gl.drawElements(n,i,l,r):u?this.gl2.drawArraysInstanced(n,r,i,c):this.gl.drawArrays(n,r,i)}),h&&h.end()}),!0)}setUniforms(e={}){z.priority>=2&&Ub(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],r=this._uniformSetters[n];if(r){let s=i,o=!1;if(s instanceof _e&&(s=s.texture),s instanceof Ci)if(o=this.uniforms[n]!==i,o){r.textureIndex===void 0&&(r.textureIndex=this._textureIndexCounter++);const a=s,{textureIndex:l}=r;a.bind(l),s=l,this._textureUniforms[n]=a}else s=r.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(r(s)||o)&&Vb(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const r of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new Jc({handle:r});break;case 35632:i.fs=new eu({handle:r});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=en(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?`${e}-program`:"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),z.time(Yg,`linkProgram for ${this._getName()}`)(),e.linkProgram(this.handle),z.timeEnd(Yg,`linkProgram for ${this._getName()}`)(),e.debug||z.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error(`Error linking: ${e.getProgramInfoLog(this.handle)}`);if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error(`Error validating: ${e.getProgramInfoLog(this.handle)}`)}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:r}=zb(i.name);let s=e.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=Hg(e,s,i),i.size>1)for(let o=0;o<i.size;o++)s=e.getUniformLocation(this.handle,`${r}[${o}]`),this._uniformSetters[`${r}[${o}]`]=Hg(e,s,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const TA=34918,SA=34919,PA=35007,bA=36795,AA=35976,CA=35887,LA=36202;class pl extends bn{get[Symbol.toStringTag](){return"Query"}static isSupported(e,n=[]){const i=X(e),r=td(e,ee.TIMER_QUERY);let s=i||r;for(const o of n)switch(o){case"queries":s=s&&i;break;case"timers":s=s&&r;break;default:k(!1)}return s}constructor(e,n={}){super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(PA)}beginOcclusionQuery({conservative:e=!1}={}){return this.begin(e?LA:CA)}beginTransformFeedbackQuery(){return this.begin(AA)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,SA);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(bA)}getResult(){return this.gl2.getQueryParameter(this.handle,TA)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,r)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return pl.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class y_ extends bn{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return X(e)}constructor(e,n={}){De(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(e={}){return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Sr(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(e={}){return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:r,byteSize:s,byteOffset:o}=this._getBufferParams(n);return i<0?(this.unused[e]=r,z.warn(()=>`${this.id} unused varying buffer ${e}`)(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,r,o,s),this)}begin(e=0){return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,r;return e instanceof Q?r=e:(r=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||r.byteLength-n),{buffer:r,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:r}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,r,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n,i=0,r){const s=n&&n.handle;return!s||r===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,i,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let ta=null;function MA(t){return(!ta||ta.byteLength<t)&&(ta=new ArrayBuffer(t)),ta}function IA(t,e){const n=MA(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function RA({target:t,source:e,start:n=0,count:i=1}){const r=e.length,s=i*r;let o=0;for(let a=n;o<r;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}const OA="elements must be GL.ELEMENT_ARRAY_BUFFER";class rt extends bn{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e,n={}){return n.constantAttributeZero?X(e)||Fy()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new rt(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return rt.MAX_ATTRIBUTES=rt.MAX_ATTRIBUTES||e.getParameter(34921),rt.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:rt._setConstantFloatArray(e,n,i);break;case Int32Array:rt._setConstantIntArray(e,n,i);break;case Uint32Array:rt._setConstantUintArray(e,n,i);break;default:k(!1)}}constructor(e,n={}){const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return rt.getMaxAttributes(this.gl)}initialize(e={}){return this.setProps(e)}setProps(e){return this}setElementBuffer(e=null,n={}){return k(!e||e.target===34963,OA),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:r,type:s,stride:o,offset:a,normalized:l,integer:c,divisor:u}=i,{gl:f,gl2:h}=this;return e=Number(e),this.bind(()=>{f.bindBuffer(34962,n.handle),c?(k(X(f)),h.vertexAttribIPointer(e,r,s,o,a)):f.vertexAttribPointer(e,r,s,l,o,a),f.enableVertexAttribArray(e),h.vertexAttribDivisor(e,u||0)}),this}enable(e,n=!0){return!n&&e===0&&!rt.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),r=i.byteLength*e,s=i.length*e;let o=!this.buffer;if(this.buffer=this.buffer||new Q(this.gl,r),o=o||this.buffer.reallocate(r),o=o||!this._compareConstantArrayValues(i,this.bufferValue),o){const a=IA(n.constructor,s);RA({target:a,source:i,start:0,count:s}),this.buffer.subData(a),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:k(!1)}}static _setConstantIntArray(e,n,i){switch(k(X(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:k(!1)}}static _setConstantUintArray(e,n,i){switch(k(X(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:k(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,{location:n}){return k(Number.isFinite(n)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(n,e);default:return this.gl.getVertexAttrib(n,e)}})}}const kA="VertexArray: attributes must be Buffers or constants (i.e. typed array)",NA=/^(.+)__LOCATION_([0-9]+)$/,FA=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class DA{constructor(e,n={}){const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new rt(e),i_(this,"VertexArray","v6.0",FA),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(e={}){return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(e=null,n={}){return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n,i={}){if(n.target===34963)return this.setElementBuffer(n,i);const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return r>=0&&(this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(r,n,s)),this}setConstant(e,n,i={}){const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return r>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Q(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof Q&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof Q&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let r;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),r=i()}),r}_resolveLocationAndAccessor(e,n,i,r){const s={location:-1,accessor:null},{location:o,name:a}=this._getAttributeIndex(e);if(!Number.isFinite(o)||o<0)return this.unused[e]=n,z.once(3,()=>`unused value ${e} in ${this.id}`)(),s;const l=this._getAttributeInfo(a||o);if(!l)return s;const c=this.accessors[o]||{},u=at.resolve(l.accessor,c,i,r),{size:f,type:h}=u;return k(Number.isFinite(f)&&Number.isFinite(h)),{location:o,accessor:u}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=NA.exec(e),r=i?i[1]:e,s=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+s,name:r}:{location:-1}}_setAttribute(e,n){if(n instanceof Q)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof Q){const i=n[0],r=n[1];this.setBuffer(e,i,r)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof Q){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(kA)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,i);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)r=this.values[s],ArrayBuffer.isView(r)&&this._setConstantAttribute(s,r)}_setConstantAttributeZero(e,n){if(rt.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){rt.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],r=this.accessors[n];if(!i)return;const{divisor:s}=r,o=s>0;if(e.isInstanced=e.isInstanced||o,i instanceof Q){const a=i;if(o){const l=a.getVertexCount(r);e.instanceCount=Math.min(e.instanceCount,l)}else{const l=a.getVertexCount(r);e.vertexCount=Math.min(e.vertexCount,l)}}}setElements(e=null,n={}){return z.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function zA(t,e){const{maxElts:n=16,size:i=1}=e;let r="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(r+=`,${o%i===0?" ":""}`),r+=Zs(t[o],e);const s=t.length>n?"...":"]";return`${r}${s}`}function Zs(t,e={}){const{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return zA(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<1e-16)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const r=t.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function Zg({header:t="Uniforms",program:e,uniforms:n,undefinedOnly:i=!1}){k(e);const r=".*_.*",s=".*Matrix",o=e._uniformSetters,a={},l=Object.keys(o).sort();let c=0;for(const h of l)!h.match(r)&&!h.match(s)&&tu({table:a,header:t,uniforms:n,uniformName:h,undefinedOnly:i})&&c++;for(const h of l)h.match(s)&&tu({table:a,header:t,uniforms:n,uniformName:h,undefinedOnly:i})&&c++;for(const h of l)a[h]||tu({table:a,header:t,uniforms:n,uniformName:h,undefinedOnly:i})&&c++;let u=0;const f={};if(!i)for(const h in n){const p=n[h];a[h]||(u++,f[h]={Type:`NOT USED: ${p}`,[t]:Zs(p)})}return{table:a,count:c,unusedTable:f,unusedCount:u}}function tu({table:t,header:e,uniforms:n,uniformName:i,undefinedOnly:r}){const s=n[i],o=UA(s);return!r||!o?(t[i]={[e]:o?Zs(s):"N/A","Uniform Type":o?s:"NOT PROVIDED"},!0):!1}function UA(t){return t!=null}function BA({vertexArray:t,header:e="Attributes"}){if(!t.configuration)return{};const n={};t.elements&&(n.ELEMENT_ARRAY_BUFFER=Kg(t,t.elements,null,e));const i=t.values;for(const r in i){const s=t._getAttributeInfo(r);if(s){let o=`${r}: ${s.name}`;const a=t.accessors[s.location];a&&(o=`${r}: ${VA(s.name,a)}`),n[o]=Kg(t,i[r],a,e)}}return n}function Kg(t,e,n,i){const{gl:r}=t;if(!e)return{[i]:"null","Format ":"N/A"};let s="NOT PROVIDED",o=1,a=0,l=0,c,u,f;if(n&&(s=n.type,o=n.size,s=String(s).replace("Array",""),c=s.indexOf("nt")!==-1),e instanceof Q){const h=e,{data:p,changed:g}=h.getDebugData();u=g?"*":"",f=p,l=h.byteLength,a=l/p.BYTES_PER_ELEMENT/o;let _;return n?_=`${n.divisor>0?"I ":"P "} ${a} (x${o}=${l} bytes ${qn(r,s)})`:(c=!0,_=`${l} bytes`),{[i]:`${u}${Zs(f,{size:o,isInteger:c})}`,"Format ":_}}return f=e,o=e.length,s=String(e.constructor.name).replace("Array",""),c=s.indexOf("nt")!==-1,{[i]:`${Zs(f,{size:o,isInteger:c})} (constant)`,"Format ":`${o}x${s} (constant)`}}function VA(t,e){const{type:n,size:i}=e,r=m_(n,i);return r?`${t} (${r.name})`:t}function jA(t){const e={},n=`Accessors for ${t.id}`;for(const i of t.attributeInfos)if(i){const r=qg(i);e[`in ${r}`]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const r=qg(i);e[`out ${r}`]={[n]:JSON.stringify(i.accessor)}}return e}function qg(t){const{type:e,size:n}=t.accessor,i=m_(e,n);return i?`${i.name} ${t.name}`:t.name}const Qg=Pn()&&typeof document!="undefined";let GA=0;class WA{constructor(e={}){const{onCreateContext:n=x=>n_(x),onAddHTML:i=null,onInitialize:r=()=>{},onRender:s=()=>{},onFinalize:o=()=>{},onError:a,gl:l=null,glOptions:c={},debug:u=!1,createFramebuffer:f=!1,autoResizeViewport:h=!0,autoResizeDrawingBuffer:p=!0,stats:g=yi.get(`animation-loop-${GA++}`)}=e;let{useDevicePixels:_=!0}=e;"useDevicePixelRatio"in e&&(z.deprecated("useDevicePixelRatio","useDevicePixels")(),_=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:r,onRender:s,onFinalize:o,onError:a,gl:l,glOptions:c,debug:u,createFramebuffer:f},this.gl=l,this.needsRedraw=null,this.timeline=null,this.stats=g,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:h,autoResizeDrawingBuffer:p,useDevicePixels:_}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return k(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(e={}){if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=pl.isSupported(this.gl,["timers"])?new pl(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(...e){return this.props.onCreateContext(...e)}onInitialize(...e){return this.props.onInitialize(...e)}onRender(...e){return this.props.onRender(...e)}onFinalize(...e){return this.props.onFinalize(...e)}getHTMLControlValue(e,n=1){const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return z.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{!this._running||(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Qg?new Promise((e,n)=>{if(Qg&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):QP(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):qP(e)}_renderFrame(...e){if(this.display){this.display._renderFrame(...e);return}this.onRender(...e)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas!="undefined"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Qh(this.props.gl,e):this.onCreateContext(e),!Hl(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");zP(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:r}=this.gl;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&GP(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new _e(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const go="vs",id="fs";function ut(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const nu={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function HA(t){const e={};for(const n in t){const i=t[n],r=$A(i);e[n]=r}return e}function $A(t){let e=Jg(t);return e==="object"?t?"type"in t?Object.assign({},t,nu[t.type]):"value"in t?(e=Jg(t.value),Object.assign({type:e},t,nu[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},nu[e])}function Jg(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const XA="vs",YA="fs";class em{constructor({name:e,vs:n,fs:i,dependencies:r=[],uniforms:s,getUniforms:o,deprecations:a=[],defines:l={},inject:c={},vertexShader:u,fragmentShader:f}){ut(typeof e=="string"),this.name=e,this.vs=n||u,this.fs=i||f,this.getModuleUniforms=o,this.dependencies=r,this.deprecations=this._parseDeprecationDefinitions(a),this.defines=l,this.injections=ZA(c),s&&(this.uniforms=HA(s))}getModuleSource(e){let n;switch(e){case XA:n=this.vs||"";break;case YA:n=this.fs||"";break;default:ut(!1)}return`#define MODULE_${this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_")}
${n}// END MODULE_${this.name}

`}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp(`\\b${n.old}\\(`);break;default:n.regex=new RegExp(`${n.type} ${n.old};`)}}),e}_defaultGetUniforms(e={}){const n={},i=this.uniforms;for(const r in i){const s=i[r];r in e&&!s.private?(s.validate&&ut(s.validate(e[r],s),`${this.name}: invalid ${r}`),n[r]=e[r]):n[r]=s.value}return n}}function ZA(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const r=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[r][n]=i}return e}function KA(t){return qA(E_(t))}function qA(t){const e={},n={};return __({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,r)=>n[r]-n[i]).map(i=>e[i])}function __({modules:t,level:e,moduleMap:n,moduleDepth:i}){if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const r of t)n[r.name]=r,(i[r.name]===void 0||i[r.name]<e)&&(i[r.name]=e);for(const r of t)r.dependencies&&__({modules:r.dependencies,level:e+1,moduleMap:n,moduleDepth:i})}function E_(t,e){return t.map(n=>(n instanceof em||(ut(typeof n!="string",`Shader module use by name is deprecated. Import shader module '${n}' and use it directly.`),ut(n.name,"shader module has no name"),n=new em(n),n.dependencies=E_(n.dependencies)),n))}function QA(t={}){const e=typeof window!="undefined"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r}const JA=7936,eC=7937,tC=7938,nC=35724,rd={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},pi={};Object.keys(rd).forEach(t=>{pi[t]=t});function iC(t){return typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function rC(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||JA),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||eC);return{gpuVendor:sC(n,i),vendor:n,renderer:i,version:t.getParameter(tC),shadingLanguageVersion:t.getParameter(nC)}}function sC(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const iu={};function tm(t,e,n={}){const i=rd[e];if(ut(i,e),!QA(n))return!0;if(e in iu)return iu[e];const r=i[0],s=n.behavior||"enable",o=`#extension GL_${r} : ${s}
void main(void) {}`,a=t.createShader(35633);t.shaderSource(a,o),t.compileShader(a);const l=t.getShaderParameter(a,35713);return t.deleteShader(a),iu[e]=l,l}function oC(t,e){const n=rd[e];ut(n,e);const i=iC(t)&&n[1]||n[0],r=typeof i=="string"?Boolean(t.getExtension(i)):i;return ut(r===!1||r===!0),r}function na(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>oC(t,n))}function aC(t){switch(rC(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function lC(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return na(t,pi.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),na(t,pi.GLSL_DERIVATIVES)&&tm(t,pi.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),na(t,pi.GLSL_FRAG_DATA)&&tm(t,pi.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),na(t,pi.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const cC=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,uC=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,fC={[go]:cC,[id]:uC},Ia="__LUMA_INJECT_DECLARATIONS__",nm=/void\s+main\s*\([^)]*\)\s*\{\n?/,im=/}\n?[^{}]*$/,ru=[];function rm(t,e,n,i=!1){const r=e===go;for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),ru.length=o.length;for(let l=0,c=o.length;l<c;++l)ru[l]=o[l].injection;const a=`${ru.join(`
`)}
`;switch(s){case"vs:#decl":r&&(t=t.replace(Ia,a));break;case"vs:#main-start":r&&(t=t.replace(nm,l=>l+a));break;case"vs:#main-end":r&&(t=t.replace(im,l=>a+l));break;case"fs:#decl":r||(t=t.replace(Ia,a));break;case"fs:#main-start":r||(t=t.replace(nm,l=>l+a));break;case"fs:#main-end":r||(t=t.replace(im,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(Ia,""),i&&(t=t.replace(/\}\s*$/,s=>s+fC[e])),t}function Lf(t){const e={};return ut(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?`${e[i]}
${n[i]}`:n[i]}),e}function Pr(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}const w_=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],hC=[...w_,[Pr("attribute"),"in $1"],[Pr("varying"),"out $1"]],dC=[...w_,[Pr("varying"),"in $1"]],x_=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],pC=[...x_,[Pr("in"),"attribute $1"],[Pr("out"),"varying $1"]],gC=[...x_,[Pr("in"),"varying $1"]],Mf="gl_FragColor",If=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,mC=/void\s+main\s*\([^)]*\)\s*\{\n?/;function vC(t,e,n){switch(e){case 300:return n?gl(t,hC):yC(t);case 100:return n?gl(t,pC):_C(t);default:throw new Error(`unknown GLSL version ${e}`)}}function gl(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function yC(t){t=gl(t,dC);const e=t.match(If);if(e){const n=e[1];t=t.replace(new RegExp(`\\b${Mf}\\b`,"g"),n)}else{const n="fragmentColor";t=t.replace(mC,i=>`out vec4 ${n};
${i}`).replace(new RegExp(`\\b${Mf}\\b`,"g"),n)}return t}function _C(t){t=gl(t,gC);const e=t.match(If);if(e){const n=e[1];t=t.replace(If,"").replace(new RegExp(`\\b${n}\\b`,"g"),Mf)}return t}const EC=`

${Ia}

`,T_={[go]:"vertex",[id]:"fragment"},wC=`precision highp float;

`;function xC(t,e){const{vs:n,fs:i}=e,r=KA(e.modules||[]);return{gl:t,vs:sm(t,Object.assign({},e,{source:n,type:go,modules:r})),fs:sm(t,Object.assign({},e,{source:i,type:id,modules:r})),getUniforms:TC(r)}}function sm(t,{id:e,source:n,type:i,modules:r,defines:s={},hookFunctions:o=[],inject:a={},transpileToGLSL100:l=!1,prologue:c=!0,log:u}){ut(typeof n=="string","shader source must be a string");const f=i===go,h=n.split(`
`);let p=100,g="",_=n;h[0].indexOf("#version ")===0?(p=300,g=h[0],_=h.slice(1).join(`
`)):g=`#version ${p}`;const x={};r.forEach(A=>{Object.assign(x,A.getDefines())}),Object.assign(x,s);let y=c?`${g}
${PC({id:e,source:n,type:i})}
${SC({type:i})}
${aC(t)}
${lC(t)}
${bC(x)}
${f?"":wC}
`:`${g}
`;const v=CC(o),w={},S={},P={};for(const A in a){const C=typeof a[A]=="string"?{injection:a[A],order:0}:a[A],M=A.match(/^(v|f)s:(#)?([\w-]+)$/);if(M){const R=M[2],O=M[3];R?O==="decl"?S[A]=[C]:P[A]=[C]:w[A]=[C]}else P[A]=[C]}for(const A of r){u&&A.checkDeprecations(_,u),y+=A.getModuleSource(i,p);const M=A.injections[i];for(const R in M){const O=R.match(/^(v|f)s:#([\w-]+)$/);if(O){const B=O[2]==="decl"?S:P;B[R]=B[R]||[],B[R].push(M[R])}else w[R]=w[R]||[],w[R].push(M[R])}}return y+=EC,y=rm(y,i,S),y+=AC(v[i],w),y+=_,y=rm(y,i,P),y=vC(y,l?100:p,f),y}function TC(t){return function(n){const i={};for(const r of t){const s=r.getUniforms(n,i);Object.assign(i,s)}return i}}function SC({type:t}){return`
#define SHADER_TYPE_${T_[t].toUpperCase()}
`}function PC({id:t,source:e,type:n}){return t&&typeof t=="string"&&e.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${t}_${T_[n]}

`:""}function bC(t={}){let e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const r=t[i];(r||Number.isFinite(r))&&(n+=`#define ${i.toUpperCase()} ${t[i]}
`)}return e===0&&(n+=`
`),n}function AC(t,e){let n="";for(const i in t){const r=t[i];if(n+=`void ${r.signature} {
`,r.header&&(n+=`  ${r.header}`),e[i]){const s=e[i];s.sort((o,a)=>o.order-a.order);for(const o of s)n+=`  ${o.injection}
`}r.footer&&(n+=`  ${r.footer}`),n+=`}
`}return n}function CC(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[r,s]=n.split(":"),o=n.replace(/\(.+/,"");e[r][o]=Object.assign(i,{signature:s})}),e}const LC="void main() {gl_FragColor = vec4(0);}",S_=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,MC=`#version 300 es
${S_}`;function P_(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,r,s]=n;if(!e.includes(i)||!r||!s)return null;const o=s.split(";")[0];return{qualifier:i,type:r,name:o}}function b_(t={}){const{version:e=100,input:n,inputType:i,output:r}=t;if(!n)return e===300?MC:e>300?`#version ${e}
${S_}`:LC;const s=OC(n,i);return e>=300?`#version ${e} ${e===300?"es":""}
in ${i} ${n};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`:`varying ${i} ${n};
void main() {
  gl_FragColor = ${s};
}`}function IC(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return ut(!1),null}}function RC(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return ut(!1),null}}function OC(t,e){switch(e){case"float":return`vec4(${t}, 0.0, 0.0, 1.0)`;case"vec2":return`vec4(${t}, 0.0, 1.0)`;case"vec3":return`vec4(${t}, 1.0)`;case"vec4":return t;default:return ut(!1),null}}const kC=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,NC={name:"fp32",vs:kC,fs:null};function om(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const FC=1/Math.PI*180,DC=1/180*Math.PI,Ke={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function A_(t,{precision:e=Ke.precision}={}){return t=zC(t),"".concat(parseFloat(t.toPrecision(e)))}function br(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ia(t,e){return sd(t,n=>n*DC,e)}function Bi(t,e){return sd(t,n=>n*FC,e)}function ge(t,e,n){return sd(t,i=>Math.max(e,Math.min(n,i)))}function wi(t,e,n){return br(t)?t.map((i,r)=>wi(i,e[r],n)):n*e+(1-n)*t}function mn(t,e,n){const i=Ke.EPSILON;n&&(Ke.EPSILON=n);try{if(t===e)return!0;if(br(t)&&br(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!mn(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Ke.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Ke.EPSILON=i}}function zC(t){return Math.round(t/Ke.EPSILON)*Ke.EPSILON}function UC(t){return t.clone?t.clone():new Array(t.length)}function sd(t,e,n){if(br(t)){const i=t;n=n||UC(i);for(let r=0;r<n.length&&r<i.length;++r)n[r]=e(t[r],r,n);return n}return e(t)}function BC(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class C_ extends BC(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:br(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ke)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+A_(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!mn(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const s=e[r];this[r]=s+i*(n[r]-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Ke.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function VC(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function ot(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function su(t,e,n=""){if(Ke.debug&&!VC(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class jC extends C_{get x(){return this[0]}set x(e){this[0]=ot(e)}get y(){return this[1]}set y(e){this[1]=ot(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];n+=r*r}return ot(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return ot(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return om(e>=0&&e<this.ELEMENTS,"index is out of range"),ot(this[e])}setComponent(e,n){return om(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Ra=1e-6,Ar=typeof Float32Array!="undefined"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function GC(){var t=new Ar(2);return Ar!=Float32Array&&(t[0]=0,t[1]=0),t}function ml(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function L_(t,e){return t[0]=-e[0],t[1]=-e[1],t}function M_(t,e,n,i){var r=e[0],s=e[1];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t}function WC(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}(function(){var t=GC();return function(e,n,i,r,s,o){var a,l;for(n||(n=2),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function HC(t,e,n){const i=e[0],r=e[1],s=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/s,t[1]=(n[1]*i+n[5]*r)/s,t}function I_(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s||1;return t[0]=(n[0]*i+n[4]*r+n[8]*s)/o,t[1]=(n[1]*i+n[5]*r+n[9]*s)/o,t[2]=(n[2]*i+n[6]*r+n[10]*s)/o,t}function $C(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function XC(){var t=new Ar(3);return Ar!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function R_(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function YC(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function ZC(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function KC(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function qC(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function QC(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=r*l-s*a,t[1]=s*o-i*l,t[2]=i*a-r*o,t}function JC(t,e,n,i){var r=e[0],s=e[1],o=e[2];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t}function O_(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,t}function eL(t,e,n){var i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t}function tL(t,e,n){var i=n[0],r=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2],u=r*c-s*l,f=s*a-i*c,h=i*l-r*a,p=r*h-s*f,g=s*u-i*h,_=i*f-r*u,x=o*2;return u*=x,f*=x,h*=x,p*=2,g*=2,_*=2,t[0]=a+u+p,t[1]=l+f+g,t[2]=c+h+_,t}function nL(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function iL(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function rL(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function sL(t,e){var n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt(n*n+i*i+r*r),c=Math.sqrt(s*s+o*o+a*a),u=l*c,f=u&&qC(t,e)/u;return Math.acos(Math.min(Math.max(f,-1),1))}var k_=YC,oL=R_,ou=ZC;(function(){var t=XC();return function(e,n,i,r,s,o){var a,l;for(n||(n=3),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const au=[0,0,0];let ra;class bt extends jC{static get ZERO(){return ra||(ra=new bt(0,0,0),Object.freeze(ra)),ra}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&br(e)?this.copy(e):(Ke.debug&&(ot(e),ot(n),ot(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ke.debug&&(ot(e.x),ot(e.y),ot(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ot(e)}angle(e){return sL(this,e)}cross(e){return QC(this,this,e),this.check()}rotateX({radians:e,origin:n=au}){return nL(this,this,n,e),this.check()}rotateY({radians:e,origin:n=au}){return iL(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=au}){return rL(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return O_(this,this,e),this.check()}transformAsVector(e){return I_(this,this,e),this.check()}transformByMatrix3(e){return eL(this,this,e),this.check()}transformByMatrix2(e){return $C(this,this,e),this.check()}transformByQuaternion(e){return tL(this,this,e),this.check()}}class aL extends C_{toString(){let e="[";if(Ke.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=ot(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[i+r];return n}setColumn(e,n){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=n[r];return this}}function lL(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cL(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Rf(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],p=e[11],g=e[12],_=e[13],x=e[14],y=e[15],v=n*a-i*o,w=n*l-r*o,S=n*c-s*o,P=i*l-r*a,A=i*c-s*a,C=r*c-s*l,M=u*_-f*g,R=u*x-h*g,O=u*y-p*g,U=f*x-h*_,B=f*y-p*_,j=h*y-p*x,H=v*j-w*B+S*U+P*O-A*R+C*M;return H?(H=1/H,t[0]=(a*j-l*B+c*U)*H,t[1]=(r*B-i*j-s*U)*H,t[2]=(_*C-x*A+y*P)*H,t[3]=(h*A-f*C-p*P)*H,t[4]=(l*O-o*j-c*R)*H,t[5]=(n*j-r*O+s*R)*H,t[6]=(x*S-g*C-y*w)*H,t[7]=(u*C-h*S+p*w)*H,t[8]=(o*B-a*O+c*M)*H,t[9]=(i*O-n*B-s*M)*H,t[10]=(g*A-_*S+y*v)*H,t[11]=(f*S-u*A-p*v)*H,t[12]=(a*R-o*U-l*M)*H,t[13]=(n*U-i*R+r*M)*H,t[14]=(_*w-g*P-x*v)*H,t[15]=(u*P-f*w+h*v)*H,t):null}function uL(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],f=t[10],h=t[11],p=t[12],g=t[13],_=t[14],x=t[15],y=e*o-n*s,v=e*a-i*s,w=e*l-r*s,S=n*a-i*o,P=n*l-r*o,A=i*l-r*a,C=c*g-u*p,M=c*_-f*p,R=c*x-h*p,O=u*_-f*g,U=u*x-h*g,B=f*x-h*_;return y*B-v*U+w*O+S*R-P*M+A*C}function xi(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=e[9],p=e[10],g=e[11],_=e[12],x=e[13],y=e[14],v=e[15],w=n[0],S=n[1],P=n[2],A=n[3];return t[0]=w*i+S*a+P*f+A*_,t[1]=w*r+S*l+P*h+A*x,t[2]=w*s+S*c+P*p+A*y,t[3]=w*o+S*u+P*g+A*v,w=n[4],S=n[5],P=n[6],A=n[7],t[4]=w*i+S*a+P*f+A*_,t[5]=w*r+S*l+P*h+A*x,t[6]=w*s+S*c+P*p+A*y,t[7]=w*o+S*u+P*g+A*v,w=n[8],S=n[9],P=n[10],A=n[11],t[8]=w*i+S*a+P*f+A*_,t[9]=w*r+S*l+P*h+A*x,t[10]=w*s+S*c+P*p+A*y,t[11]=w*o+S*u+P*g+A*v,w=n[12],S=n[13],P=n[14],A=n[15],t[12]=w*i+S*a+P*f+A*_,t[13]=w*r+S*l+P*h+A*x,t[14]=w*s+S*c+P*p+A*y,t[15]=w*o+S*u+P*g+A*v,t}function vl(t,e,n){var i=n[0],r=n[1],s=n[2],o,a,l,c,u,f,h,p,g,_,x,y;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*s+e[12],t[13]=e[1]*i+e[5]*r+e[9]*s+e[13],t[14]=e[2]*i+e[6]*r+e[10]*s+e[14],t[15]=e[3]*i+e[7]*r+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],f=e[5],h=e[6],p=e[7],g=e[8],_=e[9],x=e[10],y=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=f,t[6]=h,t[7]=p,t[8]=g,t[9]=_,t[10]=x,t[11]=y,t[12]=o*i+u*r+g*s+e[12],t[13]=a*i+f*r+_*s+e[13],t[14]=l*i+h*r+x*s+e[14],t[15]=c*i+p*r+y*s+e[15]),t}function od(t,e,n){var i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function fL(t,e,n,i){var r=i[0],s=i[1],o=i[2],a=Math.hypot(r,s,o),l,c,u,f,h,p,g,_,x,y,v,w,S,P,A,C,M,R,O,U,B,j,H,$e;return a<Ra?null:(a=1/a,r*=a,s*=a,o*=a,l=Math.sin(n),c=Math.cos(n),u=1-c,f=e[0],h=e[1],p=e[2],g=e[3],_=e[4],x=e[5],y=e[6],v=e[7],w=e[8],S=e[9],P=e[10],A=e[11],C=r*r*u+c,M=s*r*u+o*l,R=o*r*u-s*l,O=r*s*u-o*l,U=s*s*u+c,B=o*s*u+r*l,j=r*o*u+s*l,H=s*o*u-r*l,$e=o*o*u+c,t[0]=f*C+_*M+w*R,t[1]=h*C+x*M+S*R,t[2]=p*C+y*M+P*R,t[3]=g*C+v*M+A*R,t[4]=f*O+_*U+w*B,t[5]=h*O+x*U+S*B,t[6]=p*O+y*U+P*B,t[7]=g*O+v*U+A*B,t[8]=f*j+_*H+w*$e,t[9]=h*j+x*H+S*$e,t[10]=p*j+y*H+P*$e,t[11]=g*j+v*H+A*$e,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function N_(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+c*i,t[5]=o*r+u*i,t[6]=a*r+f*i,t[7]=l*r+h*i,t[8]=c*r-s*i,t[9]=u*r-o*i,t[10]=f*r-a*i,t[11]=h*r-l*i,t}function hL(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-c*i,t[1]=o*r-u*i,t[2]=a*r-f*i,t[3]=l*r-h*i,t[8]=s*i+c*r,t[9]=o*i+u*r,t[10]=a*i+f*r,t[11]=l*i+h*r,t}function F_(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+c*i,t[1]=o*r+u*i,t[2]=a*r+f*i,t[3]=l*r+h*i,t[4]=c*r-s*i,t[5]=u*r-o*i,t[6]=f*r-a*i,t[7]=h*r-l*i,t}function dL(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,f=i*a,h=r*o,p=r*a,g=r*l,_=s*o,x=s*a,y=s*l;return t[0]=1-f-g,t[1]=u+y,t[2]=h-x,t[3]=0,t[4]=u-y,t[5]=1-c-g,t[6]=p+_,t[7]=0,t[8]=h+x,t[9]=p-_,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pL(t,e,n,i,r,s,o){var a=1/(n-e),l=1/(r-i),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(r+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function gL(t,e,n,i,r){var s=1/Math.tan(e/2),o;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0?(o=1/(i-r),t[10]=(r+i)*o,t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t}var mL=gL;function vL(t,e,n,i,r,s,o){var a=1/(e-n),l=1/(i-r),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*l,t[14]=(o+s)*c,t[15]=1,t}var yL=vL;function _L(t,e,n,i){var r,s,o,a,l,c,u,f,h,p,g=e[0],_=e[1],x=e[2],y=i[0],v=i[1],w=i[2],S=n[0],P=n[1],A=n[2];return Math.abs(g-S)<Ra&&Math.abs(_-P)<Ra&&Math.abs(x-A)<Ra?lL(t):(u=g-S,f=_-P,h=x-A,p=1/Math.hypot(u,f,h),u*=p,f*=p,h*=p,r=v*h-w*f,s=w*u-y*h,o=y*f-v*u,p=Math.hypot(r,s,o),p?(p=1/p,r*=p,s*=p,o*=p):(r=0,s=0,o=0),a=f*o-h*s,l=h*r-u*o,c=u*s-f*r,p=Math.hypot(a,l,c),p?(p=1/p,a*=p,l*=p,c*=p):(a=0,l=0,c=0),t[0]=r,t[1]=a,t[2]=u,t[3]=0,t[4]=s,t[5]=l,t[6]=f,t[7]=0,t[8]=o,t[9]=c,t[10]=h,t[11]=0,t[12]=-(r*g+s*_+o*x),t[13]=-(a*g+l*_+c*x),t[14]=-(u*g+f*_+h*x),t[15]=1,t)}function EL(){var t=new Ar(4);return Ar!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function D_(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Fr(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,t}(function(){var t=EL();return function(e,n,i,r,s,o){var a,l;for(n||(n=4),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Of;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Of||(Of={}));const wL=45*Math.PI/180,xL=1,lu=.1,cu=500,TL=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Ue extends aL{static get IDENTITY(){return PL()}static get ZERO(){return SL()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Of}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,r,s,o,a,l,c,u,f,h,p,g,_,x){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=f,this[11]=h,this[12]=p,this[13]=g,this[14]=_,this[15]=x,this.check()}setRowMajor(e,n,i,r,s,o,a,l,c,u,f,h,p,g,_,x){return this[0]=e,this[1]=s,this[2]=c,this[3]=p,this[4]=n,this[5]=o,this[6]=u,this[7]=g,this[8]=i,this[9]=a,this[10]=f,this[11]=_,this[12]=r,this[13]=l,this[14]=h,this[15]=x,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(TL)}fromObject(e){return this.check()}fromQuaternion(e){return dL(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:r,top:s,near:o=lu,far:a=cu}=e;return a===1/0?bL(this,n,i,r,s,o):pL(this,n,i,r,s,o,a),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:r=[0,1,0]}=e;return _L(this,n,i,r),this.check()}ortho(e){const{left:n,right:i,bottom:r,top:s,near:o=lu,far:a=cu}=e;return yL(this,n,i,r,s,o,a),this.check()}orthographic(e){const{fovy:n=wL,aspect:i=xL,focalDistance:r=1,near:s=lu,far:o=cu}=e;am(n);const a=n/2,l=r*Math.tan(a),c=l*i;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:r=.1,far:s=500}=e;return am(n),mL(this,n,i,r,s),this.check()}determinant(){return uL(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*r,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*r,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return cL(this,this),this.check()}invert(){return Rf(this,this),this.check()}multiplyLeft(e){return xi(this,e,this),this.check()}multiplyRight(e){return xi(this,this,e),this.check()}rotateX(e){return N_(this,this,e),this.check()}rotateY(e){return hL(this,this,e),this.check()}rotateZ(e){return F_(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return fL(this,this,e,n),this.check()}scale(e){return od(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return vl(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Fr(n||[-0,-0,-0,-0],e,this),su(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let r;switch(i){case 2:r=WC(n||[-0,-0],e,this);break;case 3:r=O_(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return su(r,e.length),r}transformAsVector(e,n){let i;switch(e.length){case 2:i=HC(n||[-0,-0],e,this);break;case 3:i=I_(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return su(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let sa,oa;function SL(){return sa||(sa=new Ue([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(sa)),sa}function PL(){return oa||(oa=new Ue,Object.freeze(oa)),oa}function am(t){if(t>Math.PI*2)throw Error("expected radians")}function bL(t,e,n,i,r,s){const o=2*s/(n-e),a=2*s/(r-i),l=(n+e)/(n-e),c=(r+i)/(r-i),u=-1,f=-1,h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=f,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}const lm=1e-6,AL=6371e3;class Yl{constructor({phi:e=0,theta:n=0,radius:i=1,bearing:r,pitch:s,altitude:o,radiusScale:a=AL}={}){d(this,"phi",void 0),d(this,"theta",void 0),d(this,"radius",void 0),d(this,"radiusScale",void 0),this.phi=e,this.theta=n,this.radius=i||o||1,this.radiusScale=a||1,r!==void 0&&(this.bearing=r),s!==void 0&&(this.pitch=s),this.check()}toString(){return this.formatString(Ke)}formatString({printTypes:e=!1}){const n=A_;return"".concat(e?"Spherical":"","[rho:").concat(n(this.radius),",theta:").concat(n(this.theta),",phi:").concat(n(this.phi),"]")}equals(e){return mn(this.radius,e.radius)&&mn(this.theta,e.theta)&&mn(this.phi,e.phi)}exactEquals(e){return this.radius===e.radius&&this.theta===e.theta&&this.phi===e.phi}get bearing(){return 180-Bi(this.phi)}set bearing(e){this.phi=Math.PI-ia(e)}get pitch(){return Bi(this.theta)}set pitch(e){this.theta=ia(e)}get longitude(){return Bi(this.phi)}get latitude(){return Bi(this.theta)}get lng(){return Bi(this.phi)}get lat(){return Bi(this.theta)}get z(){return(this.radius-1)*this.radiusScale}set(e,n,i){return this.radius=e,this.phi=n,this.theta=i,this.check()}clone(){return new Yl().copy(this)}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this.check()}fromLngLatZ([e,n,i]){return this.radius=1+i/this.radiusScale,this.phi=ia(n),this.theta=ia(e),this.check()}fromVector3(e){return this.radius=R_(e),this.radius>0&&(this.theta=Math.atan2(e[0],e[1]),this.phi=Math.acos(ge(e[2]/this.radius,-1,1))),this.check()}toVector3(){return new bt(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}makeSafe(){return this.phi=Math.max(lm,Math.min(Math.PI-lm,this.phi)),this}check(){if(!Number.isFinite(this.phi)||!Number.isFinite(this.theta)||!(this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}var cm=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`;const CL={lightSources:{}};function uu({color:t=[0,0,0],intensity:e=1}={}){return t.map(n=>n*e/255)}function LL({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const i={};return t?i["lighting_uAmbientLight.color"]=uu(t):i["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((r,s)=>{i[`lighting_uPointLight[${s}].color`]=uu(r),i[`lighting_uPointLight[${s}].position`]=r.position,i[`lighting_uPointLight[${s}].attenuation`]=r.attenuation||[1,0,0]}),i.lighting_uPointLightCount=e.length,n.forEach((r,s)=>{i[`lighting_uDirectionalLight[${s}].color`]=uu(r),i[`lighting_uDirectionalLight[${s}].direction`]=r.direction}),i.lighting_uDirectionalLightCount=n.length,i}function z_(t=CL){if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},LL({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return z_({lightSources:e})}return{}}const U_={name:"lights",vs:cm,fs:cm,getUniforms:z_,defines:{MAX_LIGHTS:3}},ML=new Uint8Array([0,255,255,255]),IL={pickingSelectedColor:null,pickingHighlightColor:ML,pickingActive:!1,pickingAttribute:!1};function RL(t=IL){const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}const OL=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,kL=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,NL={name:"picking",vs:OL,fs:kL,getUniforms:RL};var B_=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`;const FL={};function DL(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map(s=>s/255)}}function V_(t=FL){if(!("material"in t))return{};const{material:e}=t;return e?DL(e):{lighting_uEnabled:!1}}const ad={name:"gouraud-lighting",dependencies:[U_],vs:B_,defines:{LIGHTING_VERTEX:1},getUniforms:V_},zL={name:"phong-lighting",dependencies:[U_],fs:B_,defines:{LIGHTING_FRAGMENT:1},getUniforms:V_},UL=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,BL={name:"transform",vs:UL,fs:null};class mo{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new mo(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(e={}){const{vs:n="",fs:i="",defines:r={},inject:s={},varyings:o=[],bufferMode:a=35981,transpileToGLSL100:l=!1}=e,c=this._getModuleList(e.modules),u=this._getHash(n),f=this._getHash(i),h=c.map(w=>this._getHash(w.name)).sort(),p=o.map(w=>this._getHash(w)),g=Object.keys(r).sort(),_=Object.keys(s).sort(),x=[],y=[];for(const w of g)x.push(this._getHash(w)),x.push(this._getHash(r[w]));for(const w of _)y.push(this._getHash(w)),y.push(this._getHash(s[w]));const v=`${u}/${f}D${x.join("/")}M${h.join("/")}I${y.join("/")}V${p.join("/")}H${this.stateHash}B${a}${l?"T":""}`;if(!this._programCache[v]){const w=xC(this.gl,{vs:n,fs:i,modules:c,inject:s,defines:r,hookFunctions:this._hookFunctions,transpileToGLSL100:l});this._programCache[v]=new v_(this.gl,{hash:v,vs:w.vs,fs:w.fs,varyings:o,bufferMode:a}),this._getUniforms[v]=w.getUniforms||(S=>{}),this._useCounts[v]=0}return this._useCounts[v]++,this._programCache[v]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[r++]=a,i[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;i[l]||(n[r++]=a,i[l]=!0)}return n.length=r,n}}const VL={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function jL(t,e,n){const i={};let r=e.indices;for(const s in e.attributes){const o=e.attributes[s],a=GL(s,n);if(s==="indices")r=o;else if(o.constant)i[a]=o.value;else{const l=o.value,c={...o};delete c.value,i[a]=[new Q(t,l),c],WL(s,c)}}if(r){const s=r.value||r;k(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const o={size:1,isIndexed:r.isIndexed===void 0?!0:r.isIndexed};i.indices=[new Q(t,{data:s,target:34963}),o]}return i}function GL(t,e){const{attributeMap:n=VL}=e||{};return n&&n[t]||t}function WL(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}k(Number.isFinite(e.size),`attribute ${t} needs size`)}const Vi=2,HL=1e4,$L="Model needs drawMode and vertexCount",um=()=>{},XL={};class At{constructor(e,n={}){const{id:i=en("model")}=n;k(Hl(e)),this.id=i,this.gl=e,this.id=n.id||en("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||mo.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},k(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),$L)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return k(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return k(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=jL(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(e={}){if(Sr(e))return this;const n={};for(const i in e){const r=e[i];n[i]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(n),this}setUniforms(e={}){return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return ed(this.program.gl,e),this}draw(e={}){this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:r={},attributes:s={},transformFeedback:o=this.transformFeedback,parameters:a={},vertexArray:l=this.vertexArray}=e;this.setAttributes(s),this.updateModuleSettings(n),this.setUniforms(r);let c;z.priority>=Vi&&(c=this._logDrawCallStart(Vi));const u=this.vertexArray.getDrawParams(),{isIndexed:f=u.isIndexed,indexType:h=u.indexType,indexOffset:p=u.indexOffset,vertexArrayInstanced:g=u.isInstanced}=this.props;g&&!this.isInstanced&&z.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:_,instanceCount:x}=this,{onBeforeRender:y=um,onAfterRender:v=um}=this.props;y(),this.program.setUniforms(this.uniforms);const w=this.program.draw(Object.assign(XL,e,{logPriority:c,uniforms:null,framebuffer:i,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:l,transformFeedback:o,isIndexed:f,indexType:h,isInstanced:_,instanceCount:x,offset:f?p:0}));return v(),z.priority>=Vi&&this._logDrawCallEnd(c,l,i),w}transform(e={}){const{discard:n=!0,feedbackBuffers:i,unbindModels:r=[]}=e;let{parameters:s}=e;i&&this._setFeedbackBuffers(i),n&&(s=Object.assign({},s,{[35977]:n})),r.forEach(o=>o.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:s}))}finally{r.forEach(o=>o.vertexArray.bindBuffers())}return this}render(e={}){return z.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:r,modules:s,inject:o,defines:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=this.programProps;n=this.programManager.get({vs:i,fs:r,modules:s,inject:o,defines:a,varyings:l,bufferMode:c,transpileToGLSL100:u}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}k(n instanceof v_,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new DA(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof Q&&n.delete()}}_setAnimationProps(e){this.animated&&k(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(e={}){if(Sr(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new y_(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:HL;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),z.group(Vi,`>>> DRAWING MODEL ${this.id}`,{collapsed:z.level<=2})(),e}_logDrawCallEnd(e,n,i,r){if(e===void 0)return;const s=BA({vertexArray:n,header:`${this.id} attributes`,attributes:this._attributes}),{table:o,unusedTable:a,unusedCount:l}=Zg({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:c,count:u}=Zg({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});u>0&&z.log("MISSING UNIFORMS",Object.keys(c))(),l>0&&z.log("UNUSED UNIFORMS",Object.keys(a))();const f=jA(this.vertexArray.configuration);z.table(e,s)(),z.table(e,o)(),z.table(e+1,f)(),r&&r.log({logLevel:Vi,message:`Rendered to ${r.id}`}),z.groupEnd(Vi,`>>> DRAWING MODEL ${this.id}`)()}}class YL{constructor(e,n={}){this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(e={}){const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(e={}){const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:r}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:r}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(e={}){this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof Q?i:i.buffer:null}getData(e={}){const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(e={}){this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&k(X(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const r in this.feedbackMap){const s=this.feedbackMap[r];r in n&&(i[s]=r)}Object.assign(i,e.feedbackBuffers);for(const r in i){const s=i[r];if(typeof s=="string"){const o=n[s],{byteLength:a,usage:l,accessor:c}=o;i[r]=this._createNewBuffer(r,{byteLength:a,usage:l,accessor:c})}}return i}_setupBuffers(e={}){const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,{model:n}){const{program:i}=n;e.transformFeedback=new y_(this.gl,{program:i,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const r in this.feedbackMap){const s=this.feedbackMap[r];n[r]=e.feedbackBuffers[s],i[s]=e.sourceBuffers[r],k(i[s]instanceof Q)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new Q(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const ZL="transform_uSampler_",yl="transform_uSize_",fm="transform_position";function KL({vs:t,sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}){let s=Object.keys(e).length,o=null;const a={};let l=t,c={};if(s>0||n){const u=l.split(`
`),f=u.slice();if(u.forEach((h,p,g)=>{if(s>0){const _=t2(h,e);if(_){const{updatedLine:x,inject:y}=_;f[p]=x,c=Lf([c,y]),Object.assign(a,_.samplerTextureMap),s--}}n&&!o&&(o=e2(h,n))}),n){k(i);const h=`${yl}${n}`,p=`uniform vec2 ${h};
`,g=`     vec2 ${fm} = transform_getPos(${h});
     gl_Position = vec4(${fm}, 0, 1.);
`;c=Lf([c,{"vs:#decl":p,"vs:#main-start":g}])}l=f.join(`
`)}return{vs:l,targetTextureType:o,inject:c,samplerTextureMap:a}}function qL({sourceTextureMap:t,targetTextureVarying:e,targetTexture:n}){const i={};let r,s;e&&({width:r,height:s}=n,i[`${yl}${e}`]=[r,s]);for(const o in t)({width:r,height:s}=t[o]),i[`${yl}${o}`]=[r,s];return i}function QL(t){return P_(t,["attribute","in"])}function JL(t){const e=`${ZL}${t}`,n=`${yl}${t}`,i=`  uniform sampler2D ${e};
  uniform vec2 ${n};`;return{samplerName:e,sizeName:n,uniformDeclerations:i}}function e2(t,e){const n=P_(t,["varying","out"]);return n&&n.name===e?n.type:null}function t2(t,e){const n={},i=QL(t);if(!i)return null;const{type:r,name:s}=i;if(s&&e[s]){const o=`// ${t} => Replaced by Transform with a sampler`,{samplerName:a,sizeName:l,uniformDeclerations:c}=JL(s),u=IC(r),f=`  ${r} ${s} = transform_getInput(${a}, ${l}).${u};
`;return n[a]=s,{updatedLine:o,inject:{"vs:#decl":c,"vs:#main-start":f},samplerTextureMap:n}}return null}const n2={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},i2="transform_output";class r2{constructor(e,n={}){this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(e={}){const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(e={}){const{sourceBuffers:n,sourceTextures:i,framebuffer:r,targetTexture:s}=this.bindings[this.currentIndex],o=Object.assign({},n,e.attributes),a=Object.assign({},e.uniforms),l=Object.assign({},e.parameters);let c=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const f in this.samplerTextureMap){const h=this.samplerTextureMap[f];a[f]=i[h]}this._setSourceTextureParameters();const u=qL({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(a,u)}return this.hasTargetTexture&&(c=!1,l.viewport=[0,0,r.width,r.height]),{attributes:o,framebuffer:r,uniforms:a,discard:c,parameters:l}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(e={}){this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData({packed:e=!1}={}){const{framebuffer:n}=this.bindings[this.currentIndex],i=Xl(n);if(!e)return i;const r=i.constructor,s=RC(this.targetTextureType),o=new r(i.length*s/4);let a=0;for(let l=0;l<i.length;l+=4)for(let c=0;c<s;c++)o[a++]=i[l+c];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(e={}){const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof et)return i;const r=n[i];return r?(this._targetRefTexName=i,this._createNewTexture(r)):null}_setupTextures(e={}){const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:r}=e,s=this._createTargetTexture({sourceTextures:i,textureOrReference:r});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,r,s)=>{s[r]=r}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new Q(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:r,targetTexture:s}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),Object.assign(e.sourceBuffers,i),s){e.targetTexture=s;const{width:o,height:a}=s,{framebuffer:l}=e;l?(l.update({attachments:{[36064]:s},resizeAttachments:!1}),l.resize({width:o,height:a})):e.framebuffer=new _e(this.gl,{id:"transform-framebuffer",width:o,height:a,attachments:{[36064]:s}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(n2)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=d_(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(e={}){const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:r,uniforms:s,targetTextureType:o,inject:a,samplerTextureMap:l}=KL({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),c=Lf([e.inject||{},a]);this.targetTextureType=o,this.samplerTextureMap=l;const u=e._fs||b_({version:g_(r),input:this.targetTextureVarying,inputType:o,output:i2}),f=this.hasSourceTextures||this.targetTextureVarying?[BL].concat(e.modules||[]):e.modules;return{vs:r,fs:u,modules:f,uniforms:s,inject:c}}}class ld{static isSupported(e){return X(e)}constructor(e,n={}){this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(e={}){const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();k(e,"Nothing to swap")}getBuffer(e=null){return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(e={}){const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const r=i.getData(e);if(r)return r}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(e={}){"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(e={}){const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new At(n,Object.assign({},e,{fs:e.fs||b_({version:g_(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=r.updateModelProps(n);return n}_buildResourceTransforms(e,n){s2(n)&&(this.bufferTransform=new YL(e,n)),o2(n)&&(this.textureTransform=new r2(e,n)),k(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=Object.assign(n,r.getDrawOptions(n));return n}}function s2(t){return!!(!Sr(t.feedbackBuffers)||!Sr(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function o2(t){return!!(!Sr(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const hm={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class jt{static get DRAW_MODE(){return hm}constructor(e={}){const{id:n=en("geometry"),drawMode:i=hm.TRIANGLES,attributes:r={},indices:s=null,vertexCount:o=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(r,s),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let r=e[i];r=ArrayBuffer.isView(r)?{value:r}:r,k(ArrayBuffer.isView(r.value),`${this._print(i)}: must be typed array or object with value as typed array`),(i==="POSITION"||i==="positions")&&!r.size&&(r.size=3),i==="indices"?(k(!this.indices),this.indices=r):this.attributes[i]=r}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const r in e){const s=e[r],{value:o,size:a,constant:l}=s;!l&&o&&a>=1&&(i=Math.min(i,o.length/a))}return k(Number.isFinite(i)),i}}const a2=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),l2=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),c2=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),u2=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),f2={POSITION:{size:3,value:new Float32Array(l2)},NORMAL:{size:3,value:new Float32Array(c2)},TEXCOORD_0:{size:2,value:new Float32Array(u2)}};class h2 extends jt{constructor(e={}){const{id:n=en("cube-geometry")}=e;super({...e,id:n,indices:{size:1,value:new Uint16Array(a2)},attributes:{...f2,...e.attributes}})}}let d2=1,p2=1;class j_{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=e,o=d2++,a={time:0,delay:n,duration:i,rate:r,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:s,channel:o}=r;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=p2++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,r=e.duration*e.repeat;i>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const G_="#define SMOOTH_EDGE_RADIUS 0.5",g2=`
`.concat(G_,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),m2=`
`.concat(G_,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`);var v2={name:"geometry",vs:g2,fs:m2};const Z={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Z,"IDENTITY",{get:()=>(W.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Nt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ht={common:0,meters:1,pixels:2},dm={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},vo={DRAW:"draw",MASK:"mask"},y2=Object.keys(Z).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(Z[t],";")).join(""),_2=Object.keys(Nt).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(Nt[t],";")).join(""),E2=Object.keys(ht).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(ht[t],";")).join("");var w2="".concat(y2,`
`).concat(_2,`
`).concat(E2,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0; // meters
const float GLOBE_RADIUS = 256.0;

// returns an adjustment factor for uCommonUnitsPerMeter
float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {

    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear
    // Adjust by 1 / cos(latitude)
    // If geometry.position (vertex in common space) is populated, use it
    // Otherwise use geometry.worldPosition (anchor in world space)
    
    if (geometry.position.w == 0.0) {
      float y = clamp(geometry.worldPosition.y, -89.9, 89.9);
      return 1.0 / cos(radians(y));
    }

    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)
    // Taylor series of 1 / cos(latitude)
    // Max error < 0.003
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}
//
// Scaling offsets - scales meters to "world distance"
// Note the scalar version of project_size is for scaling the z component only
//
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}

// Get rotation matrix that aligns the z axis with the given up vector
// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  // Tangent on XY plane
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}

//
// Projecting normal - transform deltas from current coordinate system to
// normals in the worldspace
//
vec3 project_normal(vec3 vector) {
  // Apply model matrix
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

//
// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]
//
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

//
// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)
//
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;

  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size(position_world.z),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        // Too far from the projection center for offset mode to be accurate
        // Only use high parts
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.
    position_world.xyz -= project_uCoordinateOrigin;
  }

  // Translation is already added to the high parts
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}

//
// Projects from common space coordinates to clip space.
// Uses project_uViewProjectionMatrix
//
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}

// Returns a clip space offset that corresponds to a given number of screen pixels
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  // UNIT_PIXELS
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function x2(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Zl(t){let e={},n;return i=>{for(const r in i)if(!x2(i[r],e[r])){n=t(i),e=i;break}return n}}const pm=[0,0,0,0],T2=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],W_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],S2=[0,0,0],H_=[0,0,0],P2=Zl(C2);function $_(t,e,n=H_){n.length<3&&(n=[n[0],n[1],0]);let i=n,r,s=!0;switch(e===Z.LNGLAT_OFFSETS||e===Z.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Nt.WEB_MERCATOR:(e===Z.LNGLAT||e===Z.CARTESIAN)&&(r=[0,0,0],s=!1);break;case Nt.WEB_MERCATOR_AUTO_OFFSET:e===Z.LNGLAT?i=r:e===Z.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case Nt.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case Nt.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:s}}function b2(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=pm,l=pm,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:f,offsetMode:h}=$_(t,e,n);return h&&(l=t.projectPosition(u||f),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=Fr([],l,o),s=i||s,o=xi([],r,s),o=xi([],o,T2)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:u}}function A2({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=Z.DEFAULT,coordinateOrigin:r=H_,autoWrapLongitude:s=!1}){i===Z.DEFAULT&&(i=t.isGeospatial?Z.LNGLAT:Z.CARTESIAN);const o=P2({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||W_,o}function C2({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=b2(t,n,i),u=t.getDistanceScales(),f=[t.width*e,t.height*e],h=Fr([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,p={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:r,project_uPseudoMeters:Boolean(t._pseudoMeters),project_uViewportSize:f,project_uDevicePixelRatio:e,project_uFocalDistance:h,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:S2,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:W_,project_uCameraPosition:a};if(c){const g=t.getDistanceScales(c);switch(n){case Z.METER_OFFSETS:p.project_uCommonUnitsPerWorldUnit=g.unitsPerMeter,p.project_uCommonUnitsPerWorldUnit2=g.unitsPerMeter2;break;case Z.LNGLAT:case Z.LNGLAT_OFFSETS:t._pseudoMeters||(p.project_uCommonUnitsPerMeter=g.unitsPerMeter),p.project_uCommonUnitsPerWorldUnit=g.unitsPerDegree,p.project_uCommonUnitsPerWorldUnit2=g.unitsPerDegree2;break;case Z.CARTESIAN:p.project_uCommonUnitsPerWorldUnit=[1,1,g.unitsPerMeter[2]],p.project_uCommonUnitsPerWorldUnit2=[0,0,g.unitsPerMeter2[2]];break}}return p}const L2={};function M2(t=L2){return"viewport"in t?A2(t):{}}var cd={name:"project",dependencies:[NC,v2],vs:w2,getUniforms:M2};const I2=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`;var tn={name:"project32",dependencies:[cd],vs:I2};function R2(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function dr(t,e){const n=Fr([],e,t);return D_(n,n,1/n[3]),n}function gm(t,e){const n=t%e;return n<0?e+n:n}function kf(t,e,n){return t<e?e:t>n?n:t}function O2(t){return Math.log(t)*Math.LOG2E}const ud=Math.log2||O2;function Tn(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Ft=Math.PI,X_=Ft/4,Bt=Ft/180,Nf=180/Ft,Ks=512,Ff=4003e4,aa=85.051129,k2=1.5;function N2(t){return ud(t)}function Cr(t){const[e,n]=t;Tn(Number.isFinite(e)),Tn(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*Bt,r=n*Bt,s=Ks*(i+Ft)/(2*Ft),o=Ks*(Ft+Math.log(Math.tan(X_+r*.5)))/(2*Ft);return[s,o]}function Lr(t){const[e,n]=t,i=e/Ks*(2*Ft)-Ft,r=2*(Math.atan(Math.exp(n/Ks*(2*Ft)-Ft))-X_);return[i*Nf,r*Nf]}function Y_(t){const{latitude:e}=t;Tn(Number.isFinite(e));const n=Math.cos(e*Bt);return N2(Ff*n)-9}function Df(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;Tn(Number.isFinite(e)&&Number.isFinite(n));const r=Ks,s=Math.cos(e*Bt),o=r/360,a=o/s,l=r/Ff/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(i){const u=Bt*Math.tan(e*Bt)/s,f=o*u/2,h=r/Ff*u,p=h/a*l;c.unitsPerDegree2=[0,f,h],c.unitsPerMeter2=[p,0,p]}return c}function Z_(t,e){const[n,i,r]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Df({longitude:n,latitude:i,highPrecision:!0}),u=Cr(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const f=Lr(u),h=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[f[0],f[1],h]:f}function F2(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:s,center:o}=t,a=R2();vl(a,a,[0,0,-r]),N_(a,a,-n*Bt),F_(a,a,i*Bt);const l=s/e;return od(a,a,[l,l,l]),o&&vl(a,a,KC([],o)),a}function D2(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=_l(k2)}=t;i!==void 0&&(u=_l(i));const f=u*Bt,h=r*Bt,p=fd(u);let g=p;o&&(g+=o[2]*a/Math.cos(h)/n);const _=f*(.5+(s?s[1]:0)/n),x=Math.sin(_)*g/Math.sin(kf(Math.PI/2-h-_,.01,Math.PI-.01)),y=Math.sin(h)*x+g,v=g*10,w=Math.min(y*c,v);return{fov:f,aspect:e/n,focalDistance:p,near:l,far:w}}function _l(t){return 2*Math.atan(.5/t)*Nf}function fd(t){return .5/Math.tan(.5*t*Bt)}function K_(t,e){const[n,i,r=0]=t;return Tn(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),dr(e,[n,i,r,1])}function yo(t,e,n=0){const[i,r,s]=t;if(Tn(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return dr(e,[i,r,s,1]);const o=dr(e,[i,r,0,1]),a=dr(e,[i,r,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return M_([],o,a,u)}function q_(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=i,f=z2(t.padding),h=Cr([a,kf(u,-aa,aa)]),p=Cr([c,kf(l,-aa,aa)]),g=[Math.max(Math.abs(p[0]-h[0]),r),Math.max(Math.abs(p[1]-h[1]),r)],_=[e-f.left-f.right-Math.abs(o[0])*2,n-f.top-f.bottom-Math.abs(o[1])*2];Tn(_[0]>0&&_[1]>0);const x=_[0]/g[0],y=_[1]/g[1],v=(f.right-f.left)/2/x,w=(f.bottom-f.top)/2/y,S=[(p[0]+h[0])/2+v,(p[1]+h[1])/2+w],P=Lr(S),A=Math.min(s,ud(Math.abs(Math.min(x,y))));return Tn(Number.isFinite(A)),{longitude:P[0],latitude:P[1],zoom:A}}function z2(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Tn(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const mm=Math.PI/180;function U2(t,e=0){const{width:n,height:i,unproject:r}=t,s={targetZ:e},o=r([0,i],s),a=r([n,i],s);let l,c;const u=t.fovy?.5*t.fovy*mm:Math.atan(.5/t.altitude),f=(90-t.pitch)*mm;return u>f-.01?(l=vm(t,0,e),c=vm(t,n,e)):(l=r([0,0],s),c=r([n,0],s)),[o,a,c,l]}function vm(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=dr(i,[e,0,1,1]),s=dr(i,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),l=M_([],r,s,a),c=Lr(l);return c.push(n),c}const ym=512;function B2(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=t;(r<-180||r>180)&&(r=gm(r+180,360)-180),(a<-180||a>180)&&(a=gm(a+180,360)-180);const l=ud(n/ym);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=Lr([0,c])[1];if(s<u)s=u;else{const f=Lr([0,ym-c])[1];s>f&&(s=f)}}return{width:e,height:n,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}const V2=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,j2=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,G2=Zl(Y2),W2=Zl(Z2),H2=[0,0,0,1],$2=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function X2(t,e){const[n,i,r]=t,s=yo([n,i,r],e);return Number.isFinite(r)?s:[s[0],s[1],0]}function Y2({viewport:t,center:e}){return new Ue(t.viewProjectionMatrix).invert().transform(e)}function Z2({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,s=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>X2(o,i));for(const o of e){const a=o.clone().translate(new bt(t.center).negate()),l=s.map(u=>a.transform(u)),c=new Ue().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function K2(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||H2,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=G2({viewport:t.viewport,center:e.project_uCenter}),s=[],o=W2({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],c=l.clone().translate(new bt(t.viewport.center).negate());e.project_uCoordinateSystem===Z.LNGLAT&&e.project_uProjectionMode===Nt.WEB_MERCATOR?(o[a]=c,s[a]=r):(o[a]=l.clone().multiplyRight($2),s[a]=c.transform(r))}for(let a=0;a<o.length;a++)i["shadow_uViewProjectionMatrices[".concat(a,"]")]=o[a],i["shadow_uProjectCenters[".concat(a,"]")]=s[a],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(a)]=t.shadowMaps[a]:i["shadow_uShadowMap".concat(a)]=t.dummyShadowMap;return i}var fu={name:"shadow",dependencies:[cd],vs:V2,fs:j2,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?K2(t,e):{}},nn={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...NL};const q2=[cd],Q2=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function J2(t){const e=mo.getDefaultProgramManager(t);for(const n of q2)e.addDefaultModule(n);for(const n of Q2)e.addShaderHook(n);return e}const e3=[255,255,255],t3=1;let n3=0;class i3{constructor(e={}){d(this,"id",void 0),d(this,"color",void 0),d(this,"intensity",void 0),d(this,"type","ambient");const{color:n=e3}=e,{intensity:i=t3}=e;this.id=e.id||"ambient-".concat(n3++),this.color=n,this.intensity=i}}const r3=[255,255,255],s3=1,o3=[0,0,-1];let a3=0;class _m{constructor(e={}){d(this,"id",void 0),d(this,"color",void 0),d(this,"intensity",void 0),d(this,"type","directional"),d(this,"direction",void 0),d(this,"shadow",void 0);const{color:n=r3}=e,{intensity:i=s3}=e,{direction:r=o3}=e,{_shadow:s=!1}=e;this.id=e.id||"directional-".concat(a3++),this.color=n,this.intensity=i,this.type="directional",this.direction=new bt(r).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class l3{constructor(e,n={id:"pass"}){d(this,"id",void 0),d(this,"gl",void 0),d(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Kl extends l3{render(e){const n=this.gl;return xn(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:r,views:s,onViewportActive:o,clearCanvas:a=!0}=e;e.pass=e.pass||"unknown";const l=this.gl;a&&u3(l);const c=[];for(const u of r){const f=s&&s[u.id];o(u);const h=this._getDrawLayerParams(u,e),p=u.subViewports||[u];for(const g of p){const _=this._drawLayersInViewport(l,{target:n,moduleParameters:i,viewport:g,view:f,pass:e.pass,layers:e.layers},h);c.push(_)}}return c}_getDrawLayerParams(e,{layers:n,pass:i,layerFilter:r,cullRect:s,effects:o,moduleParameters:a}){const l=[],c=Q_(),u={layer:n[0],viewport:e,isPicking:i.startsWith("picking"),renderPass:i,cullRect:s},f={};for(let h=0;h<n.length;h++){const p=n[h],g=this._shouldDrawLayer(p,u,r,f),_={shouldDrawLayer:g};g&&(_.layerRenderIndex=c(p,g),_.moduleParameters=this._getModuleParameters(p,o,i,a),_.layerParameters=this.getLayerParameters(p,h,e)),l[h]=_}return l}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:r,target:s,viewport:o,view:a},l){const c=c3(e,{moduleParameters:i,target:s,viewport:o});if(a&&a.props.clear){const f=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;Tt(e,{scissorTest:!0,scissor:c},()=>ed(e,f))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};xn(e,{viewport:c});for(let f=0;f<n.length;f++){const h=n[f],{shouldDrawLayer:p,layerRenderIndex:g,moduleParameters:_,layerParameters:x}=l[f];if(p&&h.props.pickable&&u.pickableCount++,h.isComposite)u.compositeCount++;else if(p){u.visibleCount++,_.viewport=o;try{h._drawLayer({moduleParameters:_,uniforms:{layerIndex:g},parameters:x})}catch(y){h.raiseError(y,"drawing ".concat(h," to ").concat(r))}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(i){const a=n.layer.id;if(a in r||(r[a]=i(n)),!r[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,r){var s;const o=Object.assign(Object.create(((s=e.internalState)===null||s===void 0?void 0:s.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Tr(this.gl)});if(n)for(const l of n){var a;Object.assign(o,(a=l.getModuleParameters)===null||a===void 0?void 0:a.call(l,e))}return Object.assign(o,this.getModuleParameters(e,n),r)}}function Q_(t=0,e={}){const n={},i=(r,s)=>{const o=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in e)&&i(r.parent,!1),l in n){const u=n[l]=n[l]||Q_(e[l],e);c=u(r,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return i}function c3(t,{moduleParameters:e,target:n,viewport:i}){const r=n&&n.id!=="default-framebuffer",s=e&&e.devicePixelRatio||Tr(t),o=r?n.height:t.drawingBufferHeight,a=i;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function u3(t){const e=t.drawingBufferWidth,n=t.drawingBufferHeight;xn(t,{viewport:[0,0,e,n]}),t.clear(16640)}class f3 extends Kl{constructor(e,n){super(e,n),d(this,"shadowMap",void 0),d(this,"depthBuffer",void 0),d(this,"fbo",void 0),this.shadowMap=new et(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new ir(e,{format:33189,width:1,height:1}),this.fbo=new _e(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const n=this.fbo;Tt(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],r=Tr(this.gl),s=i.width*r,o=i.height*r;(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const h3={color:[255,255,255],intensity:1},Em=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],d3=[0,0,0,200/255];class J_{constructor(e={}){d(this,"id","lighting-effect"),d(this,"props",null),d(this,"shadowColor",d3),d(this,"shadow",void 0),d(this,"ambientLight",null),d(this,"directionalLights",[]),d(this,"pointLights",[]),d(this,"shadowPasses",[]),d(this,"shadowMaps",[]),d(this,"dummyShadowMap",null),d(this,"programManager",void 0),d(this,"shadowMatrices",void 0);for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow)}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}){if(!!this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=mo.getDefaultProgramManager(e),fu&&this.programManager.addDefaultModule(fu)),this.dummyShadowMap||(this.dummyShadowMap=new et(e,{width:1,height:1}));for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o,moduleParameters:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(fu),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new Ue().lookAt({eye:new bt(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new f3(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new i3(h3),this.directionalLights.push(new _m(Em[0]),new _m(Em[1])))}}class p3{constructor(e={}){d(this,"_pool",[]),d(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:r,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=r||e&&e.constructor||Float32Array,u=n*i+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let f=1/0;l&&(f=l*i+s);const h=this._allocate(c,u,a,f);return e&&o?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,n,i,r){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>r&&(s=r);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return i&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:r}=i,s=n.findIndex(o=>o.byteLength>=r);s<0?n.push(i):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,i),n.length>this.opts.poolSize&&n.shift()}}var Mr=new p3;function ds(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function El(t,e){const n=t%e;return n<0?e+n:n}function g3(t){return[t[12],t[13],t[14]]}function m3(t){return{left:ji(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:ji(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:ji(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:ji(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:ji(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:ji(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const wm=new bt;function ji(t,e,n,i){wm.set(t,e,n);const r=wm.len();return{distance:i/r,normal:new bt(-t/r,-e/r,-n/r)}}function v3(t){return t-Math.fround(t)}let rs;function hu(t,e){const{size:n=1,startIndex:i=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,s=(r-i)/n;rs=Mr.allocate(rs,s,{type:Float32Array,size:n*2});let o=i,a=0;for(;o<r;){for(let l=0;l<n;l++){const c=t[o++];rs[a+l]=c,rs[a+l+n]=v3(c)}a+=n*2}return rs.subarray(0,s*n*2)}const y3=Math.PI/180,_3=ds(),xm=[0,0,0],E3={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function w3({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:s,near:o,far:a}){const l=t/e,c=n?new Ue().orthographic({fovy:i,aspect:l,focalDistance:r,near:o,far:a}):new Ue().perspective({fovy:i,aspect:l,near:o,far:a});if(s){const{left:u=0,right:f=0,top:h=0,bottom:p=0}=s,g=ge((u+t-f)/2,0,t)-t/2,_=ge((h+e-p)/2,0,e)-e/2;c[8]-=g*2/t,c[9]+=_*2/e}return c}class rn{constructor(e={}){d(this,"id",void 0),d(this,"x",void 0),d(this,"y",void 0),d(this,"width",void 0),d(this,"height",void 0),d(this,"isGeospatial",void 0),d(this,"zoom",void 0),d(this,"focalDistance",void 0),d(this,"position",void 0),d(this,"modelMatrix",void 0),d(this,"distanceScales",void 0),d(this,"scale",void 0),d(this,"center",void 0),d(this,"cameraPosition",void 0),d(this,"projectionMatrix",void 0),d(this,"viewMatrix",void 0),d(this,"viewMatrixUncentered",void 0),d(this,"viewMatrixInverse",void 0),d(this,"viewProjectionMatrix",void 0),d(this,"pixelProjectionMatrix",void 0),d(this,"pixelUnprojectionMatrix",void 0),d(this,"resolution",void 0),d(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.distanceScales=e.distanceScales||E3,this.focalDistance=e.focalDistance||1,this.position=e.position||xm,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Nt.WEB_MERCATOR:Nt.WEB_MERCATOR_AUTO_OFFSET:Nt.IDENTITY}equals(e){return e instanceof rn?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&mn(e.projectionMatrix,this.projectionMatrix)&&mn(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),r=K_(i,this.pixelProjectionMatrix),[s,o]=r,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,r[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,l=i&&i*this.distanceScales.unitsPerMeter[2],c=yo([r,a,o],this.pixelUnprojectionMatrix,l),[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(i)?[u,f,i]:[u,f]}projectPosition(e){const[n,i]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,r]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,r]}projectFlat(e){if(this.isGeospatial){const n=Cr(e);return n[1]=ge(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Lr(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),r=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(i[0],r[0],s[0],o[0]),Math.min(i[1],r[1],s[1],o[1]),Math.max(i[0],r[0],s[0],o[0]),Math.max(i[1],r[1],s[1],o[1])]}getDistanceScales(e){return e?Df({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,m3(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=Y_({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Df({latitude:i,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:o}=e;let a=xm;if(s&&(a=o?new Ue(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,i,0]);this.center=new bt(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=_3,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Ue().multiplyRight(n).translate(new bt(this.center).negate()),this.projectionMatrix=i||w3({width:this.width,height:this.height,orthographic:r,fovyRadians:s||o*y3,focalDistance:u,padding:c,near:a,far:l});const f=ds();xi(f,f,this.projectionMatrix),xi(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=Rf([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=g3(this.viewMatrixInverse);const h=ds(),p=ds();od(h,h,[this.width/2,-this.height/2,1]),vl(h,h,[1,-1,0]),xi(p,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=p,this.pixelUnprojectionMatrix=Rf(ds(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||W.warn("Pixel project matrix not invertible")()}}d(rn,"displayName","Viewport");const x3=512,T3=4003e4,S3=Math.PI/180;function Tm(t){const e=Math.cos(t*S3);return x3/T3/e}class ei extends rn{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,orthographic:c=!1,projectionMatrix:u,repeat:f=!1,worldOffset:h=0,legacyMeterSizes:p=!1}=e;let{width:g,height:_,altitude:x=1.5}=e;const y=Math.pow(2,r);g=g||1,_=_||1;let v,w=null;u?(x=u[5]/2,v=_l(x)):(e.fovy?(v=e.fovy,x=fd(v)):v=_l(x),w=D2({width:g,height:_,pitch:s,fovy:v,nearZMultiplier:a,farZMultiplier:l}));let S=F2({height:_,pitch:s,bearing:o,scale:y,altitude:x});h&&(S=new Ue().translate([512*h,0,0]).multiplyLeft(S)),super({...e,width:g,height:_,viewMatrix:S,longitude:i,latitude:n,zoom:r,...w,fovy:v,focalDistance:x}),d(this,"longitude",void 0),d(this,"latitude",void 0),d(this,"pitch",void 0),d(this,"bearing",void 0),d(this,"altitude",void 0),d(this,"fovy",void 0),d(this,"orthographic",void 0),d(this,"_subViewports",void 0),d(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=s,this.bearing=o,this.altitude=x,this.fovy=v,this.orthographic=c,this._subViewports=f?[]:null,this._pseudoMeters=p,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=n;r<=i;r++){const s=r?new ei({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),r=(e[2]||0)*Tm(e[1]);return[n,i,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),r=(e[2]||0)/Tm(i);return[n,i,r]}addMetersToLngLat(e,n){return Z_(e,n)}panByPosition(e,n){const i=yo(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=ml([],r,L_([],i)),o=ml([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=U2(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:r}=this,{longitude:s,latitude:o,zoom:a}=q_({width:i,height:r,bounds:e,...n});return new ei({width:i,height:r,longitude:s,latitude:o,zoom:a})}}d(ei,"displayName","WebMercatorViewport");function du(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof ei){const[r,s,o=0]=t,a=e.getDistanceScales([r,s]);i[2]=o*a.unitsPerMeter[2]}return i}function P3(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return r===Z.DEFAULT&&(r=e.isGeospatial?Z.LNGLAT:Z.CARTESIAN),s===void 0&&(s=r),o===void 0&&(o=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function e1(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=Fr([],[o,a,l,1],n)),i){case Z.LNGLAT:return du([o,a,l],e,s);case Z.LNGLAT_OFFSETS:return du([o+r[0],a+r[1],l+(r[2]||0)],e,s);case Z.METER_OFFSETS:return du(Z_(r,[o,a,l]),e,s);case Z.CARTESIAN:default:return e.isGeospatial?[o+r[0],a+r[1],l+r[2]]:e.projectPosition([o,a,l])}}function b3(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=P3(e),{geospatialOrigin:l,shaderCoordinateOrigin:c,offsetMode:u}=$_(n,i,r),f=e1(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:u});if(u){const h=n.projectPosition(l||c);k_(f,f,h)}return f}const Wi={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},wl=Symbol.for("component"),pr=Symbol.for("asyncPropDefaults"),Li=Symbol.for("asyncPropOriginal"),Vn=Symbol.for("asyncPropResolved");function hd(t,e=()=>!0){return Array.isArray(t)?t1(t,e,[]):e(t)?[t]:[]}function t1(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?t1(r,e,n):e(r)&&n.push(r)}return n}function A3({target:t,source:e,start:n=0,count:i=1}){const r=e.length,s=i*r;let o=0;for(let a=n;o<r;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class C3{constructor(e,n,i){d(this,"id",void 0),d(this,"context",void 0),d(this,"isLoaded",void 0),d(this,"persistent",void 0),d(this,"_loadCount",0),d(this,"_subscribers",new Set),d(this,"_data",void 0),d(this,"_loader",void 0),d(this,"_error",void 0),d(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let r=e;typeof e=="string"&&(r=dl(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class L3{constructor({gl:e,protocol:n}){d(this,"protocol",void 0),d(this,"_context",void 0),d(this,"_resources",void 0),d(this,"_consumers",void 0),d(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}){let s=this._resources[e];s?s.setData(n,i):(s=new C3(e,n,this._context),this._resources[e]=s),s.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const r=n[i],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:r="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(i,r,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,r){const s=this._consumers,o=s[e]=s[e]||{},a=o[n]||{},l=a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),i&&(o[n]=a,a.onChange=r,a.resourceId=i.id,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const M3="layerManager.setLayers",I3="layerManager.activateViewport";class R3{constructor(e,{deck:n,stats:i,viewport:r,timeline:s}={}){d(this,"layers",void 0),d(this,"context",void 0),d(this,"resourceManager",void 0),d(this,"_lastRenderedLayers",[]),d(this,"_needsRedraw",!1),d(this,"_needsUpdate",!1),d(this,"_nextLayers",null),d(this,"_debug",!1),d(this,"activateViewport",o=>{Ne(I3,this,o),o&&(this.context.viewport=o)}),this.layers=[],this.resourceManager=new L3({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&J2(e),stats:i||new Hh({id:"deck.gl"}),viewport:r||new rn({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new j_,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Ne(M3,this,n,e),this._lastRenderedLayers=e;const i=hd(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const o of e)i[o.id]?W.warn("Multiple old layers with same id ".concat(o.id))():i[o.id]=o;const r=[];this._updateSublayersRecursively(n,i,r),this._finalizeOldLayers(i);let s=!1;for(const o of r)if(o.hasUniformTransition()){s="Uniform transition in ".concat(o);break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(e,n,i){for(const r of e){r.context=this.context;const s=n[r.id];s===null&&W.warn("Multiple new layers with same id ".concat(r.id))(),n[r.id]=null;let o=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),o=r.isComposite?r.getSubLayers():null}catch(a){this._handleError("matching",a,r)}o&&this._updateSublayersRecursively(o,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Wi.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Wi.MATCHED,n!==e&&(e.lifecycle=Wi.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Wi.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Wi.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Oi(t,e){if(t===e)return!0;if(!t||!e)return!1;for(const n in t){const i=t[n],r=e[n];if(!(i===r||Array.isArray(i)&&Array.isArray(r)&&Oi(i,r)))return!1}return!0}class O3{constructor(e){d(this,"width",void 0),d(this,"height",void 0),d(this,"views",void 0),d(this,"viewState",void 0),d(this,"controllers",void 0),d(this,"timeline",void 0),d(this,"_viewports",void 0),d(this,"_viewportMap",void 0),d(this,"_isUpdating",void 0),d(this,"_needsRedraw",void 0),d(this,"_needsUpdate",void 0),d(this,"_eventManager",void 0),d(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){const o=i[s];if(o.containsPixel(r)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=hd(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Oi(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):W.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>e.makeViewport({viewState:s,width:this.width,height:this.height})})}_updateController(e,n,i,r){const s=e.controller;if(s){const o={...n,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return r||(r=this._createController(e,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const s=e[r],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=Boolean(s.controller);c&&!l&&(i=!0),(i||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),this._viewports.unshift(a)}for(const r in n){const s=n[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,r)=>!e[r].equals(n[r]))}}const k3=/([0-9]+\.?[0-9]*)(%|px)/;function Rn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=k3.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function On(t,e){return t.relative?Math.round(t.position*e):t.position}function Pe(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class _o{constructor(e){d(this,"id",void 0),d(this,"viewportInstance",void 0),d(this,"_x",void 0),d(this,"_y",void 0),d(this,"_width",void 0),d(this,"_height",void 0),d(this,"_padding",void 0),d(this,"props",void 0);const{id:n,x:i=0,y:r=0,width:s="100%",height:o="100%",padding:a=null,viewportInstance:l}=e||{};Pe(!l||l instanceof rn),this.viewportInstance=l,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Rn(i),this._y=Rn(r),this._width=Rn(s),this._height=Rn(o),this._padding=a&&{left:Rn(a.left||0),right:Rn(a.right||0),top:Rn(a.top||0),bottom:Rn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Oi(this.props,e.props)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});return new this.ViewportType({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:On(this._x,e),y:On(this._y,n),width:On(this._width,e),height:On(this._height,n)};return this._padding&&(i.padding={left:On(this._padding.left,e),top:On(this._padding.top,n),right:On(this._padding.right,e),bottom:On(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Eo{constructor(e){d(this,"_inProgress",void 0),d(this,"_handle",void 0),d(this,"_timeline",void 0),d(this,"time",void 0),d(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:r}=this;this._handle=i.addChannel({delay:i.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Sm=()=>{};let qs;(function(t){t[t.BREAK=1]="BREAK",t[t.SNAP_TO_END=2]="SNAP_TO_END",t[t.IGNORE=3]="IGNORE"})(qs||(qs={}));const N3=t=>t,F3=qs.BREAK;class D3{constructor(e){d(this,"getControllerState",void 0),d(this,"props",void 0),d(this,"propsInTransition",void 0),d(this,"transition",void 0),d(this,"onViewStateChange",void 0),d(this,"onStateChange",void 0),d(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:r,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(i/a),u=r.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Eo(e.timeline),this.onViewStateChange=e.onViewStateChange||Sm,this.onStateChange=e.onStateChange||Sm}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;r={...i,...s===qs.SNAP_TO_END?o:this.propsInTransition||i}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&Boolean(i)}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===qs.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(i),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,r);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||N3,interpolator:s,interruption:n.transitionInterruption||F3,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class z3{constructor(e){d(this,"_propsToCompare",void 0),d(this,"_propsToExtract",void 0),d(this,"_requiredProps",void 0);const{compare:n,extract:i,required:r}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=r}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!mn(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},r={};for(const s of this._propsToExtract)(s in e||s in n)&&(i[s]=e[s],r[s]=n[s]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){!this._requiredProps||this._requiredProps.forEach(n=>{const i=e[n];Pe(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const U3=["longitude","latitude","zoom","bearing","pitch"],B3=["longitude","latitude","zoom"];class Dr extends z3{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:U3,required:B3},super(i.transitionProps),d(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:r,around:s}=this.opts;if(r&&s){const o=r(e),a=r(n),l=o.unproject(s);i.start.around=s,Object.assign(i.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const r={};for(const s of this._propsToExtract)r[s]=wi(e[s]||0,n[s]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...r});Object.assign(r,s.panByPosition(n.aroundPosition,wi(e.around,n.around,i)))}return r}}const kn={transitionDuration:0},V3=300,la=t=>1-(1-t)*(1-t),Gi={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},ui={};class wo{constructor(e){d(this,"props",void 0),d(this,"state",{}),d(this,"transitionManager",void 0),d(this,"eventManager",void 0),d(this,"onViewStateChange",void 0),d(this,"onStateChange",void 0),d(this,"makeViewport",void 0),d(this,"_controllerState",void 0),d(this,"_events",{}),d(this,"_interactionState",{isDragging:!1}),d(this,"_customEvents",[]),d(this,"_eventStartBlocked",null),d(this,"_panMove",!1),d(this,"invertPan",!1),d(this,"dragMode","rotate"),d(this,"inertia",0),d(this,"scrollZoom",!0),d(this,"dragPan",!0),d(this,"dragRotate",!0),d(this,"doubleClickZoom",!0),d(this,"touchZoom",!0),d(this,"touchRotate",!1),d(this,"keyboard",!0),this.transitionManager=new D3({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-i]}isPointInBounds(e,n){const{width:i,height:r}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?V3:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=Boolean(this.onViewStateChange);this.toggleEvents(Gi.WHEEL,u&&i),this.toggleEvents(Gi.PAN,u&&(r||s)),this.toggleEvents(Gi.PINCH,u&&(a||l)),this.toggleEvents(Gi.TRIPLE_PAN,u&&l),this.toggleEvents(Gi.DOUBLE_TAP,u&&o),this.toggleEvents(Gi.KEYBOARD,u&&c),this.scrollZoom=i,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const r={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(r,kn,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,kn,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:la},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,kn,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:la},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*i)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,kn,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,kn,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:la},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return ui._startPinchRotation=e.rotation,ui._lastPinchEvent=e,this.updateViewport(i,kn,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:ui._startPinchRotation-i})}return this.updateViewport(n,kn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ui._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=ui;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const r=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:r,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:la},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ui._startPinchRotation=null,ui._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(i).zoomOut(i):a.zoomOut(i),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(i).zoomIn(i):a.zoomIn(i),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(r),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(r),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(r),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(r),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?kn:e?{...n,transitionInterpolator:new Dr({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class dd{constructor(e,n){d(this,"_viewportProps",void 0),d(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Pm=5,j3=1.2;class n1 extends dd{constructor(e){const{width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:p=60,minPitch:g=0,startPanLngLat:_,startZoomLngLat:x,startRotatePos:y,startBearing:v,startPitch:w,startZoom:S,normalize:P=!0}=e;Pe(Number.isFinite(s)),Pe(Number.isFinite(r)),Pe(Number.isFinite(o)),super({width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:f,minZoom:h,maxPitch:p,minPitch:g,normalize:P,position:u},{startPanLngLat:_,startZoomLngLat:x,startRotatePos:y,startBearing:v,startPitch:w,startZoom:S}),d(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:o}=this.getState();if(!r||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,r,o,s):a={bearing:s+n,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=r+Math.log2(i);l=ge(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(s-n.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=ge(r,i,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=ge(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,B2(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,r){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),f=s/c;let h=0;o>0?Math.abs(u-l)>Pm&&(h=o/(l-u)*j3):o<0&&l>Pm&&(h=1-a/l),h=ge(h,-1,1);const{minPitch:p,maxPitch:g}=this.getViewportProps(),_=r+180*f;let x=i;return h>0?x=i+h*(g-i):h<0&&(x=i-h*(p-i)),{pitch:x,bearing:_}}}class G3 extends wo{constructor(...e){super(...e),d(this,"ControllerState",n1),d(this,"transition",{transitionDuration:300,transitionInterpolator:new Dr({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),d(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class i1 extends _o{get ViewportType(){return ei}get ControllerType(){return G3}}d(i1,"displayName","MapView");class W3 extends Kl{constructor(e,n){super(e,n),d(this,"maskMap",void 0),d(this,"fbo",void 0);const{mapSize:i=2048}=n;this.maskMap=new et(e,{width:i,height:i,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.fbo=new _e(e,{id:"maskmap",width:i,height:i,attachments:{[36064]:this.maskMap}})}render(e){const n=this.gl,i=[!1,!1,!1,!1];return i[e.channel]=!0,Tt(n,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:i,depthTest:!1},()=>super.render({...e,target:this.fbo,pass:"mask"}))}shouldDrawLayer(e){return e.props.operation===vo.MASK}delete(){this.fbo.delete(),this.maskMap.delete()}}const H3=new Ue().lookAt({eye:[0,0,1]});function $3({width:t,height:e,near:n,far:i,padding:r}){let s=-t/2,o=t/2,a=-e/2,l=e/2;if(r){const{left:c=0,right:u=0,top:f=0,bottom:h=0}=r,p=ge((c+t-u)/2,0,t)-t/2,g=ge((f+e-h)/2,0,e)-e/2;s-=p,o-=p,a+=g,l+=g}return new Ue().ortho({left:s,right:o,bottom:a,top:l,near:n,far:i})}class X3 extends rn{constructor(e){const{width:n,height:i,near:r=.1,far:s=1e3,zoom:o=0,target:a=[0,0,0],padding:l=null,flipY:c=!0}=e,u=Array.isArray(o)?o[0]:o,f=Array.isArray(o)?o[1]:o,h=Math.min(u,f),p=Math.pow(2,h);let g;if(u!==f){const _=Math.pow(2,u),x=Math.pow(2,f);g={unitsPerMeter:[_/p,x/p,1],metersPerUnit:[p/_,p/x,1]}}super({...e,longitude:void 0,position:a,viewMatrix:H3.clone().scale([p,p*(c?-1:1),p]),projectionMatrix:$3({width:n||1,height:i||1,padding:l,near:r,far:s}),zoom:h,distanceScales:g})}projectFlat([e,n]){const{unitsPerMeter:i}=this.distanceScales;return[e*i[0],n*i[1]]}unprojectFlat([e,n]){const{metersPerUnit:i}=this.distanceScales;return[e*i[0],n*i[1]]}panByPosition(e,n){const i=yo(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=ml([],r,L_([],i)),o=ml([],this.center,s);return{target:this.unprojectFlat(o)}}}class r1 extends dd{constructor(e){const{width:n,height:i,rotationX:r=0,rotationOrbit:s=0,target:o=[0,0,0],zoom:a=0,minRotationX:l=-90,maxRotationX:c=90,minZoom:u=-1/0,maxZoom:f=1/0,startPanPosition:h,startRotatePos:p,startRotationX:g,startRotationOrbit:_,startZoomPosition:x,startZoom:y}=e;super({width:n,height:i,rotationX:r,rotationOrbit:s,target:o,zoom:a,minRotationX:l,maxRotationX:c,minZoom:u,maxZoom:f},{startPanPosition:h,startRotatePos:p,startRotationX:g,startRotationOrbit:_,startZoomPosition:x,startZoom:y}),d(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const i=this.getState().startPanPosition||n;if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:a,height:l}=this.getViewportProps();if(!r||s===void 0||o===void 0)return this;let c;if(e){let u=(e[0]-r[0])/a;const f=(e[1]-r[1])/l;(s<-90||s>90)&&(u*=-1),c={rotationX:s+f*180,rotationOrbit:o+u*180}}else c={rotationX:s+i,rotationOrbit:o+n};return this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{rotationOrbit:r}=i;return Math.abs(r-n.rotationOrbit)>180&&(i.rotationOrbit=r<0?r+360:r-360),i}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomPosition:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const o=this._calculateNewZoom({scale:i,startZoom:r}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:i,minZoom:r}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const s=n+Math.log2(e);return ge(s,r,i)}_panFromCenter(e){const{width:n,height:i,target:r}=this.getViewportProps();return this.pan({startPosition:r,pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r,maxRotationX:s,minRotationX:o,rotationOrbit:a}=e;return e.zoom=Array.isArray(r)?[ge(r[0],i,n),ge(r[1],i,n)]:ge(r,i,n),e.rotationX=ge(e.rotationX,o,s),(a<-180||a>180)&&(e.rotationOrbit=El(a+180,360)-180),e}}class Y3 extends wo{constructor(...e){super(...e),d(this,"ControllerState",r1),d(this,"transition",{transitionDuration:300,transitionInterpolator:new Dr({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})})}}class Z3 extends r1{constructor(e){super(e),d(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:i,minZoom:r}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);let s=Math.log2(e);if(Array.isArray(n)){let[o,a]=n;switch(this.zoomAxis){case"X":o=ge(o+s,r,i);break;case"Y":a=ge(a+s,r,i);break;default:let l=Math.min(o+s,a+s);l<r&&(s+=r-l),l=Math.max(o+s,a+s),l>i&&(s+=i-l),o+=s,a+=s}return[o,a]}return ge(n+s,r,i)}}class K3 extends wo{constructor(...e){super(...e),d(this,"ControllerState",Z3),d(this,"transition",{transitionDuration:300,transitionInterpolator:new Dr(["target","zoom"])}),d(this,"dragMode","pan")}_onPanRotate(){return!1}}class s1 extends _o{get ViewportType(){return X3}get ControllerType(){return K3}}d(s1,"displayName","OrthographicView");function q3({layers:t,viewport:e}){let n=null;for(const s of t){const o=s.getBounds();o&&(n?(n[0]=Math.min(n[0],o[0][0]),n[1]=Math.min(n[1],o[0][1]),n[2]=Math.max(n[2],o[1][0]),n[3]=Math.max(n[3],o[1][1])):n=[o[0][0],o[0][1],o[1][0],o[1][1]])}const i=e.getBounds();if(!n)return i;const r=J3(i);return n[2]-n[0]<r[2]-r[0]||n[3]-n[1]<r[3]-r[1]||(n[0]=Math.max(n[0],r[0]),n[1]=Math.max(n[1],r[1]),n[2]=Math.min(n[2],r[2]),n[3]=Math.min(n[3],r[3])),n}function Q3({bounds:t,viewport:e,width:n,height:i}){if(t[2]<=t[0]||t[3]<=t[1])return null;const r=1;if(n-=r*2,i-=r*2,e instanceof ei){const{longitude:a,latitude:l,zoom:c}=q_({width:n,height:i,bounds:[[t[0],t[1]],[t[2],t[3]]],maxZoom:20});return new ei({longitude:a,latitude:l,zoom:c,x:r,y:r,width:n,height:i})}const s=[(t[0]+t[2])/2,(t[1]+t[3])/2,0],o=Math.min(20,n/(t[2]-t[0]),i/(t[3]-t[1]));return new s1({x:r,y:r}).makeViewport({width:n,height:i,viewState:{target:s,zoom:Math.log2(o)}})}function J3(t){const e={x:t[2]-t[0],y:t[3]-t[1]},n={x:t[0]+.5*e.x,y:t[1]+.5*e.y};return[n.x-e.x,n.y-e.y,n.x+e.x,n.y+e.y]}class eM{constructor(){d(this,"id","mask-effect"),d(this,"props",null),d(this,"useInPicking",!0),d(this,"dummyMaskMap",void 0),d(this,"channels",[]),d(this,"masks",null),d(this,"maskPass",void 0),d(this,"maskMap",void 0),d(this,"lastViewport",void 0)}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}){this.dummyMaskMap||(this.dummyMaskMap=new et(e,{width:1,height:1}));const a=n.filter(f=>f.props.visible&&f.props.operation===vo.MASK);if(a.length===0){this.masks=null,this.channels.length=0;return}this.masks={},this.maskPass||(this.maskPass=new W3(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const l=this._sortMaskChannels(a),c=r[0],u=!this.lastViewport||!this.lastViewport.equals(c);for(const f in l)this._renderChannel(l[f],{layerFilter:i,onViewportActive:s,views:o,viewport:c,viewportChanged:u})}_renderChannel(e,{layerFilter:n,onViewportActive:i,views:r,viewport:s,viewportChanged:o}){const a=this.channels[e.index];if(!a)return;const l=e===a||a.layers.length!==e.layers.length||e.layerBounds.some((c,u)=>c!==a.layerBounds[u]);if(e.bounds=a.bounds,e.maskBounds=a.maskBounds,this.channels[e.index]=e,(l||o)&&(this.lastViewport=s,e.bounds=q3({layers:e.layers,viewport:s}),l||!mn(e.bounds,a.bounds))){const{maskPass:c,maskMap:u}=this,f=Q3({bounds:e.bounds,viewport:s,width:u.width,height:u.height});e.maskBounds=f?f.getBounds():[0,0,1,1],c.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:n,viewports:f?[f]:[],onViewportActive:i,views:r,moduleParameters:{devicePixelRatio:1}})}this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem}}_sortMaskChannels(e){const n={};let i=0;for(const r of e){const{id:s}=r.root;let o=n[s];if(!o){if(++i>4){W.warn("Too many mask layers. The max supported is 4")();continue}o={id:s,index:this.channels.findIndex(a=>(a==null?void 0:a.id)===s),layers:[],layerBounds:[],coordinateOrigin:r.root.props.coordinateOrigin,coordinateSystem:r.root.props.coordinateSystem},n[s]=o}o.layers.push(r),o.layerBounds.push(r.getBounds())}for(let r=0;r<4;r++){const s=this.channels[r];(!s||!(s.id in n))&&(this.channels[r]=null)}for(const r in n){const s=n[r];s.index<0&&(s.index=this.channels.findIndex(o=>!o),this.channels[s.index]=s)}return n}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const tM=new J_;class nM{constructor(){d(this,"effects",void 0),d(this,"_internalEffects",void 0),d(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!Oi(e.effects,this.effects))&&(this.setEffects(e.effects),this._needsRedraw="effects changed")}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._internalEffects=e.slice(),this._internalEffects.push(new eM),e.some(n=>n instanceof J_)||this._internalEffects.push(tM)}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}}class iM extends Kl{shouldDrawLayer(e){return e.props.operation===vo.DRAW}}const bm={blendFunc:[1,0,32771,0],blendEquation:32774};class o1 extends Kl{constructor(...e){super(...e),d(this,"pickZ",void 0),d(this,"_colors",null)}render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:f,effects:h,pass:p="picking",pickZ:g}){const _=this.gl;this.pickZ=g;const x=g?null:{byLayer:new Map,byAlpha:[]};this._colors=x;const y=Tt(_,{scissorTest:!0,scissor:[a,l,c,u],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...bm,blend:!g},()=>super.render({target:o,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,cullRect:f,effects:h==null?void 0:h.filter(w=>w.useInPicking),pass:p}));return this._colors=null,{decodePickingColor:x&&sM.bind(null,x),stats:y}}shouldDrawLayer(e){return e.props.pickable&&e.props.operation===vo.DRAW}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const r={...e.props.parameters};return this._colors?(Object.assign(r,bm),r.blend=!0,r.blendColor=rM(this._colors,e,i)):r.blend=!1,r}}function rM(t,e,n){const{byLayer:i,byAlpha:r}=t;let s,o=i.get(e);return o?(o.viewports.push(n),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},i.set(e,o),r[s]=o):(W.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function sM(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const oM="deckRenderer.renderLayers";class aM{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new iM(e),this.pickLayersPass=new o1(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||_e.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const i=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,r=n.render({...e,target:i});this._postRender(e.effects,e),this.renderCount++,Ne(oM,this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){let i=null;for(const r of e)r.preRender(this.gl,n),r.postRender&&(i=r);i&&this._resizeRenderBuffers(),this.lastPostProcessEffect=i}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new _e(this.gl),new _e(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,r={inputBuffer:i[0],swapBuffer:i[1],target:null};for(const s of e)if(s.postRender){if(s===this.lastPostProcessEffect){r.target=n.target,s.postRender(this.gl,r);break}const o=s.postRender(this.gl,r);r.inputBuffer=o,r.swapBuffer=o===i[0]?i[1]:i[0]}}}const lM={pickedColor:null,pickedObjectIndex:-1};function cM({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=r*r,f=-1,h=0;for(let p=0;p<c;p++){const g=p+a-i,_=g*g;if(_>u)h+=4*l;else for(let x=0;x<l;x++){if(t[h+3]-1>=0){const v=x+o-n,w=v*v+_;w<=u&&(u=w,f=h)}h+=4}}if(f>=0){const p=t.slice(f,f+4),g=e(p);if(g){const _=Math.floor(f/4/l),x=f/4-_*l;return{...g,pickedColor:p,pickedX:o+x,pickedY:a+_}}W.error("Picked non-existent layer. Is picking buffer corrupt?")()}return lM}function uM({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const s=t.slice(i,i+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):W.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function a1({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:s}){let o=e[0];e.length>1&&(o=hM((t==null?void 0:t.pickedViewports)||e,{x:i,y:r}));let a;if(o){const l=[i-o.x,r-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function fM(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(i==="hover"){const f=n.index,h=n.layerId,p=o?o.props.id:null;if(p!==h||a!==f){if(p!==h){const g=r.find(_=>_.props.id===h);g&&l.unshift(g)}n.layerId=p,n.index=a,n.info=null}}const c=a1(t),u=new Map;return u.set(null,c),l.forEach(f=>{let h={...c};f===o&&(h.color=s,h.index=a,h.picked=!0),h=l1({layer:f,info:h,mode:i});const p=h.layer;f===o&&i==="hover"&&(n.info=h),u.set(p.id,h),i==="hover"&&p.updateAutoHighlight(h)}),u}function l1({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function hM(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class dM{constructor(e){d(this,"gl",void 0),d(this,"pickingFBO",void 0),d(this,"depthFBO",void 0),d(this,"pickLayersPass",void 0),d(this,"layerFilter",void 0),d(this,"lastPickedInfo",void 0),d(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new o1(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:r},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?i.find(h=>h.id===o):null,c=a&&r.find(h=>h.id===a)||r[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new _e(i),_e.isSupported(i,{colorBufferFloat:!0}))){const r=new _e(i);r.attach({[36064]:new et(i,{format:X(i)?34836:6408,type:5126})}),this.depthFBO=r}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>i.isPickable()&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:r,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){const h=this._getPickable(e),p=Tr(this.gl);if(!h)return{result:[],emptyInfo:a1({viewports:i,x:r,y:s,pixelRatio:p})};this._resizeBuffer();const g=Kc(this.gl,[r,s],!0),_=[g.x+Math.floor(g.width/2),g.y+Math.floor(g.height/2)],x=Math.round(o*p),{width:y,height:v}=this.pickingFBO,w=this._getPickingRect({deviceX:_[0],deviceY:_[1],deviceRadius:x,deviceWidth:y,deviceHeight:v}),S={x:r-o,y:s-o,width:o*2+1,height:o*2+1};let P;const A=[],C=new Set;for(let M=0;M<a;M++){let R;if(w){const U=this._drawAndSample({layers:h,views:n,viewports:i,onViewportActive:u,deviceRect:w,cullRect:S,effects:f,pass:"picking:".concat(l)});R=cM({...U,deviceX:_[0],deviceY:_[1],deviceRadius:x,deviceRect:w})}else R={pickedColor:null,pickedObjectIndex:-1};let O;R.pickedLayer&&c&&this.depthFBO&&(O=this._drawAndSample({layers:[R.pickedLayer],views:n,viewports:i,onViewportActive:u,deviceRect:{x:R.pickedX,y:R.pickedY,width:1,height:1},cullRect:S,effects:f,pass:"picking:".concat(l,":z")},!0).pickedColors[0]),R.pickedLayer&&M+1<a&&(C.add(R.pickedLayer),R.pickedLayer.disablePickingIndex(R.pickedObjectIndex)),P=fM({pickInfo:R,lastPickedInfo:this.lastPickedInfo,mode:l,layers:h,viewports:i,x:r,y:s,z:O,pixelRatio:p});for(const U of P.values())U.layer&&A.push(U);if(!R.pickedColor)break}for(const M of C)M.restorePickingColors();return{result:A,emptyInfo:P.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:r,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){const h=this._getPickable(e);if(!h)return[];this._resizeBuffer();const p=Tr(this.gl),g=Kc(this.gl,[r,s],!0),_=g.x,x=g.y+g.height,y=Kc(this.gl,[r+o,s+a],!0),v=y.x+y.width,w=y.y,S={x:_,y:w,width:v-_,height:x-w},P=this._drawAndSample({layers:h,views:n,viewports:i,onViewportActive:u,deviceRect:S,cullRect:{x:r,y:s,width:o,height:a},effects:f,pass:"picking:".concat(l)}),A=uM(P),C=new Map,M=Number.isFinite(c);for(let R=0;R<A.length&&!(M&&c&&C.size>=c);R++){const O=A[R];let U={color:O.pickedColor,layer:null,index:O.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:p};U=l1({layer:O.pickedLayer,info:U,mode:l}),C.has(U.object)||C.set(U.object,U)}return Array.from(C.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,{decodePickingColor:f}=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c}),{x:h,y:p,width:g,height:_}=s,x=new(c?Float32Array:Uint8Array)(g*_*4);return Xl(u,{sourceX:h,sourceY:p,sourceWidth:g,sourceHeight:_,target:x}),{pickedColors:x,decodePickingColor:f}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:s}){const o=Math.max(0,e-i),a=Math.max(0,n-i),l=Math.min(r,e+i+1)-o,c=Math.min(s,n+i+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const pM={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class gM{constructor(e){d(this,"el",null),d(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,pM),n.appendChild(this.el))}setTooltip(e,n,i){const r=this.el;if(!!r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className),Object.assign(r.style,e.style);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform="translate(".concat(n,"px, ").concat(i,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var c1={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,r){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,u=Date.now;function f(m,E,T){return setTimeout(w(m,T),E)}function h(m,E,T){return Array.isArray(m)?(p(m,T[E],T),!0):!1}function p(m,E,T){var b;if(!!m)if(m.forEach)m.forEach(E,T);else if(m.length!==r)for(b=0;b<m.length;)E.call(T,m[b],b,m),b++;else for(b in m)m.hasOwnProperty(b)&&E.call(T,m[b],b,m)}function g(m,E,T){var b="DEPRECATED METHOD: "+E+`
`+T+` AT 
`;return function(){var L=new Error("get-stack-trace"),N=L&&L.stack?L.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",$=e.console&&(e.console.warn||e.console.log);return $&&$.call(e.console,b,N),m.apply(this,arguments)}}var _;typeof Object.assign!="function"?_=function(E){if(E===r||E===null)throw new TypeError("Cannot convert undefined or null to object");for(var T=Object(E),b=1;b<arguments.length;b++){var L=arguments[b];if(L!==r&&L!==null)for(var N in L)L.hasOwnProperty(N)&&(T[N]=L[N])}return T}:_=Object.assign;var x=g(function(E,T,b){for(var L=Object.keys(T),N=0;N<L.length;)(!b||b&&E[L[N]]===r)&&(E[L[N]]=T[L[N]]),N++;return E},"extend","Use `assign`."),y=g(function(E,T){return x(E,T,!0)},"merge","Use `assign`.");function v(m,E,T){var b=E.prototype,L;L=m.prototype=Object.create(b),L.constructor=m,L._super=b,T&&_(L,T)}function w(m,E){return function(){return m.apply(E,arguments)}}function S(m,E){return typeof m==a?m.apply(E&&E[0]||r,E):m}function P(m,E){return m===r?E:m}function A(m,E,T){p(O(E),function(b){m.addEventListener(b,T,!1)})}function C(m,E,T){p(O(E),function(b){m.removeEventListener(b,T,!1)})}function M(m,E){for(;m;){if(m==E)return!0;m=m.parentNode}return!1}function R(m,E){return m.indexOf(E)>-1}function O(m){return m.trim().split(/\s+/g)}function U(m,E,T){if(m.indexOf&&!T)return m.indexOf(E);for(var b=0;b<m.length;){if(T&&m[b][T]==E||!T&&m[b]===E)return b;b++}return-1}function B(m){return Array.prototype.slice.call(m,0)}function j(m,E,T){for(var b=[],L=[],N=0;N<m.length;){var $=E?m[N][E]:m[N];U(L,$)<0&&b.push(m[N]),L[N]=$,N++}return T&&(E?b=b.sort(function(Ae,Be){return Ae[E]>Be[E]}):b=b.sort()),b}function H(m,E){for(var T,b,L=E[0].toUpperCase()+E.slice(1),N=0;N<s.length;){if(T=s[N],b=T?T+L:E,b in m)return b;N++}return r}var $e=1;function si(){return $e++}function An(m){var E=m.ownerDocument||m;return E.defaultView||E.parentWindow||e}var F=/mobile|tablet|ip(ad|hone|od)|android/i,V="ontouchstart"in e,G=H(e,"PointerEvent")!==r,ae=V&&F.test(navigator.userAgent),se="touch",ki="pen",Ct="mouse",zr="kinect",sn=25,me=1,oi=2,ve=4,Xe=8,So=1,Ur=2,Br=4,Vr=8,jr=16,Gt=Ur|Br,ai=Vr|jr,Ld=Gt|ai,Md=["x","y"],Po=["clientX","clientY"];function mt(m,E){var T=this;this.manager=m,this.callback=E,this.element=m.element,this.target=m.options.inputTarget,this.domHandler=function(b){S(m.options.enable,[m])&&T.handler(b)},this.init()}mt.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(An(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(An(this.element),this.evWin,this.domHandler)}};function tE(m){var E,T=m.options.inputClass;return T?E=T:G?E=ac:ae?E=Co:V?E=lc:E=Ao,new E(m,nE)}function nE(m,E,T){var b=T.pointers.length,L=T.changedPointers.length,N=E&me&&b-L===0,$=E&(ve|Xe)&&b-L===0;T.isFirst=!!N,T.isFinal=!!$,N&&(m.session={}),T.eventType=E,iE(m,T),m.emit("hammer.input",T),m.recognize(T),m.session.prevInput=T}function iE(m,E){var T=m.session,b=E.pointers,L=b.length;T.firstInput||(T.firstInput=Id(E)),L>1&&!T.firstMultiple?T.firstMultiple=Id(E):L===1&&(T.firstMultiple=!1);var N=T.firstInput,$=T.firstMultiple,Te=$?$.center:N.center,Ae=E.center=Rd(b);E.timeStamp=u(),E.deltaTime=E.timeStamp-N.timeStamp,E.angle=oc(Te,Ae),E.distance=bo(Te,Ae),rE(T,E),E.offsetDirection=kd(E.deltaX,E.deltaY);var Be=Od(E.deltaTime,E.deltaX,E.deltaY);E.overallVelocityX=Be.x,E.overallVelocityY=Be.y,E.overallVelocity=c(Be.x)>c(Be.y)?Be.x:Be.y,E.scale=$?aE($.pointers,b):1,E.rotation=$?oE($.pointers,b):0,E.maxPointers=T.prevInput?E.pointers.length>T.prevInput.maxPointers?E.pointers.length:T.prevInput.maxPointers:E.pointers.length,sE(T,E);var Ht=m.element;M(E.srcEvent.target,Ht)&&(Ht=E.srcEvent.target),E.target=Ht}function rE(m,E){var T=E.center,b=m.offsetDelta||{},L=m.prevDelta||{},N=m.prevInput||{};(E.eventType===me||N.eventType===ve)&&(L=m.prevDelta={x:N.deltaX||0,y:N.deltaY||0},b=m.offsetDelta={x:T.x,y:T.y}),E.deltaX=L.x+(T.x-b.x),E.deltaY=L.y+(T.y-b.y)}function sE(m,E){var T=m.lastInterval||E,b=E.timeStamp-T.timeStamp,L,N,$,Te;if(E.eventType!=Xe&&(b>sn||T.velocity===r)){var Ae=E.deltaX-T.deltaX,Be=E.deltaY-T.deltaY,Ht=Od(b,Ae,Be);N=Ht.x,$=Ht.y,L=c(Ht.x)>c(Ht.y)?Ht.x:Ht.y,Te=kd(Ae,Be),m.lastInterval=E}else L=T.velocity,N=T.velocityX,$=T.velocityY,Te=T.direction;E.velocity=L,E.velocityX=N,E.velocityY=$,E.direction=Te}function Id(m){for(var E=[],T=0;T<m.pointers.length;)E[T]={clientX:l(m.pointers[T].clientX),clientY:l(m.pointers[T].clientY)},T++;return{timeStamp:u(),pointers:E,center:Rd(E),deltaX:m.deltaX,deltaY:m.deltaY}}function Rd(m){var E=m.length;if(E===1)return{x:l(m[0].clientX),y:l(m[0].clientY)};for(var T=0,b=0,L=0;L<E;)T+=m[L].clientX,b+=m[L].clientY,L++;return{x:l(T/E),y:l(b/E)}}function Od(m,E,T){return{x:E/m||0,y:T/m||0}}function kd(m,E){return m===E?So:c(m)>=c(E)?m<0?Ur:Br:E<0?Vr:jr}function bo(m,E,T){T||(T=Md);var b=E[T[0]]-m[T[0]],L=E[T[1]]-m[T[1]];return Math.sqrt(b*b+L*L)}function oc(m,E,T){T||(T=Md);var b=E[T[0]]-m[T[0]],L=E[T[1]]-m[T[1]];return Math.atan2(L,b)*180/Math.PI}function oE(m,E){return oc(E[1],E[0],Po)+oc(m[1],m[0],Po)}function aE(m,E){return bo(E[0],E[1],Po)/bo(m[0],m[1],Po)}var lE={mousedown:me,mousemove:oi,mouseup:ve},cE="mousedown",uE="mousemove mouseup";function Ao(){this.evEl=cE,this.evWin=uE,this.pressed=!1,mt.apply(this,arguments)}v(Ao,mt,{handler:function(E){var T=lE[E.type];T&me&&E.button===0&&(this.pressed=!0),T&oi&&E.which!==1&&(T=ve),this.pressed&&(T&ve&&(this.pressed=!1),this.callback(this.manager,T,{pointers:[E],changedPointers:[E],pointerType:Ct,srcEvent:E}))}});var fE={pointerdown:me,pointermove:oi,pointerup:ve,pointercancel:Xe,pointerout:Xe},hE={2:se,3:ki,4:Ct,5:zr},Nd="pointerdown",Fd="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Nd="MSPointerDown",Fd="MSPointerMove MSPointerUp MSPointerCancel");function ac(){this.evEl=Nd,this.evWin=Fd,mt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}v(ac,mt,{handler:function(E){var T=this.store,b=!1,L=E.type.toLowerCase().replace("ms",""),N=fE[L],$=hE[E.pointerType]||E.pointerType,Te=$==se,Ae=U(T,E.pointerId,"pointerId");N&me&&(E.button===0||Te)?Ae<0&&(T.push(E),Ae=T.length-1):N&(ve|Xe)&&(b=!0),!(Ae<0)&&(T[Ae]=E,this.callback(this.manager,N,{pointers:T,changedPointers:[E],pointerType:$,srcEvent:E}),b&&T.splice(Ae,1))}});var dE={touchstart:me,touchmove:oi,touchend:ve,touchcancel:Xe},pE="touchstart",gE="touchstart touchmove touchend touchcancel";function Dd(){this.evTarget=pE,this.evWin=gE,this.started=!1,mt.apply(this,arguments)}v(Dd,mt,{handler:function(E){var T=dE[E.type];if(T===me&&(this.started=!0),!!this.started){var b=mE.call(this,E,T);T&(ve|Xe)&&b[0].length-b[1].length===0&&(this.started=!1),this.callback(this.manager,T,{pointers:b[0],changedPointers:b[1],pointerType:se,srcEvent:E})}}});function mE(m,E){var T=B(m.touches),b=B(m.changedTouches);return E&(ve|Xe)&&(T=j(T.concat(b),"identifier",!0)),[T,b]}var vE={touchstart:me,touchmove:oi,touchend:ve,touchcancel:Xe},yE="touchstart touchmove touchend touchcancel";function Co(){this.evTarget=yE,this.targetIds={},mt.apply(this,arguments)}v(Co,mt,{handler:function(E){var T=vE[E.type],b=_E.call(this,E,T);!b||this.callback(this.manager,T,{pointers:b[0],changedPointers:b[1],pointerType:se,srcEvent:E})}});function _E(m,E){var T=B(m.touches),b=this.targetIds;if(E&(me|oi)&&T.length===1)return b[T[0].identifier]=!0,[T,T];var L,N,$=B(m.changedTouches),Te=[],Ae=this.target;if(N=T.filter(function(Be){return M(Be.target,Ae)}),E===me)for(L=0;L<N.length;)b[N[L].identifier]=!0,L++;for(L=0;L<$.length;)b[$[L].identifier]&&Te.push($[L]),E&(ve|Xe)&&delete b[$[L].identifier],L++;if(!!Te.length)return[j(N.concat(Te),"identifier",!0),Te]}var EE=2500,zd=25;function lc(){mt.apply(this,arguments);var m=w(this.handler,this);this.touch=new Co(this.manager,m),this.mouse=new Ao(this.manager,m),this.primaryTouch=null,this.lastTouches=[]}v(lc,mt,{handler:function(E,T,b){var L=b.pointerType==se,N=b.pointerType==Ct;if(!(N&&b.sourceCapabilities&&b.sourceCapabilities.firesTouchEvents)){if(L)wE.call(this,T,b);else if(N&&xE.call(this,b))return;this.callback(E,T,b)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function wE(m,E){m&me?(this.primaryTouch=E.changedPointers[0].identifier,Ud.call(this,E)):m&(ve|Xe)&&Ud.call(this,E)}function Ud(m){var E=m.changedPointers[0];if(E.identifier===this.primaryTouch){var T={x:E.clientX,y:E.clientY};this.lastTouches.push(T);var b=this.lastTouches,L=function(){var N=b.indexOf(T);N>-1&&b.splice(N,1)};setTimeout(L,EE)}}function xE(m){for(var E=m.srcEvent.clientX,T=m.srcEvent.clientY,b=0;b<this.lastTouches.length;b++){var L=this.lastTouches[b],N=Math.abs(E-L.x),$=Math.abs(T-L.y);if(N<=zd&&$<=zd)return!0}return!1}var Bd=H(o.style,"touchAction"),Vd=Bd!==r,jd="compute",Gd="auto",cc="manipulation",li="none",Gr="pan-x",Wr="pan-y",Lo=SE();function uc(m,E){this.manager=m,this.set(E)}uc.prototype={set:function(m){m==jd&&(m=this.compute()),Vd&&this.manager.element.style&&Lo[m]&&(this.manager.element.style[Bd]=m),this.actions=m.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var m=[];return p(this.manager.recognizers,function(E){S(E.options.enable,[E])&&(m=m.concat(E.getTouchAction()))}),TE(m.join(" "))},preventDefaults:function(m){var E=m.srcEvent,T=m.offsetDirection;if(this.manager.session.prevented){E.preventDefault();return}var b=this.actions,L=R(b,li)&&!Lo[li],N=R(b,Wr)&&!Lo[Wr],$=R(b,Gr)&&!Lo[Gr];if(L){var Te=m.pointers.length===1,Ae=m.distance<2,Be=m.deltaTime<250;if(Te&&Ae&&Be)return}if(!($&&N)&&(L||N&&T&Gt||$&&T&ai))return this.preventSrc(E)},preventSrc:function(m){this.manager.session.prevented=!0,m.preventDefault()}};function TE(m){if(R(m,li))return li;var E=R(m,Gr),T=R(m,Wr);return E&&T?li:E||T?E?Gr:Wr:R(m,cc)?cc:Gd}function SE(){if(!Vd)return!1;var m={},E=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(T){m[T]=E?e.CSS.supports("touch-action",T):!0}),m}var Mo=1,vt=2,Ni=4,Cn=8,on=Cn,Hr=16,Wt=32;function an(m){this.options=_({},this.defaults,m||{}),this.id=si(),this.manager=null,this.options.enable=P(this.options.enable,!0),this.state=Mo,this.simultaneous={},this.requireFail=[]}an.prototype={defaults:{},set:function(m){return _(this.options,m),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(m){if(h(m,"recognizeWith",this))return this;var E=this.simultaneous;return m=Io(m,this),E[m.id]||(E[m.id]=m,m.recognizeWith(this)),this},dropRecognizeWith:function(m){return h(m,"dropRecognizeWith",this)?this:(m=Io(m,this),delete this.simultaneous[m.id],this)},requireFailure:function(m){if(h(m,"requireFailure",this))return this;var E=this.requireFail;return m=Io(m,this),U(E,m)===-1&&(E.push(m),m.requireFailure(this)),this},dropRequireFailure:function(m){if(h(m,"dropRequireFailure",this))return this;m=Io(m,this);var E=U(this.requireFail,m);return E>-1&&this.requireFail.splice(E,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(m){return!!this.simultaneous[m.id]},emit:function(m){var E=this,T=this.state;function b(L){E.manager.emit(L,m)}T<Cn&&b(E.options.event+Wd(T)),b(E.options.event),m.additionalEvent&&b(m.additionalEvent),T>=Cn&&b(E.options.event+Wd(T))},tryEmit:function(m){if(this.canEmit())return this.emit(m);this.state=Wt},canEmit:function(){for(var m=0;m<this.requireFail.length;){if(!(this.requireFail[m].state&(Wt|Mo)))return!1;m++}return!0},recognize:function(m){var E=_({},m);if(!S(this.options.enable,[this,E])){this.reset(),this.state=Wt;return}this.state&(on|Hr|Wt)&&(this.state=Mo),this.state=this.process(E),this.state&(vt|Ni|Cn|Hr)&&this.tryEmit(E)},process:function(m){},getTouchAction:function(){},reset:function(){}};function Wd(m){return m&Hr?"cancel":m&Cn?"end":m&Ni?"move":m&vt?"start":""}function Hd(m){return m==jr?"down":m==Vr?"up":m==Ur?"left":m==Br?"right":""}function Io(m,E){var T=E.manager;return T?T.get(m):m}function Lt(){an.apply(this,arguments)}v(Lt,an,{defaults:{pointers:1},attrTest:function(m){var E=this.options.pointers;return E===0||m.pointers.length===E},process:function(m){var E=this.state,T=m.eventType,b=E&(vt|Ni),L=this.attrTest(m);return b&&(T&Xe||!L)?E|Hr:b||L?T&ve?E|Cn:E&vt?E|Ni:vt:Wt}});function Ro(){Lt.apply(this,arguments),this.pX=null,this.pY=null}v(Ro,Lt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ld},getTouchAction:function(){var m=this.options.direction,E=[];return m&Gt&&E.push(Wr),m&ai&&E.push(Gr),E},directionTest:function(m){var E=this.options,T=!0,b=m.distance,L=m.direction,N=m.deltaX,$=m.deltaY;return L&E.direction||(E.direction&Gt?(L=N===0?So:N<0?Ur:Br,T=N!=this.pX,b=Math.abs(m.deltaX)):(L=$===0?So:$<0?Vr:jr,T=$!=this.pY,b=Math.abs(m.deltaY))),m.direction=L,T&&b>E.threshold&&L&E.direction},attrTest:function(m){return Lt.prototype.attrTest.call(this,m)&&(this.state&vt||!(this.state&vt)&&this.directionTest(m))},emit:function(m){this.pX=m.deltaX,this.pY=m.deltaY;var E=Hd(m.direction);E&&(m.additionalEvent=this.options.event+E),this._super.emit.call(this,m)}});function fc(){Lt.apply(this,arguments)}v(fc,Lt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[li]},attrTest:function(m){return this._super.attrTest.call(this,m)&&(Math.abs(m.scale-1)>this.options.threshold||this.state&vt)},emit:function(m){if(m.scale!==1){var E=m.scale<1?"in":"out";m.additionalEvent=this.options.event+E}this._super.emit.call(this,m)}});function hc(){an.apply(this,arguments),this._timer=null,this._input=null}v(hc,an,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Gd]},process:function(m){var E=this.options,T=m.pointers.length===E.pointers,b=m.distance<E.threshold,L=m.deltaTime>E.time;if(this._input=m,!b||!T||m.eventType&(ve|Xe)&&!L)this.reset();else if(m.eventType&me)this.reset(),this._timer=f(function(){this.state=on,this.tryEmit()},E.time,this);else if(m.eventType&ve)return on;return Wt},reset:function(){clearTimeout(this._timer)},emit:function(m){this.state===on&&(m&&m.eventType&ve?this.manager.emit(this.options.event+"up",m):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function dc(){Lt.apply(this,arguments)}v(dc,Lt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[li]},attrTest:function(m){return this._super.attrTest.call(this,m)&&(Math.abs(m.rotation)>this.options.threshold||this.state&vt)}});function pc(){Lt.apply(this,arguments)}v(pc,Lt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Gt|ai,pointers:1},getTouchAction:function(){return Ro.prototype.getTouchAction.call(this)},attrTest:function(m){var E=this.options.direction,T;return E&(Gt|ai)?T=m.overallVelocity:E&Gt?T=m.overallVelocityX:E&ai&&(T=m.overallVelocityY),this._super.attrTest.call(this,m)&&E&m.offsetDirection&&m.distance>this.options.threshold&&m.maxPointers==this.options.pointers&&c(T)>this.options.velocity&&m.eventType&ve},emit:function(m){var E=Hd(m.offsetDirection);E&&this.manager.emit(this.options.event+E,m),this.manager.emit(this.options.event,m)}});function Oo(){an.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}v(Oo,an,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[cc]},process:function(m){var E=this.options,T=m.pointers.length===E.pointers,b=m.distance<E.threshold,L=m.deltaTime<E.time;if(this.reset(),m.eventType&me&&this.count===0)return this.failTimeout();if(b&&L&&T){if(m.eventType!=ve)return this.failTimeout();var N=this.pTime?m.timeStamp-this.pTime<E.interval:!0,$=!this.pCenter||bo(this.pCenter,m.center)<E.posThreshold;this.pTime=m.timeStamp,this.pCenter=m.center,!$||!N?this.count=1:this.count+=1,this._input=m;var Te=this.count%E.taps;if(Te===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=on,this.tryEmit()},E.interval,this),vt):on}return Wt},failTimeout:function(){return this._timer=f(function(){this.state=Wt},this.options.interval,this),Wt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==on&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ln(m,E){return E=E||{},E.recognizers=P(E.recognizers,ln.defaults.preset),new gc(m,E)}ln.VERSION="2.0.7",ln.defaults={domEvents:!1,touchAction:jd,enable:!0,inputTarget:null,inputClass:null,preset:[[dc,{enable:!1}],[fc,{enable:!1},["rotate"]],[pc,{direction:Gt}],[Ro,{direction:Gt},["swipe"]],[Oo],[Oo,{event:"doubletap",taps:2},["tap"]],[hc]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var PE=1,$d=2;function gc(m,E){this.options=_({},ln.defaults,E||{}),this.options.inputTarget=this.options.inputTarget||m,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=m,this.input=tE(this),this.touchAction=new uc(this,this.options.touchAction),Xd(this,!0),p(this.options.recognizers,function(T){var b=this.add(new T[0](T[1]));T[2]&&b.recognizeWith(T[2]),T[3]&&b.requireFailure(T[3])},this)}gc.prototype={set:function(m){return _(this.options,m),m.touchAction&&this.touchAction.update(),m.inputTarget&&(this.input.destroy(),this.input.target=m.inputTarget,this.input.init()),this},stop:function(m){this.session.stopped=m?$d:PE},recognize:function(m){var E=this.session;if(!E.stopped){this.touchAction.preventDefaults(m);var T,b=this.recognizers,L=E.curRecognizer;(!L||L&&L.state&on)&&(L=E.curRecognizer=null);for(var N=0;N<b.length;)T=b[N],E.stopped!==$d&&(!L||T==L||T.canRecognizeWith(L))?T.recognize(m):T.reset(),!L&&T.state&(vt|Ni|Cn)&&(L=E.curRecognizer=T),N++}},get:function(m){if(m instanceof an)return m;for(var E=this.recognizers,T=0;T<E.length;T++)if(E[T].options.event==m)return E[T];return null},add:function(m){if(h(m,"add",this))return this;var E=this.get(m.options.event);return E&&this.remove(E),this.recognizers.push(m),m.manager=this,this.touchAction.update(),m},remove:function(m){if(h(m,"remove",this))return this;if(m=this.get(m),m){var E=this.recognizers,T=U(E,m);T!==-1&&(E.splice(T,1),this.touchAction.update())}return this},on:function(m,E){if(m!==r&&E!==r){var T=this.handlers;return p(O(m),function(b){T[b]=T[b]||[],T[b].push(E)}),this}},off:function(m,E){if(m!==r){var T=this.handlers;return p(O(m),function(b){E?T[b]&&T[b].splice(U(T[b],E),1):delete T[b]}),this}},emit:function(m,E){this.options.domEvents&&bE(m,E);var T=this.handlers[m]&&this.handlers[m].slice();if(!(!T||!T.length)){E.type=m,E.preventDefault=function(){E.srcEvent.preventDefault()};for(var b=0;b<T.length;)T[b](E),b++}},destroy:function(){this.element&&Xd(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Xd(m,E){var T=m.element;if(!!T.style){var b;p(m.options.cssProps,function(L,N){b=H(T.style,N),E?(m.oldCssProps[b]=T.style[b],T.style[b]=L):T.style[b]=m.oldCssProps[b]||""}),E||(m.oldCssProps={})}}function bE(m,E){var T=n.createEvent("Event");T.initEvent(m,!0,!0),T.gesture=E,E.target.dispatchEvent(T)}_(ln,{INPUT_START:me,INPUT_MOVE:oi,INPUT_END:ve,INPUT_CANCEL:Xe,STATE_POSSIBLE:Mo,STATE_BEGAN:vt,STATE_CHANGED:Ni,STATE_ENDED:Cn,STATE_RECOGNIZED:on,STATE_CANCELLED:Hr,STATE_FAILED:Wt,DIRECTION_NONE:So,DIRECTION_LEFT:Ur,DIRECTION_RIGHT:Br,DIRECTION_UP:Vr,DIRECTION_DOWN:jr,DIRECTION_HORIZONTAL:Gt,DIRECTION_VERTICAL:ai,DIRECTION_ALL:Ld,Manager:gc,Input:mt,TouchAction:uc,TouchInput:Co,MouseInput:Ao,PointerEventInput:ac,TouchMouseInput:lc,SingleTouchInput:Dd,Recognizer:an,AttrRecognizer:Lt,Tap:Oo,Pan:Ro,Swipe:pc,Pinch:fc,Rotate:dc,Press:hc,on:A,off:C,each:p,merge:y,extend:x,assign:_,inherit:v,bindFn:w,prefixed:H});var AE=typeof e!="undefined"?e:typeof self!="undefined"?self:{};AE.Hammer=ln,typeof r=="function"&&r.amd?r(function(){return ln}):t.exports?t.exports=ln:e[i]=ln})(window,document,"Hammer")})(c1);var it=c1.exports;const u1=1,f1=2,zf=4,mM={mousedown:u1,mousemove:f1,mouseup:zf};function vM(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function yM(t){const e=t.prototype.handler;t.prototype.handler=function(i){const r=this.store;i.button>0&&i.type==="pointerdown"&&(vM(r,s=>s.pointerId===i.pointerId)||r.push(i)),e.call(this,i)}}function _M(t){t.prototype.handler=function(n){let i=mM[n.type];i&u1&&n.button>=0&&(this.pressed=!0),i&f1&&n.which===0&&(i=zf),this.pressed&&(i&zf&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}yM(it.PointerEventInput);_M(it.MouseInput);const EM=it.Manager;class ql{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const wM=it?[[it.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[it.Rotate,{enable:!1}],[it.Pinch,{enable:!1}],[it.Swipe,{enable:!1}],[it.Pan,{threshold:0,enable:!1}],[it.Press,{enable:!1}],[it.Tap,{event:"doubletap",taps:2,enable:!1}],[it.Tap,{event:"anytap",enable:!1}],[it.Tap,{enable:!1}]]:null,Am={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},xM={doubletap:["tap"]},TM={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},pd={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},SM={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Cm={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},PM=typeof navigator!="undefined"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",rr=typeof window!="undefined"?window:global;let Uf=!1;try{const t={get passive(){return Uf=!0,!0}};rr.addEventListener("test",null,t),rr.removeEventListener("test",null)}catch{Uf=!1}const bM=PM.indexOf("firefox")!==-1,{WHEEL_EVENTS:AM}=pd,Lm="wheel",Mm=4.000244140625,CM=40,LM=.25;class MM extends ql{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;rr.WheelEvent&&(bM&&r.deltaMode===rr.WheelEvent.DOM_DELTA_PIXEL&&(s/=rr.devicePixelRatio),r.deltaMode===rr.WheelEvent.DOM_DELTA_LINE&&(s*=CM)),s!==0&&s%Mm===0&&(s=Math.floor(s/Mm)),r.shiftKey&&s&&(s=s*LM),this.callback({type:Lm,center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(AM),this.events.forEach(r=>e.addEventListener(r,this.handleEvent,Uf?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Lm&&(this.options.enable=n)}}const{MOUSE_EVENTS:IM}=pd,Im="pointermove",Rm="pointerover",Om="pointerout",km="pointerenter",Nm="pointerleave";class RM extends ql{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(IM),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Im&&(this.enableMoveEvent=n),e===Rm&&(this.enableOverEvent=n),e===Om&&(this.enableOutEvent=n),e===km&&(this.enableEnterEvent=n),e===Nm&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(Rm,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(Om,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(km,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(Nm,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(Im,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:OM}=pd,Fm="keydown",Dm="keyup";class kM extends ql{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{const s=r.target||r.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:Fm,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:Dm,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(OM),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Fm&&(this.enableDownEvent=n),e===Dm&&(this.enableUpEvent=n)}}const zm="contextmenu";class NM extends ql{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{!this.options.enable||this.callback({type:zm,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===zm&&(this.options.enable=n)}}const Bf=1,xl=2,Vf=4,FM={pointerdown:Bf,pointermove:xl,pointerup:Vf,mousedown:Bf,mousemove:xl,mouseup:Vf},DM=1,zM=2,UM=3,BM=0,VM=1,jM=2,GM=1,WM=2,HM=4;function $M(t){const e=FM[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:r}=t.srcEvent;let s=!1,o=!1,a=!1;return e===Vf||e===xl&&!Number.isFinite(n)?(s=r===DM,o=r===zM,a=r===UM):e===xl?(s=Boolean(n&GM),o=Boolean(n&HM),a=Boolean(n&WM)):e===Bf&&(s=i===BM,o=i===VM,a=i===jM),{leftButton:s,middleButton:o,rightButton:a}}function XM(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1,o={x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const pu={srcElement:"root",priority:0};class YM{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let r=n.srcEvent.target;for(;r&&r!==i.rootElement;){if(this._emit(i,r),i.handled)return;r=r.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,r=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=pu;typeof i=="string"||i&&i.addEventListener?l={...pu,srcElement:i}:i&&(l={...pu,...i});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};r&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let f=c.length-1;for(;f>=0&&!(c[f].priority>=u.priority);)f--;c.splice(f+1,0,u)}remove(e,n){const{handlers:i,handlersByElement:r}=this;for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.type===e&&o.handler===n){i.splice(s,1);const a=r.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&r.delete(o.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let r=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,r=!0},a=[];for(let l=0;l<i.length;l++){const{type:c,handler:u,once:f}=i[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),f&&a.push(i[l]),r)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...$M(e),...XM(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const ZM={events:null,recognizers:null,recognizerOptions:{},Manager:EM,touchAction:"none",tabIndex:0};class KM{constructor(e=null,n){this._onBasicInput=r=>{const{srcEvent:s}=r,o=TM[s.type];o&&this.manager.emit(o,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...ZM,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||wM}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(Am).forEach(r=>{const s=this.manager.get(r);s&&Am[r].forEach(o=>{s.recognizeWith(o)})});for(const r in n.recognizerOptions){const s=this.manager.get(r);if(s){const o=n.recognizerOptions[r];delete o.enable,s.set(o)}}this.wheelInput=new MM(e,this._onOtherEvent,{enable:!1}),this.moveInput=new RM(e,this._onOtherEvent,{enable:!1}),this.keyInput=new kM(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new NM(e,this._onOtherEvent,{enable:!1});for(const[r,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(r,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const r=i.get(e);if(r&&r.options.enable!==n){r.set({enable:n});const s=xM[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=i.get(o);n?(a.requireFailure(e),r.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,r,s){if(typeof e!="string"){i=n;for(const u in e)this._addEventHandler(u,e[u],i,r,s);return}const{manager:o,events:a}=this,l=Cm[e]||e;let c=a.get(l);c||(c=new YM(this),a.set(l,c),c.recognizerName=SM[l]||l,o&&o.on(l,c.handleEvent)),c.add(e,n,i,r,s),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:i}=this,r=Cm[e]||e,s=i.get(r);if(!!s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of i.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function fi(){}const qM=({isDragging:t})=>t?"grabbing":"grab",h1={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:fi,onResize:fi,onViewStateChange:fi,onInteractionStateChange:fi,onBeforeRender:fi,onAfterRender:fi,onLoad:fi,onError:t=>W.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:qM,getTooltip:null,debug:!1,drawPickingColors:!1};class gd{constructor(e){d(this,"props",void 0),d(this,"width",0),d(this,"height",0),d(this,"userData",{}),d(this,"canvas",null),d(this,"viewManager",null),d(this,"layerManager",null),d(this,"effectManager",null),d(this,"deckRenderer",null),d(this,"deckPicker",null),d(this,"eventManager",null),d(this,"tooltip",null),d(this,"metrics",void 0),d(this,"animationLoop",void 0),d(this,"stats",void 0),d(this,"viewState",void 0),d(this,"cursorState",void 0),d(this,"_needsRedraw",void 0),d(this,"_pickRequest",void 0),d(this,"_lastPointerDownInfo",null),d(this,"_metricsCounter",void 0),d(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const r=n.offsetCenter;if(!r)return;i.x=r.x,i.y=r.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),d(this,"_onEvent",n=>{const i=dm[n.type],r=n.offsetCenter;if(!i||!r||!this.layerManager)return;const s=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:s,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:a}=o,l=a&&(a[i.handler]||a.props[i.handler]),c=this.props[i.handler];let u=!1;l&&(u=l.call(a,o,n)),!u&&c&&c(o,n)}),d(this,"_onPointerDown",n=>{const i=n.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo}),this.props={...h1,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&W.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Fy()==="IE"&&W.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document!="undefined"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Hh({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Mr.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,r,s,o,a;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(r=this.deckRenderer)===null||r===void 0||r.finalize(),this.deckRenderer=null,(s=this.deckPicker)===null||s===void 0||s.finalize(),this.deckPicker=null,(o=this.eventManager)===null||o===void 0||o.destroy(),this.eventManager=null,(a=this.tooltip)===null||a===void 0||a.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var l;(l=this.canvas.parentElement)===null||l===void 0||l.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&W.removed("onLayerHover","onHover")(),"onLayerClick"in e&&W.removed("onLayerClick","onClick")(),e.initialViewState&&!Oi(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||i||r||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Pe(this.viewManager),this.viewManager.views}getViewports(e){return Pe(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_pick(e,n,i){Pe(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Pe(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=s}if(i||i===0){var r;const s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((r=e.style)===null||r===void 0?void 0:r.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const n=e.clientWidth||e.width,i=e.clientHeight||e.height;if(n!==this.width||i!==this.height){var r;this.width=n,this.height=i,(r=this.viewManager)===null||r===void 0||r.setProps({width:n,height:i}),this.props.onResize({width:n,height:i})}}_createAnimationLoop(e){const{width:n,height:i,gl:r,glOptions:s,debug:o,onError:a,onBeforeRender:l,onAfterRender:c,useDevicePixels:u}=e;return new WA({width:n,height:i,useDevicePixels:u,autoResizeViewport:!1,gl:r,onCreateContext:f=>n_({...s,...f,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:f=>this._setGLContext(f.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:l,onAfterRender:c,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new i1({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let s=r,o=!1;for(const a of i){var n;s=a,o=((n=a.layer)===null||n===void 0?void 0:n.onHover(a,e.event))||o}if(!o&&this.props.onHover&&this.props.onHover(s,e.event),this.props.getTooltip&&this.tooltip){const a=this.props.getTooltip(s);this.tooltip.setTooltip(a,s.x,s.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Qh(e,{enable:!0,copyState:!0})),this.tooltip=new gM(this.canvas),xn(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new j_;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new KM(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in dm)this.eventManager.on(r,this._onEvent);this.viewManager=new O3({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new R3(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new nM,this.deckRenderer=new aM(e),this.deckPicker=new dM(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;xn(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),W.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=yi.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}d(gd,"defaultProps",h1);d(gd,"VERSION",qS.VERSION);class gu{constructor(e,n){d(this,"opts",void 0),d(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:r}=n;let s=i;if(i&&i.length!==r){s=new Float32Array(r);const o=n.elementOffset||0;for(let a=0;a<r;++a)s[a]=i[o+a]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function QM(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Oa(t){return t.stride||t.size*t.bytesPerElement}function d1(t,e){e.offset&&W.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Oa(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,s=i*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function JM(t,e){const n=d1(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class eI{constructor(e,n,i){d(this,"gl",void 0),d(this,"id",void 0),d(this,"size",void 0),d(this,"settings",void 0),d(this,"value",void 0),d(this,"doublePrecision",void 0),d(this,"_buffer",void 0),d(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,s=r===5130;let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a=5126:!r&&n.isIndexed?a=e&&f_(e,ee.ELEMENT_INDEX_UINT32)?5125:5123:a=r||5126;let l=QM(r||a||5126);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:r,type:a,size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new Q(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Oa(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Mr.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},r=this.value instanceof Float64Array,s=JM(this.getAccessor(),n||{});return i[e]=new gu(this,s.high),i["".concat(e,"64Low")]=r?new gu(this,s.low):new Float32Array(this.size),i}if(n){const i=d1(this.getAccessor(),n);return{[e]:new gu(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:r}=this,s=i*r;if(n&&s&&n.length>=s){const o=new Array(r).fill(1/0),a=new Array(r).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<r;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof Q?i={buffer:e}:i=e;const r={...this.settings,...i};if(n.bufferAccessor=r,n.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=s}else if(i.buffer){const s=i.buffer;n.externalBuffer=s,n.constant=!1,this.value=i.value||null;const o=i.value instanceof Float64Array;r.type=i.type||s.accessor.type,r.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(o?2:1),r.stride=Oa(r)}else if(i.value){this._checkExternalBuffer(i);let s=i.value;n.externalBuffer=null,n.constant=!1,this.value=s,r.bytesPerElement=s.BYTES_PER_ELEMENT,r.stride=Oa(r);const{buffer:o,byteOffset:a}=this;this.doublePrecision&&s instanceof Float64Array&&(s=hu(s,r));const l=s.byteLength+a+r.stride*2;o.byteLength<l&&o.reallocate(l),o.setAccessor(null),o.subData({data:s,offset:a}),r.type=i.type||o.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?hu(n,{size:this.size,startIndex:i,endIndex:r}):n.subarray(i,r),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,r=i.allocatedValue,s=Mr.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{buffer:o,byteOffset:a}=this;return o.byteLength<s.byteLength+a&&(o.reallocate(s.byteLength+a),n&&r&&o.subData({data:r instanceof Float64Array?hu(r,this):r,offset:a})),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&W.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e)return n[i]=r[0],n;switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let o=s;for(;--o>=0;)n[i+o]=Number.isFinite(e[o])?e[o]:r[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==n[r])return!1;return!0}}const Um=[],Bm=[];function xo(t,e=0,n=1/0){let i=Um;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(Bm.length=t.length,i=Bm):i=Um,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function p1(t){return t&&t[Symbol.asyncIterator]}function g1(t,e){const{size:n,stride:i,offset:r,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((t.length-c)/l);return(f,{index:h,target:p})=>{if(!s){const y=h*l+c;for(let v=0;v<n;v++)p[v]=t[y+v];return p}const g=s[h],_=s[h+1]||u;let x;if(o){x=new Array(_-g);for(let y=g;y<_;y++){const v=y*l+c;p=new Array(n);for(let w=0;w<n;w++)p[w]=t[v+w];x[y-g]=p}}else if(l===n)x=t.subarray(g*n+c,_*n+c);else{x=new t.constructor((_-g)*n);let y=0;for(let v=g;v<_;v++){const w=v*l+c;for(let S=0;S<n;S++)x[y++]=t[w+S]}}return x}}const tI=[],ka=[[0,1/0]];function nI(t,e){if(t===ka||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let r=0;for(let s=0;s<i;s++){const o=t[s];o[1]<e[0]?(n.push(o),r=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(r,0,e),n}function mu(t){const{source:e,target:n,start:i=0,size:r,getData:s}=t,o=t.end||n.length,a=e.length,l=o-i;if(a>l){n.set(e.subarray(0,l),i);return}if(n.set(e,i),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let f=0;f<r;f++)n[i+c]=u[f]||0,c++}}function iI({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!Array.isArray(s))return mu({source:t,target:e,size:n,getData:i}),e;let o=0,a=0;const l=i&&((u,f)=>i(u+a,f)),c=Math.min(r.length,s.length);for(let u=1;u<c;u++){const f=r[u]*n,h=s[u]*n;mu({source:t.subarray(o,f),target:e,start:a,end:h,size:n,getData:l}),o=f,a=h}return a<e.length&&mu({source:[],target:e,start:a,size:n,getData:l}),e}const rI={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function m1(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...rI[n],...e,...t,type:n}}function v1(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function y1(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function _1(t){t.push(t.shift())}function md(t,e){const{doublePrecision:n,settings:i,value:r,size:s}=t,o=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*s)*o}function E1({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:r,getData:s=o=>o}){const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,a=n.size*o,l=n.byteOffset,c=n.startIndices,u=r&&c,f=md(n,e),h=n.isConstant;if(!u&&i>=f)return;const p=h?n.value:n.getBuffer().getData({srcByteOffset:l});if(n.settings.normalized&&!h){const y=s;s=(v,w)=>n.normalizeConstant(y(v,w))}const g=h?(y,v)=>s(p,v):(y,v)=>s(p.subarray(y,y+a),v),_=t.getData({length:i}),x=new Float32Array(f);iI({source:_,target:x,sourceStartIndices:r,targetStartIndices:c,size:a,getData:g}),t.byteLength<x.byteLength+l&&t.reallocate(x.byteLength+l),t.subData({data:x,offset:l})}class vd extends eI{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:ka}),d(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,r=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return m1(r,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:r=1/0}=n;this.state.updateRanges=nI(this.state.updateRanges,[i,r])}else this.state.updateRanges=ka}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=tI}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==ka),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(r,this,{data:n,startRow:c,endRow:u,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const f=Number.isFinite(c)?this.getVertexOffset(c):0,h=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Pe(ArrayBuffer.isView(o.value),"invalid ".concat(r.accessor));const a=Boolean(o.size)&&o.size!==this.size;return i.binaryAccessor=g1(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?n[e]:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:r,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:f}=e,{accessor:h,transform:p}=a,g=l.binaryAccessor||(typeof h=="function"?h:s[h]);Pe(typeof g=="function",'accessor "'.concat(h,'" is not a function'));let _=e.getVertexOffset(i);const{iterable:x,objectInfo:y}=xo(n,i,r);for(const v of x){y.index++;let w=g(v,y);if(p&&(w=p.call(this,w)),f){const S=(y.index<f.length-1?f[y.index+1]:o)-f[y.index];if(w&&Array.isArray(w[0])){let P=_;for(const A of w)e._normalizeValue(A,c,P),P+=u}else w&&w.length>u?c.set(w,_):(e._normalizeValue(w,y.target,0),A3({target:c,source:y.target,start:_,count:S}));_+=S*u}else e._normalizeValue(w,c,_),_+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class sI{constructor({gl:e,attribute:n,timeline:i}){d(this,"gl",void 0),d(this,"type","interpolation"),d(this,"attributeInTransition",void 0),d(this,"settings",void 0),d(this,"attribute",void 0),d(this,"transition",void 0),d(this,"currentStartIndices",void 0),d(this,"currentLength",void 0),d(this,"transform",void 0),d(this,"buffers",void 0),this.gl=e,this.transition=new Eo(i),this.attribute=n,this.attributeInTransition=new vd(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=aI(e,n);const r={byteLength:0,usage:35050};this.buffers=[new Q(e,r),new Q(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:r,attribute:s}=this;_1(r);const o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)E1({buffer:a,...o});this.currentStartIndices=s.startIndices,this.currentLength=md(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:r[0],aTo:v1(i,s)},feedbackBuffers:{vCurrent:r[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:r}=this.transition;let s=r/n;i&&(s=i(s)),this.transform.run({uniforms:{time:s}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const oI=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function aI(t,e){const n=y1(e.size);return new ld(t,{vs:oI,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class lI{constructor({gl:e,attribute:n,timeline:i}){d(this,"gl",void 0),d(this,"type","spring"),d(this,"attributeInTransition",void 0),d(this,"settings",void 0),d(this,"attribute",void 0),d(this,"transition",void 0),d(this,"currentStartIndices",void 0),d(this,"currentLength",void 0),d(this,"texture",void 0),d(this,"framebuffer",void 0),d(this,"transform",void 0),d(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Eo(i),this.attribute=n,this.attributeInTransition=new vd(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=uI(e),this.framebuffer=fI(e,this.texture),this.transform=cI(e,n,this.framebuffer);const r={byteLength:0,usage:35050};this.buffers=[new Q(e,r),new Q(e,r),new Q(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:r,attribute:s}=this,o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)E1({buffer:a,...o});this.settings=e,this.currentStartIndices=s.startIndices,this.currentLength=md(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:v1(i,s)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:r}=this;if(!r.update())return!1;const o=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:o.stiffness,damping:o.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),_1(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Xl(i)[0]>0||r.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function cI(t,e,n){const i=y1(e.size);return new ld(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function uI(t){return new et(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function fI(t,e){return new _e(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const hI={interpolation:sI,spring:lI};class dI{constructor(e,{id:n,timeline:i}){d(this,"id",void 0),d(this,"isSupported",void 0),d(this,"gl",void 0),d(this,"timeline",void 0),d(this,"transitions",void 0),d(this,"needsRedraw",void 0),d(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=ld.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const r in e){const s=e[r],o=s.getTransitionSetting(n);!o||this._updateAttribute(r,s,o)}for(const r in this.transitions){const s=e[r];(!s||!s.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const r=this.transitions[e];let s=!r||r.type!==i.type;if(s){if(!this.isSupported){W.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}r&&this._removeTransition(e);const o=hI[i.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,gl:this.gl}):(W.error("unsupported transition type '".concat(i.type,"'"))(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const Vm="attributeManager.invalidate",pI="attributeManager.updateStart",gI="attributeManager.updateEnd",mI="attribute.updateStart",vI="attribute.allocate",yI="attribute.updateEnd";class _I{constructor(e,{id:n="attribute-manager",stats:i,timeline:r}={}){d(this,"id",void 0),d(this,"gl",void 0),d(this,"attributes",void 0),d(this,"updateTriggers",void 0),d(this,"needsRedraw",void 0),d(this,"userData",void 0),d(this,"stats",void 0),d(this,"attributeTransitionManager",void 0),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new dI(e,{id:"".concat(n,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);Ne(Vm,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Ne(Vm,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:r,props:s={},buffers:o={},context:a={}}){let l=!1;Ne(pI,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],f=u.settings.accessor;u.startIndices=i,u.numInstances=n,s[c]&&W.removed("props.".concat(c),"data.attributes.".concat(c))(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof f=="string"?o[f]:void 0,e.startIndices)||typeof f=="string"&&!o[f]&&u.setConstantValue(s[f])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&Ne(gI,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!i.hasAttribute(s)&&(r[s]=o)}return r}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const r in e)n[r]||Object.assign(i,e[r].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const r=e[i];this.attributes[i]=this._createAttribute(i,r,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const r={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new vd(this.gl,r)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:r}=this,s=r[e];return s&&s.forEach(o=>{const a=i[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(Ne(mI,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Ne(vI,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,Ne(yI,n,i))}}class EI extends Eo{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:r,easing:s}}=this,o=s(e/r);this._value=wi(n,i,o)}}const jm=1e-5;function Gm(t,e,n,i,r){const s=e-t,a=(n-e)*r,l=-s*i;return a+l+s+e}function wI(t,e,n,i,r){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=Gm(t[o],e[o],n[o],i,r);return s}return Gm(t,e,n,i,r)}function Wm(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class xI extends Eo{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:r}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=wI(s,o,n,i,r);const l=Wm(a,n),c=Wm(a,o);l<jm&&c<jm&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const TI={interpolation:EI,spring:xI};class SI{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,r){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(r=m1(r),!r)return;const o=TI[r.type];if(!o){W.error("unsupported transition type '".concat(r.type,"'"))();return}const a=new o(this.timeline);a.start({...r,fromValue:n,toValue:i}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function PI(t){const e=yd(t);for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function bI(t,e){const n=w1({newProps:t,oldProps:e,propTypes:yd(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=CI(t,e);let r=!1;return i||(r=LI(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:MI(t,e),transitionsChanged:AI(t,e)}}function AI(t,e){if(!t.transitions)return!1;const n={},i=yd(t);let r=!1;for(const s in t.transitions){const o=i[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&jf(t[s],e[s],o)&&(n[s]=!0,r=!0)}return r?n:!1}function w1({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(r," changed shallowly");for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return"".concat(r,".").concat(s," added");const o=jf(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return"".concat(r,".").concat(s," dropped");if(!Object.hasOwnProperty.call(t,s)){const o=jf(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}}return!1}function jf(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function CI(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function LI(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Hm(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)r!=="all"&&Hm(t,e,r)&&(n[r]=!0,i=!0);return i?n:!1}function MI(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function Hm(t,e,n){let i=t.updateTriggers[n];i=i==null?{}:i;let r=e.updateTriggers[n];return r=r==null?{}:r,w1({oldProps:r,newProps:i,triggerName:n})}function yd(t){const e=t[wl],n=e&&e.constructor;return n?n._propTypes:{}}const II="count(): argument not an object",RI="count(): argument not a container";function OI(t){if(!NI(t))throw new Error(II);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(kI(t))return Object.keys(t).length;throw new Error(RI)}function kI(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function NI(t){return t!==null&&typeof t=="object"}function FI(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(r=>r.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];n.inject=i}return n}const DI={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},Gf={};function zI(t,e){const n=t.context&&t.context.gl;if(!n||!e)return null;if(e instanceof et)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={[10241]:e.data.length>1?9985:9729});const r=new et(n,{...e,parameters:{...DI,...i,...t.props.textureParameters}});return Gf[r.id]=!0,r}function UI(t){!t||!(t instanceof et)||Gf[t.id]&&(t.delete(),delete Gf[t.id])}const BI={boolean:{validate(t,e){return!0},equal(t,e,n){return Boolean(t)===Boolean(e)}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Qs(t)&&(t.length===3||t.length===4)},equal(t,e,n){return vu(t,e)}},accessor:{validate(t,e){const n=Tl(t);return n==="function"||n===Tl(e.value)},equal(t,e,n){return typeof e=="function"?!0:vu(t,e)}},array:{validate(t,e){return e.optional&&!t||Qs(t)},equal(t,e,n){return n.compare?vu(t,e):t===e}},object:{equal(t,e,n){return n.compare?Oi(t,e):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>zI(n,t),release:t=>{UI(t)}}};function vu(t,e){if(t===e)return!0;if(!Qs(t)||!Qs(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function VI(t){const e={},n={},i={};for(const[r,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)i[r]=Array.isArray(o)?o:[o];else{const a=jI(r,s);e[r]=a,n[r]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function jI(t,e){switch(Tl(e)){case"object":return ss(t,e);case"array":return ss(t,{type:"array",value:e,compare:!1});case"boolean":return ss(t,{type:"boolean",value:e});case"number":return ss(t,{type:"number",value:e});case"function":return ss(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function ss(t,e){return"type"in e?{name:t,...BI[e.type],...e}:"value"in e?{name:t,type:Tl(e.value),...e}:{name:t,type:"object",value:e}}function Qs(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Tl(t){return Qs(t)?"array":t===null?"null":typeof t}function GI(t,e){const n=x1(t.constructor),i=Object.create(n);i[wl]=t,i[Li]={},i[Vn]={};for(let r=0;r<e.length;++r){const s=e[r];for(const o in s)i[o]=s[o]}return Object.freeze(i),i}function x1(t){const e=Sl(t,"_mergedDefaultProps");return e||(WI(t),t._mergedDefaultProps)}function WI(t){if(!t.prototype)return;const n=Object.getPrototypeOf(t),i=x1(n),r=Sl(t,"defaultProps")||{},s=VI(r),o=HI(s.defaultProps,i,t),a={...n._propTypes,...s.propTypes};XI(o,a);const l={...n._deprecatedProps,...s.deprecatedProps};$I(o,l),t._mergedDefaultProps=o,t._propTypes=a,t._deprecatedProps=l}function HI(t,e,n){const i=Object.create(null);Object.assign(i,e,t);const r=ZI(n);return delete t.id,Object.defineProperties(i,{id:{writable:!0,value:r}}),i}function $I(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const r="".concat(this.id,": ").concat(n);for(const s of e[n])T1(this,s)||(this[s]=i);W.deprecated(r,e[n].join("/"))()}})}function XI(t,e){const n={},i={};for(const r in e){const s=e[r],{name:o,value:a}=s;s.async&&(n[o]=a,i[o]=YI(o))}t[pr]=n,t[Li]={},Object.defineProperties(t,i)}function YI(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||p1(e)?this[Li][t]=e:this[Vn][t]=e},get(){if(this[Vn]){if(t in this[Vn])return this[Vn][t]||this[pr][t];if(t in this[Li]){const e=this[wl]&&this[wl].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[pr][t]}}return this[pr][t]}}}function T1(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Sl(t,e){return T1(t,e)&&t[e]}function ZI(t){const e=Sl(t,"layerName")||Sl(t,"componentName");return e||W.once(0,"".concat(t.name,".componentName not specified"))(),e||t.name}let KI=0;class _d{constructor(...e){d(this,"id",void 0),d(this,"props",void 0),d(this,"count",void 0),this.props=GI(this,e),this.id=this.props.id,this.count=KI++}clone(e){const{props:n}=this,i={};for(const r in n[pr])r in n[Vn]?i[r]=n[Vn][r]:r in n[Li]&&(i[r]=n[Li][r]);return new this.constructor({...n,...i,...e})}}d(_d,"componentName","Component");d(_d,"defaultProps",{});const qI=Object.freeze({});class QI{constructor(e){d(this,"component",void 0),d(this,"onAsyncPropUpdated",void 0),d(this,"asyncProps",void 0),d(this,"oldProps",void 0),d(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||qI}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){const n=e[Vn]||{},i=e[Li]||e,r=e[pr]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in i){const o=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(!!this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(p1(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;n.then(s=>{s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,r),this._onResolve(e,s)}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let s=[],o=0;for await(const a of n){const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,r)}this._onResolve(e,s)}_postProcessValue(e,n){const i=e.type;return i&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class JI extends QI{constructor({attributeManager:e,layer:n}){super(n),d(this,"attributeManager",void 0),d(this,"needsRedraw",void 0),d(this,"needsUpdate",void 0),d(this,"subLayers",void 0),d(this,"usesPickingColorCache",void 0),d(this,"changeFlags",void 0),d(this,"viewport",void 0),d(this,"uniformTransitions",void 0),d(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}_fetch(e,n){const i=this.component.props.fetch;return i?i(n,{propName:e,layer:this.layer}):super._fetch(e,n)}_onResolve(e,n){const i=this.component.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:this.layer})}_onError(e,n){this.layer.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const eR="layer.changeFlag",tR="layer.initialize",nR="layer.update",iR="layer.finalize",rR="layer.matched",$m=2**24-1,sR=Object.freeze([]),oR=Zl(({oldViewport:t,viewport:e})=>t.equals(e));let Yt=new Uint8ClampedArray(0);const aR={data:{type:"data",value:sR,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:o}=n.context;if(r=r||n.getLoadOptions(),i=i||n.props.loaders,s){var a;r={...r,fetch:{...(a=r)===null||a===void 0?void 0:a.fetch,signal:s}}}let l=o.contains(t);return!l&&!r&&(o.add({resourceId:t,data:dl(t,i),persistent:!1}),l=!0),l?o.subscribe({resourceId:t,onChange:c=>{var u;return(u=n.internalState)===null||u===void 0?void 0:u.reloadAsyncProp(e,c)},consumerId:n.id,requestId:e}):dl(t,i,r)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:vo.DRAW,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:Z.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class gt extends _d{constructor(...e){super(...e),d(this,"internalState",null),d(this,"lifecycle",Wi.NO_STATE),d(this,"context",void 0),d(this,"state",void 0),d(this,"parent",null)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Pe(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=e1(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,o]=K_(i,n.pixelProjectionMatrix);return e.length===2?[r,s]:[r,s,o]}unproject(e){return Pe(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Pe(this.internalState);const i=this.internalState.viewport||this.context.viewport;return b3(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Z.DEFAULT||e===Z.LNGLAT||e===Z.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Pe(e instanceof Uint8Array);const[n,i,r]=e;return n+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:OI(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;const n=this.getAttributeManager();if(!n)return null;const{positions:i,instancePositions:r}=n.attributes;return(e=i||r)===null||e===void 0?void 0:e.getBounds()}getShaders(e){for(const n of this.props.extensions)e=FI(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const l of i)n.invalidateAll(l);else n.invalidateAll();const{props:r,oldProps:s}=e,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable,a=Number.isInteger(r.highlightedObjectIndex)||r.pickable;if(o!==a&&n){const{pickingColors:l,instancePickingColors:c}=n.attributes,u=l||c;u&&(a&&u.constant&&(u.constant=!1,n.invalidate(u.id)),!u.value&&!a&&(u.constant=!0,u.value=[0,0,0]))}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){var i,r;if(n&&(e.message="".concat(n,": ").concat(e.message)),!((i=(r=this.props).onError)!==null&&i!==void 0&&i.call(r,e))){var s,o;(s=this.context)===null||s===void 0||(o=s.onError)===null||o===void 0||o.call(s,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!oR({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();!n||(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const r in n)Object.defineProperty(i,r,{value:n[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(Yt.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>$m&&W.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Yt=Mr.allocate(Yt,n,{size:3,copy:!0,maxCount:Math.max(n,$m)});const r=Math.floor(Yt.length/3),s=[];for(let o=i;o<r;o++)this.encodePickingColor(o,s),Yt[o*3+0]=s[0],Yt[o*3+1]=s[1],Yt[o*3+2]=s[2]}e.value=Yt.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),r=e.userData.excludeAttributes||{},s=i.getShaderAttributes(n,r);e.setAttributes(s)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i;if(!r)return;const s=r.getVertexOffset(e),o=r.getVertexOffset(e+1);r.buffer.subData({data:new Uint8Array(o-s),offset:s})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;!i||(this.internalState.usesPickingColorCache&&i.value.buffer!==Yt.buffer&&(i.value=Yt.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Pe(!this.internalState),Pe(Number.isFinite(this.props.coordinateSystem)),Ne(tR,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new JI({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(W.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new SI(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ne(rR,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.internalState.layer=this,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ne(nR,this,e),!e)return;const n=this.props,i=this.context,r=this.internalState,s=i.viewport,o=this._updateUniformTransition();r.propsInTransition=o,i.viewport=r.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(i.gl)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{i.viewport=s,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){Ne(iR,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,s=this.context;this.props=this.internalState.propsInTransition||r;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:a}=this.props,l=a&&a(n)||[0,0];xn(s.gl,{polygonOffset:l}),Tt(s.gl,i,()=>{const c={moduleParameters:e,uniforms:n,parameters:i,context:s};for(const u of this.props.extensions)u.draw.call(this,c,u);this.draw(c)})}finally{this.props=r}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let s=!1;switch(r){case"dataChanged":const o=e[r],a=n[r];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[r]||(n[r]=e[r],s=!0)}s&&Ne(eR,this,r,e)}const i=Boolean(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=bI(e,n);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged){var r;this.internalState.uniformTransitions.add(s,n[s],e[s],(r=e.transitions)===null||r===void 0?void 0:r[s])}return this.setChangeFlags(i)}validateProps(){PI(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new _I(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=i;if(n||r.autoHighlight!==o||r.highlightedObjectIndex!==a||r.highlightColor!==l){const c={};o||(c.pickingSelectedColor=null),Array.isArray(l)&&(c.pickingHighlightColor=l),Number.isInteger(a)&&(c.pickingSelectedColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setModuleParameters(c)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(e):!1;return n=n||r,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}d(gt,"defaultProps",aR);d(gt,"layerName","Layer");const lR="compositeLayer.renderLayers";class Ql extends gt{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,r)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:f,coordinateOrigin:h,wrapLongitude:p,positionFormat:g,modelMatrix:_,extensions:x,fetch:y,operation:v,_subLayerProps:w}=this.props,S={id:"",updateTriggers:{},opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:f,coordinateOrigin:h,wrapLongitude:p,positionFormat:g,modelMatrix:_,extensions:x,fetch:y,operation:v},P=w&&e.id&&w[e.id],A=P&&P.updateTriggers,C=e.id||"sublayer";if(P){const M=this.constructor._propTypes,R=e.type?e.type._propTypes:{};for(const O in P){const U=R[O]||M[O];U&&U.type==="accessor"&&(P[O]=this.getSubLayerAccessor(P[O]))}}Object.assign(S,e,P),S.id="".concat(this.props.id,"-").concat(C),S.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...A};for(const M of x){const R=M.getSubLayerProps.call(this,M);R&&Object.assign(S,R,{updateTriggers:Object.assign(S.updateTriggers,R.updateTriggers)})}return S}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();if(r){const s=this.renderLayers();i=hd(s,Boolean),this.internalState.subLayers=i}Ne(lR,this,r,i);for(const s of i)s.parent=this}}d(Ql,"layerName","CompositeLayer");const ca=Math.PI/180,Xm=180/Math.PI,Na=6370972,sr=256;function cR(){const t=sr/Na,e=Math.PI/180*sr;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class uR extends rn{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,nearZMultiplier:s=.1,farZMultiplier:o=2,resolution:a=10}=e;let{height:l,altitude:c=1.5}=e;l=l||1,c=Math.max(.75,c);const u=new Ue().lookAt({eye:[0,-c,0],up:[0,0,1]}),f=Math.pow(2,r);u.rotateX(n*ca),u.rotateZ(-i*ca),u.scale(f/l);const h=Math.atan(.5/c),p=sr*2*f/l;super({...e,height:l,viewMatrix:u,longitude:i,latitude:n,zoom:r,distanceScales:cR(),fovyRadians:h*2,focalDistance:c,near:s,far:Math.min(2,1/p+1)*c*o}),d(this,"longitude",void 0),d(this,"latitude",void 0),d(this,"resolution",void 0),this.latitude=n,this.longitude=i,this.resolution=a}get projectionMode(){return Nt.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,this.height/2],n),r=this.unproject([this.width/2,0],n),s=this.unproject([this.width,this.height/2],n),o=this.unproject([this.width/2,this.height],n);return s[0]<this.longitude&&(s[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],s[0],r[0],o[0]),Math.min(i[1],s[1],r[1],o[1]),Math.max(i[0],s[0],r[0],o[0]),Math.max(i[1],s[1],r[1],o[1])]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,{pixelUnprojectionMatrix:l}=this;let c;if(Number.isFinite(o))c=yu(l,[r,a,o,1]);else{const p=yu(l,[r,a,-1,1]),g=yu(l,[r,a,1,1]),_=((i||0)/Na+1)*sr,x=ou(k_([],p,g)),y=ou(p),v=ou(g),w=(4*y*v-(x-y-v)**2)/16,S=4*w/x,P=Math.sqrt(y-S),A=Math.sqrt(Math.max(0,_*_-S)),C=(P-A)/Math.sqrt(x);c=JC([],p,g,C)}const[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(i)?[u,f,i]:[u,f]}projectPosition(e){const[n,i,r=0]=e,s=n*ca,o=i*ca,a=Math.cos(o),l=(r/Na+1)*sr;return[Math.sin(s)*a*l,-Math.cos(s)*a*l,Math.sin(o)*l]}unprojectPosition(e){const[n,i,r]=e,s=oL(e),o=Math.asin(r/s),l=Math.atan2(n,-i)*Xm,c=o*Xm,u=(s/sr-1)*Na;return[l,c,u]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,n){const i=this.unproject(n);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function yu(t,e){const n=Fr([],e,t);return D_(n,n,1/n[3]),n}const _u=Math.PI/180;function fR({height:t,focalDistance:e,orbitAxis:n,rotationX:i,rotationOrbit:r,zoom:s}){const o=n==="Z"?[0,0,1]:[0,1,0],a=n==="Z"?[0,-e,0]:[0,0,e],l=new Ue().lookAt({eye:a,up:o});l.rotateX(i*_u),n==="Z"?l.rotateZ(r*_u):l.rotateY(r*_u);const c=Math.pow(2,s)/t;return l.scale(c),l}class hR extends rn{constructor(e){const{height:n,projectionMatrix:i,fovy:r=50,orbitAxis:s="Z",target:o=[0,0,0],rotationX:a=0,rotationOrbit:l=0,zoom:c=0}=e,u=i?i[5]/2:fd(r);super({...e,longitude:void 0,viewMatrix:fR({height:n||1,focalDistance:u,orbitAxis:s,rotationX:a,rotationOrbit:l,zoom:c}),fovy:r,focalDistance:u,position:o,zoom:c}),d(this,"projectedCenter",void 0),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:n=!0}={}){const[i,r,s=this.projectedCenter[2]]=e,o=n?r:this.height-r,[a,l,c]=yo([i,o,s],this.pixelUnprojectionMatrix);return[a,l,c]}panByPosition(e,n){const i=this.project(e),r=[this.width/2+i[0]-n[0],this.height/2+i[1]-n[1],this.projectedCenter[2]];return{target:this.unproject(r)}}}class dR extends rn{constructor(e){const{longitude:n,latitude:i,modelMatrix:r,bearing:s=0,pitch:o=0,up:a=[0,0,1]}=e,c=new Yl({bearing:s,pitch:o===-90?1e-4:90+o}).toVector3().normalize(),u=r?new Ue(r).transformAsVector(c):c,f=Number.isFinite(i)?Y_({latitude:i}):0,h=Math.pow(2,f),p=new Ue().lookAt({eye:[0,0,0],center:u,up:a}).scale(h);super({...e,zoom:f,viewMatrix:p}),d(this,"longitude",void 0),d(this,"latitude",void 0),this.latitude=i,this.longitude=n}}const os=20;class Ed extends dd{constructor(e){const{width:n,height:i,position:r=[0,0,0],bearing:s=0,pitch:o=0,longitude:a=null,latitude:l=null,maxPitch:c=-90,minPitch:u=90,startRotatePos:f,startBearing:h,startPitch:p,startZoomPosition:g}=e;super({width:n,height:i,position:r,bearing:s,pitch:o,longitude:a,latitude:l,maxPitch:c,minPitch:u},{startRotatePos:f,startBearing:h,startPitch:p,startZoomPosition:g})}panStart(){return this}pan(){return this}panEnd(){return this}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:o}=this.getState(),{width:a,height:l}=this.getViewportProps();if(!r||s===void 0||o===void 0)return this;let c;if(e){const u=(e[0]-r[0])/a,f=(e[1]-r[1])/l;c={bearing:s-u*180,pitch:o-f*90}}else c={bearing:s-n,pitch:o-i};return this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}zoomStart(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}zoom({scale:e}){let{startZoomPosition:n}=this.getState();n||(n=this.getViewportProps().position);const i=this.getDirection();return this._move(i,Math.log2(e)*os,n)}zoomEnd(){return this._getUpdatedState({startZoomPosition:null})}moveLeft(e=os){const n=this.getDirection(!0);return this._move(n.rotateZ({radians:Math.PI/2}),e)}moveRight(e=os){const n=this.getDirection(!0);return this._move(n.rotateZ({radians:-Math.PI/2}),e)}moveUp(e=os){const n=this.getDirection(!0);return this._move(n,e)}moveDown(e=os){const n=this.getDirection(!0);return this._move(n.negate(),e)}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}zoomIn(e=2){return this.zoom({scale:e})}zoomOut(e=2){return this.zoom({scale:1/e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),s!==null&&n.longitude!==null&&Math.abs(s-n.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}_move(e,n,i=this.getViewportProps().position){const r=e.scale(n);return this._getUpdatedState({position:new bt(i).add(r)})}getDirection(e=!1){return new Yl({bearing:this.getViewportProps().bearing,pitch:e?90:90+this.getViewportProps().pitch}).toVector3().normalize()}_getUpdatedState(e){return new Ed({...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{pitch:n,maxPitch:i,minPitch:r,longitude:s,bearing:o}=e;return e.pitch=ge(n,r,i),s!==null&&(s<-180||s>180)&&(e.longitude=El(s+180,360)-180),(o<-180||o>180)&&(e.bearing=El(o+180,360)-180),e}}class pR extends wo{constructor(...e){super(...e),d(this,"ControllerState",Ed),d(this,"transition",{transitionDuration:300,transitionInterpolator:new Dr(["position","pitch","bearing"])})}}class gR extends _o{get ViewportType(){return dR}get ControllerType(){return pR}}d(gR,"displayName","FirstPersonView");class mR extends _o{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}get ViewportType(){return hR}get ControllerType(){return Y3}}d(mR,"displayName","OrbitView");class vR extends n1{applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=ge(r,i,n);const{longitude:s,latitude:o}=e;return(s<-180||s>180)&&(e.longitude=El(s+180,360)-180),e.latitude=ge(o,-89,89),e}}class yR extends wo{constructor(...e){super(...e),d(this,"ControllerState",vR),d(this,"transition",{transitionDuration:300,transitionInterpolator:new Dr(["longitude","latitude","zoom"])}),d(this,"dragMode","pan")}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class _R extends _o{get ViewportType(){return uR}get ControllerType(){return yR}}d(_R,"displayName","GlobeView");class ER{constructor(e){d(this,"opts",void 0),e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&Oi(this.opts,e.opts)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:n}=e.constructor,i={updateTriggers:{}};for(const r in n)if(r in this.props){const s=n[r],o=this.props[r];i[r]=o,s&&s.type==="accessor"&&(i.updateTriggers[r]=this.props.updateTriggers[r],typeof o=="function"&&(i[r]=this.getSubLayerAccessor(o)))}return i}initializeState(e,n){}updateState(e,n){}draw(e,n){}finalizeState(e,n){}}d(ER,"defaultProps",{});class S1{constructor(e){d(this,"opts",void 0),d(this,"typedArrayManager",void 0),d(this,"indexStarts",[0]),d(this,"vertexStarts",[0]),d(this,"vertexCount",0),d(this,"instanceCount",0),d(this,"attributes",void 0),d(this,"_attributeDefs",void 0),d(this,"data",void 0),d(this,"getGeometry",void 0),d(this,"geometryBuffer",void 0),d(this,"buffers",void 0),d(this,"positionSize",void 0),d(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=Mr,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:r,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=n,this.getGeometry=r,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=i,this.normalize=l,s&&(Pe(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),l||(i.positions=s)),this.geometryBuffer=i.positions,Array.isArray(a))for(const c of a)this._rebuildGeometry(c);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?g1(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:r,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in r)o.release(i[a]),i[a]=null;else{const l=s[a];l.copy=n,i[a]=o.allocate(i[a],e,l)}}_forEachGeometry(e,n,i){const{data:r,getGeometry:s}=this,{iterable:o,objectInfo:a}=xo(r,n,i);for(const l of o){a.index++;const c=s?s(l,a):null;e(c,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:r}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},c={};if(e||(n=[0],i=[0]),this.normalize||!o)this._forEachGeometry((f,h)=>{const p=f&&this.normalizeGeometry(f);c[h]=p,i[h+1]=i[h]+(p?this.getGeometrySize(p):0)},a,l),r=i[i.length-1];else if(i=s.startIndices,r=i[s.length]||0,ArrayBuffer.isView(o))r=r||o.length/this.positionSize;else if(o instanceof Q){const f=o.accessor.stride||this.positionSize*4;r=r||o.byteLength/f}else if(o.buffer){const f=o.stride||this.positionSize*4;r=r||o.buffer.byteLength/f}else if(o.value){const f=o.value,h=o.stride/f.BYTES_PER_ELEMENT||this.positionSize;r=r||f.length/h}this._allocate(r,Boolean(e)),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=r;const u={};this._forEachGeometry((f,h)=>{const p=c[h]||f;u.vertexStart=i[h],u.indexStart=n[h];const g=h<i.length-1?i[h+1]:r;u.geometrySize=g-i[h],u.geometryIndex=h,this.updateGeometryAttributes(p,u)},a,l),this.vertexCount=n[n.length-1]}}var wR=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
  // d: distance on the xy plane
  // r: ratio of the current point
  // p: ratio of the peak of the arc
  // h: height multiplier
  // z = f(r) = sqrt(r * (p * 2 - r)) * d * h
  // f(0) = 0
  // f(1) = dz

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;

  // sqrt does not deal with negative values, manually flip source and target if delta.z < 0
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}

// offset vector by strokeWidth pixels
// offset_direction is -1 (left) or 1 (right)
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}

/* Great circle interpolation
 * http://www.movable-type.co.uk/scripts/latlong.html
 */
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;

  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

/* END GREAT CIRCLE */

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));

  // if it's the first point, use next - current as direction
  // otherwise use current - prev
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      // split at the 180th meridian
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  
    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  
  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);

    // common x at longitude=-180
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }

  // Multiply out width and clamp to limits
  // mercator pixels are interpreted as screen pixels
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );

  // extrude
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,xR=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const Pl=[0,0,0,255],TR={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:Pl},getTargetColor:{type:"accessor",value:Pl},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class P1 extends gt{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return super.getShaders({vs:wR,fs:xR,modules:[tn,nn]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:Pl},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:Pl},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:s,greatCircle:o,wrapLongitude:a}=this.props;this.state.model.setUniforms(e).setUniforms({greatCircle:o,widthUnits:ht[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s,useShortestPath:a}).draw()}_getModel(e){let n=[];for(let s=0;s<50;s++)n=n.concat([s,1,0,s,-1,0]);const r=new At(e,{...this.getShaders(),id:this.props.id,geometry:new jt({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0});return r.setUniforms({numSegments:50}),r}}d(P1,"layerName","ArcLayer");d(P1,"defaultProps",TR);const SR=new Uint16Array([0,2,1,0,3,2]),PR=new Float32Array([0,1,0,0,1,0,1,1]);function bR(t,e){if(!e)return AR(t);const n=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),i=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),r=Math.ceil(n/e)+1,s=Math.ceil(i/e)+1,o=(r-1)*(s-1)*6,a=new Uint32Array(o),l=new Float32Array(r*s*2),c=new Float64Array(r*s*3);let u=0,f=0;for(let h=0;h<r;h++){const p=h/(r-1);for(let g=0;g<s;g++){const _=g/(s-1),x=CR(t,p,_);c[u*3+0]=x[0],c[u*3+1]=x[1],c[u*3+2]=x[2]||0,l[u*2+0]=p,l[u*2+1]=1-_,h>0&&g>0&&(a[f++]=u-s,a[f++]=u-s-1,a[f++]=u-1,a[f++]=u-s,a[f++]=u-1,a[f++]=u),u++}}return{vertexCount:o,positions:c,indices:a,texCoords:l}}function AR(t){const e=new Float64Array(12);for(let n=0;n<t.length;n++)e[n*3+0]=t[n][0],e[n*3+1]=t[n][1],e[n*3+2]=t[n][2]||0;return{vertexCount:6,positions:e,indices:SR,texCoords:PR}}function CR(t,e,n){return wi(wi(t[0],t[1],n),wi(t[3],t[2],n),e)}var LR=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`;const MR=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`;var IR=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  return mix(transparentColor, vec4(color, 1.0), alpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat(MR,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`);const RR={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Z.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};class b1 extends gt{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return super.getShaders({vs:LR,fs:IR,modules:[tn,nn]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const n=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:n},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:n},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:n}})}updateState({props:e,oldProps:n,changeFlags:i}){const r=this.getAttributeManager();if(i.extensionsChanged){var s;const{gl:o}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(o),r.invalidateAll()}if(e.bounds!==n.bounds){const o=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(const l in a)o&&o[l]!==a[l]&&r.invalidate(l);this.setState({mesh:a,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==n._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:n}=this.props,i=e.info;if(!i.color||!n)return i.bitmap=null,i;const{width:r,height:s}=n;i.index=0;const o=OR(i.color),a=[Math.floor(o[0]*r),Math.floor(o[1]*s)];return i.bitmap={size:{width:r,height:s},uv:o,pixel:a},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let n=e;return Ym(e)&&(n=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),bR(n,this.context.viewport.resolution)}_getModel(e){return e?new At(e,{...this.getShaders(),id:this.props.id,geometry:new jt({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(e){const{uniforms:n,moduleParameters:i}=e,{model:r,coordinateConversion:s,bounds:o,disablePicking:a}=this.state,{image:l,desaturate:c,transparentColor:u,tintColor:f}=this.props;i.pickingActive&&a||l&&r&&r.setUniforms(n).setUniforms({bitmapTexture:l,desaturate:c,transparentColor:u.map(h=>h/255),tintColor:f.slice(0,3).map(h=>h/255),coordinateConversion:s,bounds:o}).draw()}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:n,DEFAULT:i}=Z;let{_imageCoordinateSystem:r}=this.props;if(r!==i){const{bounds:s}=this.props;if(!Ym(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:n;if(r=r===e?e:n,r===e&&o===n)return{coordinateConversion:-1,bounds:s};if(r===n&&o===e){const a=Cr([s[0],s[1]]),l=Cr([s[2],s[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],l[0],l[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}d(b1,"layerName","BitmapLayer");d(b1,"defaultProps",RR);function OR(t){const[e,n,i]=t,r=(i&240)/256,s=(i&15)/16;return[(e+s)/256,(n+r)/256]}function Ym(t){return Number.isFinite(t[0])}var kR=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  // convert size in meters to pixels, then scaled and clamp
 
  // project meters to pixels and clamp to limits 
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );

  // scale icon height to match instanceSize
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;

  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,NR=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);

  // if colorMode == 0, use pixel color from the texture
  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  // Take the global opacity and the alpha from vColor into account for the alpha component
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const FR=1024,DR=4,Zm=()=>{},zR={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function UR(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function BR(t,e,n,i){return n===e.width&&i===e.height?e:(t.canvas.height=i,t.canvas.width=n,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,e.width,e.height,0,0,n,i),t.canvas)}function Js(t){return t&&(t.id||t.url)}function VR(t,e,n){const i=t.width,r=t.height,s=d_(t,{width:e,height:n});return yb(t,s,{targetY:0,width:i,height:r}),t.delete(),s}function Km(t,e,n){for(let i=0;i<e.length;i++){const{icon:r,xOffset:s}=e[i],o=Js(r);t[o]={...r,x:s,y:n}}}function jR({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const c=t[l],u=Js(c);if(!n[u]){const{height:f,width:h}=c;i+h+e>o&&(Km(n,a,r),i=0,r=s+r+e,s=0,a=[]),a.push({icon:c,xOffset:i}),i=i+h+e,s=Math.max(s,f)}}return a.length>0&&Km(n,a,r),{mapping:n,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:o,canvasHeight:UR(s+r+e)}}function GR(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:r,objectInfo:s}=xo(t);for(const o of r){s.index++;const a=e(o,s),l=Js(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!i[l]&&(!n[l]||a.url!==n[l].url)&&(i[l]={...a,source:o,sourceIndex:s.index})}return i}class WR{constructor(e,{onUpdate:n=Zm,onError:i=Zm}){d(this,"gl",void 0),d(this,"onUpdate",void 0),d(this,"onError",void 0),d(this,"_loadOptions",null),d(this,"_texture",null),d(this,"_externalTexture",null),d(this,"_mapping",{}),d(this,"_pendingCount",0),d(this,"_autoPacking",!1),d(this,"_xOffset",0),d(this,"_yOffset",0),d(this,"_rowHeight",0),d(this,"_buffer",DR),d(this,"_canvasWidth",FR),d(this,"_canvasHeight",0),d(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Js(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:r}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),r&&(this._mapping=r),i){var s;(s=this._texture)===null||s===void 0||s.delete(),this._texture=null,this._externalTexture=i}}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document=="undefined")return;const i=Object.values(GR(e,n,this._mapping)||{});if(i.length>0){const{mapping:r,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:l}=jR({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=r,this._xOffset=s,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=new et(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:zR})),this._texture.height!==this._canvasHeight&&(this._texture=VR(this._texture,this._canvasWidth,this._canvasHeight)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d");for(const i of e)this._pendingCount++,dl(i.url,Ky,this._loadOptions).then(r=>{const s=Js(i),{x:o,y:a,width:l,height:c}=this._mapping[s],u=BR(n,r,l,c);this._texture.setSubImageData({data:u,x:o,y:a,width:l,height:c}),this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const A1=[0,0,0,255],HR={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:A1},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class Jl extends gt{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return super.getShaders({vs:kR,fs:NR,modules:[tn,nn]})}initializeState(){this.state={iconManager:new WR(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:A1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:c}=n,{iconManager:u}=this.state,f=o||this.internalState.isAsyncPropLoading("iconAtlas");if(u.setProps({loadOptions:n.loadOptions,autoPacking:!f,iconAtlas:o,iconMapping:f?a:null}),f?i.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&u.packIcons(l,c),r.extensionsChanged){var h;const{gl:p}=this.context;(h=this.state.model)===null||h===void 0||h.delete(),this.state.model=this._getModel(p),s.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,c=l.getTexture();c&&this.state.model.setUniforms(e).setUniforms({iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeUnits:ht[s],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,billboard:o,alphaCutoff:a}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new At(e,{...this.getShaders(),id:this.props.id,geometry:new jt({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;i?i(e):W.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:r=n/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-r,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:r,height:s}=this.state.iconManager.getIconMapping(e);return[n,i,r,s]}}d(Jl,"defaultProps",HR);d(Jl,"layerName","IconLayer");var $R=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;

// offset vector by strokeWidth pixels
// offset_direction is -1 (left) or 1 (right)
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      // Line is not split, abort
      gl_Position = vec4(0.);
      return;
    }
  }

  // Position
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  
  // linear interpolation of source & target to pick right coord
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Multiply out width and clamp to limits
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );

  // extrude
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Color
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,XR=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const YR=[0,0,0,255],ZR={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:YR},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class C1 extends gt{getShaders(){return super.getShaders({vs:$R,fs:XR,modules:[tn,nn]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:s,wrapLongitude:o}=this.props;this.state.model.setUniforms(e).setUniforms({widthUnits:ht[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s,useShortestPath:o?1:0}).draw(),o&&this.state.model.setUniforms({useShortestPath:-1}).draw()}_getModel(e){const n=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new At(e,{...this.getShaders(),id:this.props.id,geometry:new jt({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}d(C1,"layerName","LineLayer");d(C1,"defaultProps",ZR);var KR=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);

  // position on the containing square in [-1, 1] space
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  // Find the center of the point and add the current vertex
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply lighting
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);

  // Apply opacity to instance color, or return instance picking color
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,qR=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const L1=[0,0,0,255],M1=[0,0,1],QR={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:M1},getColor:{type:"accessor",value:L1},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function JR(t){const{header:e,attributes:n}=t;!e||!n||(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}class I1 extends gt{getShaders(){return super.getShaders({vs:KR,fs:qR,modules:[tn,ad,nn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:M1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:L1}})}updateState(e){const{changeFlags:n,props:i}=e;if(super.updateState(e),n.extensionsChanged){var r;const{gl:s}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}n.dataChanged&&JR(i.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:i}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:ht[i],radiusPixels:n}).draw()}_getModel(e){const n=[];for(let i=0;i<3;i++){const r=i/3*Math.PI*2;n.push(Math.cos(r)*2,Math.sin(r)*2,0)}return new At(e,{...this.getShaders(),id:this.props.id,geometry:new jt({drawMode:4,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}d(I1,"layerName","PointCloudLayer");d(I1,"defaultProps",QR);var eO=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  
  // Multiply out line width and clamp to limits
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;

  // Expand geometry to accomodate edge smoothing
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;

  // position on the containing square in [-1, 1] space
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  }

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,tO=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const qm=[0,0,0,255],nO={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:qm},getLineColor:{type:"accessor",value:qm},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ec extends gt{getShaders(){return super.getShaders({vs:eO,fs:tO,modules:[tn,nn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,stroked:o,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:p}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:o?1:0,filled:a,billboard:l,antialiasing:c,radiusUnits:ht[n],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,lineWidthUnits:ht[u],lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:p}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new At(e,{...this.getShaders(),id:this.props.id,geometry:new jt({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}d(ec,"defaultProps",nO);d(ec,"layerName","ScatterplotLayer");let eo;(function(t){t[t.CLOCKWISE=1]="CLOCKWISE",t[t.COUNTER_CLOCKWISE=-1]="COUNTER_CLOCKWISE"})(eo||(eo={}));function wd(t,e,n={}){return iO(t,n)!==e?(sO(t,n),!0):!1}function iO(t,e={}){return Math.sign(rO(t,e))}function rO(t,e={}){const{start:n=0,end:i=t.length}=e,r=e.size||2;let s=0;for(let o=n,a=i-r;o<i;o+=r)s+=(t[o]-t[a])*(t[o+1]+t[a+1]),a=o;return s/2}function sO(t,e){const{start:n=0,end:i=t.length,size:r=2}=e,s=(i-n)/r,o=Math.floor(s/2);for(let a=0;a<o;++a){const l=n+a*r,c=n+(s-1-a)*r;for(let u=0;u<r;++u){const f=t[l+u];t[l+u]=t[c+u],t[c+u]=f}}}function Dt(t,e){const n=e.length,i=t.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(t[i-n+s]!==e[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[i+r]=e[r];return!0}function Wf(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function to(t,e,n,i,r=[]){const s=i+e*n;for(let o=0;o<n;o++)r[o]=t[s+o];return r}function Hf(t,e,n,i,r=[]){let s,o;if(n&8)s=(i[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(i[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(i[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(i[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)r[a]=(o&1)===a?i[o]:s*(e[a]-t[a])+t[a];return r}function Fa(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function R1(t,e){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let c=[];const u=[c],f=to(t,0,n,o);let h,p;const g=k1(f,r,s,[]),_=[];Dt(c,f);for(let x=1;x<l;x++){for(h=to(t,x,n,o,h),p=Fa(h,g);p;){Hf(f,h,p,g,_);const y=Fa(_,g);y&&(Hf(f,_,y,g,_),p=y),Dt(c,_),Wf(f,_),aO(g,r,p),i&&c.length>n&&(c=[],u.push(c),Dt(c,f)),p=Fa(h,g)}Dt(c,h),Wf(f,h)}return i?u:u[0]}const Qm=0,oO=1;function ua(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function O1(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:t,types:o?new Array(t.length/i).fill(oO):null,holes:e||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:f,types:h,holes:p}=l.shift();lO(f,i,p[0]||f.length,c),u=k1(c[0],r,s,u);const g=Fa(c[1],u);if(g){let _=Jm(f,h,i,0,p[0]||f.length,u,g);const x={pos:_[0].pos,types:_[0].types,holes:[]},y={pos:_[1].pos,types:_[1].types,holes:[]};l.push(x,y);for(let v=0;v<p.length;v++)_=Jm(f,h,i,p[v],p[v+1]||f.length,u,g),_[0]&&(x.holes.push(x.pos.length),x.pos=ua(x.pos,_[0].pos),o&&(x.types=ua(x.types,_[0].types))),_[1]&&(y.holes.push(y.pos.length),y.pos=ua(y.pos,_[1].pos),o&&(y.types=ua(y.types,_[1].types)))}else{const _={positions:f};o&&(_.edgeTypes=h),p.length&&(_.holeIndices=p),a.push(_)}}return a}function Jm(t,e,n,i,r,s,o){const a=(r-i)/n,l=[],c=[],u=[],f=[],h=[];let p,g,_;const x=to(t,a-1,n,i);let y=Math.sign(o&8?x[1]-s[3]:x[0]-s[2]),v=e&&e[a-1],w=0,S=0;for(let P=0;P<a;P++)p=to(t,P,n,i,p),g=Math.sign(o&8?p[1]-s[3]:p[0]-s[2]),_=e&&e[i/n+P],g&&y&&y!==g&&(Hf(x,p,o,s,h),Dt(l,h)&&u.push(v),Dt(c,h)&&f.push(v)),g<=0?(Dt(l,p)&&u.push(_),w-=g):u.length&&(u[u.length-1]=Qm),g>=0?(Dt(c,p)&&f.push(_),S+=g):f.length&&(f[f.length-1]=Qm),Wf(x,p),y=g,v=_;return[w?{pos:l,types:e&&u}:null,S?{pos:c,types:e&&f}:null]}function k1(t,e,n,i){const r=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=s,i[2]=r+e,i[3]=s+e,i}function aO(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function lO(t,e,n,i){let r=1/0,s=-1/0,o=1/0,a=-1/0;for(let l=0;l<n;l+=e){const c=t[l],u=t[l+1];r=c<r?c:r,s=c>s?c:s,o=u<o?u:o,a=u>a?u:a}return i[0][0]=r,i[0][1]=o,i[1][0]=s,i[1][1]=a,i}const cO=85.051129;function uO(t,e){const{size:n=2,startIndex:i=0,endIndex:r=t.length,normalize:s=!0}=e||{},o=t.slice(i,r);N1(o,n,0,r-i);const a=R1(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)F1(l,n);return a}function fO(t,e=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let l=0,c=0;for(let f=0;f<=e.length;f++){const h=e[f]||t.length,p=c,g=hO(t,i,l,h);for(let _=g;_<h;_++)o[c++]=t[_];for(let _=l;_<g;_++)o[c++]=t[_];N1(o,i,p,c),dO(o,i,p,c,n==null?void 0:n.maxLatitude),l=h,a[f]=c}a.pop();const u=O1(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const f of u)F1(f.positions,i);return u}function hO(t,e,n,i){let r=-1,s=-1;for(let o=n+1;o<i;o+=e){const a=Math.abs(t[o]);a>r&&(r=a,s=o-1)}return s}function dO(t,e,n,i,r=cO){const s=t[n],o=t[i-e];if(Math.abs(s-o)>180){const a=to(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,Dt(t,a),a[1]=Math.sign(a[1])*r,Dt(t,a),a[0]=s,Dt(t,a)}}function N1(t,e,n,i){let r=t[0],s;for(let o=n;o<i;o+=e){s=t[o];const a=s-r;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=r=s}}function F1(t,e){let n;const i=t.length/e;for(let s=0;s<i&&(n=t[s*e],(n+180)%360===0);s++);const r=-Math.round(n/360)*360;if(r!==0)for(let s=0;s<i;s++)t[s*e]+=r}class pO extends jt{constructor(e){const{id:n=en("column-geometry")}=e,{indices:i,attributes:r}=gO(e);super({...e,id:n,indices:i,attributes:r})}}function gO(t){const{radius:e,height:n=1,nradial:i=10}=t;let{vertices:r}=t;r&&(W.assert(r.length>=i),r=r.flatMap(p=>[p[0],p[1]]),wd(r,eo.COUNTER_CLOCKWISE));const s=n>0,o=i+1,a=s?o*3+1:i,l=Math.PI*2/i,c=new Uint16Array(s?i*3*2:0),u=new Float32Array(a*3),f=new Float32Array(a*3);let h=0;if(s){for(let p=0;p<o;p++){const g=p*l,_=p%i,x=Math.sin(g),y=Math.cos(g);for(let v=0;v<2;v++)u[h+0]=r?r[_*2]:y*e,u[h+1]=r?r[_*2+1]:x*e,u[h+2]=(1/2-v)*n,f[h+0]=r?r[_*2]:y,f[h+1]=r?r[_*2+1]:x,h+=3}u[h+0]=u[h-3],u[h+1]=u[h-2],u[h+2]=u[h-1],h+=3}for(let p=s?0:1;p<o;p++){const g=Math.floor(p/2)*Math.sign(.5-p%2),_=g*l,x=(g+i)%i,y=Math.sin(_),v=Math.cos(_);u[h+0]=r?r[x*2]:v*e,u[h+1]=r?r[x*2+1]:y*e,u[h+2]=n/2,f[h+2]=1,h+=3}if(s){let p=0;for(let g=0;g<i;g++)c[p++]=g*2+0,c[p++]=g*2+2,c[p++]=g*2+0,c[p++]=g*2+1,c[p++]=g*2+1,c[p++]=g*2+3}return{indices:c,attributes:{POSITION:{size:3,value:u},NORMAL:{size:3,value:f}}}}var mO=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;

// Custom uniforms
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;

// Result
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  // rotate primitive position and normal
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));

  // calculate elevation, if 3d not enabled set to 0
  // cylindar gemoetry height are between -1.0 to 1.0, transform it to between 0, 1
  float elevation = 0.0;
  // calculate stroke offset
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }

  // if alpha == 0.0 or z < 0.0, do not render element
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;

  // project center of column
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Light calculations
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,vO=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;const bl=[0,0,0,255],yO={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:bl},getLineColor:{type:"accessor",value:bl},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class xd extends gt{getShaders(){const{gl:e}=this.context,n=!X(e),i={},r=this.props.flatShading&&f_(e,ee.GLSL_DERIVATIVES);return r&&(i.FLAT_SHADING=1),super.getShaders({vs:mO,fs:vO,defines:i,transpileToGLSL100:n,modules:[tn,r?zL:ad,nn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:bl},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:bl},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=r.extensionsChanged||n.flatShading!==i.flatShading;if(s){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}(s||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices||(n.extruded||n.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(n)}getGeometry(e,n,i){const r=new pO({radius:1,height:i?2:0,vertices:n,nradial:e});let s=0;if(n)for(let o=0;o<e;o++){const a=n[o];s+=Math.sqrt(a[0]*a[0]+a[1]*a[1])/e}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*s}),r}_getModel(e){return new At(e,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:e,vertices:n,extruded:i,stroked:r}){const s=this.getGeometry(e,n,i||r);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3,wireframeVertexCount:s.indices.value.length}),this.state.model.setProps({geometry:s})}draw({uniforms:e}){const{lineWidthUnits:n,lineWidthScale:i,lineWidthMinPixels:r,lineWidthMaxPixels:s,radiusUnits:o,elevationScale:a,extruded:l,filled:c,stroked:u,wireframe:f,offset:h,coverage:p,radius:g,angle:_}=this.props,{model:x,fillVertexCount:y,wireframeVertexCount:v,edgeDistance:w}=this.state;x.setUniforms(e).setUniforms({radius:g,angle:_/180*Math.PI,offset:h,extruded:l,stroked:u,coverage:p,elevationScale:a,edgeDistance:w,radiusUnits:ht[o],widthUnits:ht[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s}),l&&f&&(x.setProps({isIndexed:!0}),x.setVertexCount(v).setDrawMode(1).setUniforms({isStroke:!0}).draw()),c&&(x.setProps({isIndexed:!1}),x.setVertexCount(y).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!l&&u&&(x.setProps({isIndexed:!1}),x.setVertexCount(y*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}d(xd,"layerName","ColumnLayer");d(xd,"defaultProps",yO);const _O={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};class D1 extends xd{getGeometry(e){return new h2}draw({uniforms:e}){const{elevationScale:n,extruded:i,offset:r,coverage:s,cellSize:o,angle:a,radiusUnits:l}=this.props;this.state.model.setUniforms(e).setUniforms({radius:o/2,radiusUnits:ht[l],angle:a,offset:r,extruded:i,coverage:s,elevationScale:n,edgeDistance:1,isWireframe:!1}).draw()}}d(D1,"layerName","GridCellLayer");d(D1,"defaultProps",_O);function EO(t,e,n,i){let r;if(Array.isArray(t[0])){const s=t.length*e;r=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)r[o*e+a]=t[o][a]||0}else r=t;return n?R1(r,{size:e,gridResolution:n}):i?uO(r,{size:e}):r}const wO=1,xO=2,Eu=4;class TO extends S1{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?EO(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(e0(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&e0(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;i.fill(0,s,s+o),r?(i[s]=Eu,i[s+o-2]=Eu):(i[s]+=wO,i[s+o-2]+=xO),i[s+o-1]=Eu}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:r,geometrySize:s}=n,o=new Array(3);for(let a=r,l=0;l<s;a++,l++)this.getPointOnPath(e,l,o),i[a*3]=o[0],i[a*3+1]=o[1],i[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:r}=this;n*r>=e.length&&(n+=1-e.length/r);const s=n*r;return i[0]=e[s],i[1]=e[s+1],i[2]=r===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function e0(t){return Array.isArray(t[0])}var SO=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}

// calculate line join positions
vec3 lineJoin(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  // side of the segment - -1: left, 0: center, 1: right
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);

  // tangent of the corner
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  // direction of the corner
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  // direction of the segment
  vec2 dir = isEnd ? dirA : dirB;
  // direction of the extrusion
  vec2 perp = isEnd ? perpA : perpB;
  // length of the segment
  float L = isEnd ? lenA : lenB;

  // A = angle of the corner
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));

  // -1: right, 1: left
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);

  // relative position to the corner:
  // -1: inside (smaller side of the angle)
  // 0: center
  // 1: outside (bigger side of the angle)
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  // trim if inside corner extends further than the line segment
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);

  // special treatment for start cap and end cap
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;

  // extend out a triangle to envelope the round cap
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }

  // Generate variables for fragment shader
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return currPoint + offset;
}

// In clipspace extrusion, if a line extends behind the camera, clip it to avoid visual artifacts
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    // Extrude in clipspace
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 pos = lineJoin(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);
  } else {
    // Extrude in commonspace
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec4 pos = vec4(
      lineJoin(prevPosition, currPosition, nextPosition, width.xy),
      1.0);
    geometry.position = pos;
    gl_Position = project_common_position_to_clipspace(pos);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,PO=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
/*
 * vPathPosition represents the relative coordinates of the current fragment on the path segment.
 * vPathPosition.x - position along the width of the path, between [-1, 1]. 0 is the center line.
 * vPathPosition.y - position along the length of the path, between [0, L / width].
 */
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    // if joint is rounded, test distance from the corner
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    // trim miter
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const z1=[0,0,0,255],bO={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:z1},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},wu={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class tc extends gt{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return super.getShaders({vs:SO,fs:PO,modules:[tn,nn]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:wu,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:wu,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:wu,defaultValue:z1},instancePickingColors:{size:3,type:5121,accessor:(i,{index:r,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:r,s)}}),this.setState({pathTesselator:new TO({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||r.invalidateAll()}if(i.extensionsChanged){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),r.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:r,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:r,widthUnits:ht[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:c}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new At(e,{...this.getShaders(),id:this.props.id,geometry:new jt({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}d(tc,"defaultProps",bO);d(tc,"layerName","PathLayer");var Td={exports:{}};Td.exports=nc;Td.exports.default=nc;function nc(t,e,n){n=n||2;var i=e&&e.length,r=i?e[0]*n:t.length,s=U1(t,0,r,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,c,u,f,h,p;if(i&&(s=IO(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(var g=n;g<r;g+=n)f=t[g],h=t[g+1],f<a&&(a=f),h<l&&(l=h),f>c&&(c=f),h>u&&(u=h);p=Math.max(c-a,u-l),p=p!==0?1/p:0}return no(s,o,n,a,l,p),o}function U1(t,e,n,i,r){var s,o;if(r===Yf(t,e,n,i)>0)for(s=e;s<n;s+=i)o=t0(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=t0(s,t[s],t[s+1],o);return o&&ic(o,o.next)&&(ro(o),o=o.next),o}function ti(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(ic(n,n.next)||ce(n.prev,n,n.next)===0)){if(ro(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function no(t,e,n,i,r,s,o){if(!!t){!o&&s&&FO(t,i,r,s);for(var a=t,l,c;t.prev!==t.next;){if(l=t.prev,c=t.next,s?CO(t,i,r,s):AO(t)){e.push(l.i/n),e.push(t.i/n),e.push(c.i/n),ro(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=LO(ti(t),e,n),no(t,e,n,i,r,s,2)):o===2&&MO(t,e,n,i,r,s):no(ti(t),e,n,i,r,s,1);break}}}}function AO(t){var e=t.prev,n=t,i=t.next;if(ce(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(or(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&ce(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function CO(t,e,n,i){var r=t.prev,s=t,o=t.next;if(ce(r,s,o)>=0)return!1;for(var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,l=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,c=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,f=$f(a,l,e,n,i),h=$f(c,u,e,n,i),p=t.prevZ,g=t.nextZ;p&&p.z>=f&&g&&g.z<=h;){if(p!==t.prev&&p!==t.next&&or(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&ce(p.prev,p,p.next)>=0||(p=p.prevZ,g!==t.prev&&g!==t.next&&or(r.x,r.y,s.x,s.y,o.x,o.y,g.x,g.y)&&ce(g.prev,g,g.next)>=0))return!1;g=g.nextZ}for(;p&&p.z>=f;){if(p!==t.prev&&p!==t.next&&or(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&ce(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=h;){if(g!==t.prev&&g!==t.next&&or(r.x,r.y,s.x,s.y,o.x,o.y,g.x,g.y)&&ce(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function LO(t,e,n){var i=t;do{var r=i.prev,s=i.next.next;!ic(r,s)&&B1(r,i,i.next,s)&&io(r,s)&&io(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),ro(i),ro(i.next),i=t=s),i=i.next}while(i!==t);return ti(i)}function MO(t,e,n,i,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&UO(o,a)){var l=V1(o,a);o=ti(o,o.next),l=ti(l,l.next),no(o,e,n,i,r,s),no(l,e,n,i,r,s);return}a=a.next}o=o.next}while(o!==t)}function IO(t,e,n,i){var r=[],s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,c=U1(t,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(zO(c));for(r.sort(RO),s=0;s<r.length;s++)n=OO(r[s],n),n=ti(n,n.next);return n}function RO(t,e){return t.x-e.x}function OO(t,e){var n=kO(t,e);if(!n)return e;var i=V1(n,t),r=ti(n,n.next);return ti(i,i.next),e===n?r:e}function kO(t,e){var n=e,i=t.x,r=t.y,s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s){if(s=a,a===i){if(r===n.y)return n;if(r===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(i===s)return o;var l=o,c=o.x,u=o.y,f=1/0,h;n=o;do i>=n.x&&n.x>=c&&i!==n.x&&or(r<u?i:s,r,c,u,r<u?s:i,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(i-n.x),io(n,t)&&(h<f||h===f&&(n.x>o.x||n.x===o.x&&NO(o,n)))&&(o=n,f=h)),n=n.next;while(n!==l);return o}function NO(t,e){return ce(t.prev,t,e.prev)<0&&ce(e.next,t,t.next)<0}function FO(t,e,n,i){var r=t;do r.z===null&&(r.z=$f(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,DO(r)}function DO(t){var e,n,i,r,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1);return t}function $f(t,e,n,i,r){return t=32767*(t-n)*r,e=32767*(e-i)*r,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function zO(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function or(t,e,n,i,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(i-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function UO(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!BO(t,e)&&(io(t,e)&&io(e,t)&&VO(t,e)&&(ce(t.prev,t,e.prev)||ce(t,e.prev,e))||ic(t,e)&&ce(t.prev,t,t.next)>0&&ce(e.prev,e,e.next)>0)}function ce(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function ic(t,e){return t.x===e.x&&t.y===e.y}function B1(t,e,n,i){var r=ha(ce(t,e,n)),s=ha(ce(t,e,i)),o=ha(ce(n,i,t)),a=ha(ce(n,i,e));return!!(r!==s&&o!==a||r===0&&fa(t,n,e)||s===0&&fa(t,i,e)||o===0&&fa(n,t,i)||a===0&&fa(n,e,i))}function fa(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function ha(t){return t>0?1:t<0?-1:0}function BO(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&B1(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function io(t,e){return ce(t.prev,t,t.next)<0?ce(t,e,t.next)>=0&&ce(t,t.prev,e)>=0:ce(t,e,t.prev)<0||ce(t,t.next,e)<0}function VO(t,e){var n=t,i=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function V1(t,e){var n=new Xf(t.i,t.x,t.y),i=new Xf(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function t0(t,e,n,i){var r=new Xf(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function ro(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Xf(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}nc.deviation=function(t,e,n,i){var r=e&&e.length,s=r?e[0]*n:t.length,o=Math.abs(Yf(t,0,s,n));if(r)for(var a=0,l=e.length;a<l;a++){var c=e[a]*n,u=a<l-1?e[a+1]*n:t.length;o-=Math.abs(Yf(t,c,u,n))}var f=0;for(a=0;a<i.length;a+=3){var h=i[a]*n,p=i[a+1]*n,g=i[a+2]*n;f+=Math.abs((t[h]-t[g])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[g+1]-t[h+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function Yf(t,e,n,i){for(var r=0,s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}nc.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[r][s][o]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n};var jO=Td.exports;const da=eo.CLOCKWISE,n0=eo.COUNTER_CLOCKWISE,jn={isClosed:!0};function GO(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function ps(t){return"positions"in t?t.positions:t}function Da(t){return"holeIndices"in t?t.holeIndices:null}function WO(t){return Array.isArray(t[0])}function HO(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function $O(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function XO(t,e,n,i){for(let r=0;r<e;r++)if(t[n+r]!==t[i-e+r])return!1;return!0}function i0(t,e,n,i,r){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let l=0;l<i;l++)t[s++]=n[a][l]||0;if(!$O(n))for(let a=0;a<i;a++)t[s++]=n[0][a]||0;return jn.start=e,jn.end=s,jn.size=i,wd(t,r,jn),s}function r0(t,e,n,i,r=0,s,o){s=s||n.length;const a=s-r;if(a<=0)return e;let l=e;for(let c=0;c<a;c++)t[l++]=n[r+c];if(!XO(n,i,r,s))for(let c=0;c<i;c++)t[l++]=n[r+c];return jn.start=e,jn.end=l,jn.size=i,wd(t,o,jn),l}function j1(t,e){GO(t);const n=[],i=[];if("positions"in t){const{positions:r,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=r0(n,o,r,e,s[a-1],s[a],a===0?da:n0),i.push(o);return i.pop(),{positions:n,holeIndices:i}}t=r}if(!WO(t))return r0(n,0,t,e,0,n.length,da),n;if(!HO(t)){let r=0;for(const[s,o]of t.entries())r=i0(n,r,o,e,s===0?da:n0),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return i0(n,0,t,e,da),n}function YO(t,e,n){let i=Da(t);i&&(i=i.map(s=>s/e));let r=ps(t);if(n){const s=r.length;r=r.slice();const o=[];for(let a=0;a<s;a+=e){o[0]=r[a],o[1]=r[a+1];const l=n(o);r[a]=l[0],r[a+1]=l[1]}}return jO(r,i,e)}class ZO extends S1{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=j1(e,this.positionSize);return this.opts.resolution?O1(ps(n),Da(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?fO(ps(n),Da(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(s0(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return ps(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&s0(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:r}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let l=s.indices;if(!l||!e)return;let c=r;const u=YO(e,this.positionSize,this.opts.preproject);l=a.allocate(l,r+u.length,{copy:!0});for(let f=0;f<u.length;f++)l[c++]=u[f]+i;o[n+1]=r+u.length,s.indices=l}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:r},positionSize:s}=this;if(!r||!e)return;const o=ps(e);for(let a=n,l=0;l<i;a++,l++){const c=o[l*s],u=o[l*s+1],f=s>2?o[l*s+2]:0;r[a*3]=c,r[a*3+1]=u,r[a*3+2]=f}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:r}=this,s=this.attributes.vertexValid,o=e&&Da(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+i),o)for(let a=0;a<o.length;a++)s[n+o[a]/r-1]=0;s[n+i-1]=0}}function s0(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}var G1=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,KO=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(G1,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),qO=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(G1,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),QO=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const Al=[0,0,0,255],JO={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Al},getLineColor:{type:"accessor",value:Al},material:!0},pa={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class rc extends gt{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?KO:qO,fs:QO,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[tn,ad,nn]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:i}=this.props;n.isGeospatial&&i===Z.DEFAULT&&(i=Z.LNGLAT),this.setState({numInstances:0,polygonTesselator:new ZO({preproject:i===Z.LNGLAT&&n.projectFlat.bind(n),fp64:this.use64bitPositions(),IndexType:!e||td(e,ee.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const r=this.getAttributeManager(),s=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:pa,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,transition:pa,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:pa,accessor:"getFillColor",defaultValue:Al,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:pa,accessor:"getLineColor",defaultValue:Al,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(o,{index:a,target:l})=>this.encodePickingColor(o&&o.__source?o.__source.index:a,l),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:r,elevationScale:s}=this.props,{topModel:o,sideModel:a,polygonTesselator:l}=this.state,c={...e,extruded:Boolean(n),elevationScale:s};a&&(a.setInstanceCount(l.instanceCount-1),a.setUniforms(c),r&&(a.setDrawMode(3),a.setUniforms({isWireframe:!0}).draw()),i&&(a.setDrawMode(6),a.setUniforms({isWireframe:!1}).draw())),o&&(o.setVertexCount(l.vertexCount),o.setUniforms(c).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager();if(r.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded){var a;(a=this.state.models)===null||a===void 0||a.forEach(l=>l.delete()),this.setState(this._getModels(this.context.gl)),s.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:i,extruded:r}=this.props;let s,o;if(i){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1,s=new At(e,{...a,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return r&&(o=new At(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new jt({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),o.userData.excludeAttributes={indices:!0}),{models:[o,s].filter(Boolean),topModel:s,sideModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}d(rc,"defaultProps",JO);d(rc,"layerName","SolidPolygonLayer");function W1({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,o=t.length;let a=o,l=o;for(let h=0;h<o;h++){const p=e(t[h]);if(a>h&&p>=r&&(a=h),p>=s){l=h;break}}let c=a;const f=l-a!==i.length?t.slice(l):void 0;for(let h=0;h<i.length;h++)t[c++]=i[h];if(f){for(let h=0;h<f.length;h++)t[c++]=f[h];t.length=c}return{startRow:a,endRow:a+i.length}}const H1=[0,0,0,255],ek=[0,0,0,255],tk={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:ek},getLineColor:{type:"accessor",value:H1},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class $1 extends Ql{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&W.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(n&&Array.isArray(e.dataChanged)){const i=this.state.paths.slice(),r=e.dataChanged.map(s=>W1({data:i,getIndex:o=>o.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:i,pathsDiff:r})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:n,getPolygon:i,positionFormat:r,_normalize:s}=this.props,o=[],a=r==="XY"?2:3,{startRow:l,endRow:c}=e,{iterable:u,objectInfo:f}=xo(n,l,c);for(const h of u){f.index++;let p=i(h,f);s&&(p=j1(p,a));const{holeIndices:g}=p,_=p.positions||p;if(g)for(let x=0;x<=g.length;x++){const y=_.slice(g[x-1]||0,g[x]||_.length);o.push(this.getSubLayerRow({path:y},h,f.index))}else o.push(this.getSubLayerRow({path:_},h,f.index))}return o}renderLayers(){const{data:e,_dataDiff:n,stroked:i,filled:r,extruded:s,wireframe:o,_normalize:a,_windingOrder:l,elevationScale:c,transitions:u,positionFormat:f}=this.props,{lineWidthUnits:h,lineWidthScale:p,lineWidthMinPixels:g,lineWidthMaxPixels:_,lineJointRounded:x,lineMiterLimit:y,lineDashJustified:v}=this.props,{getFillColor:w,getLineColor:S,getLineWidth:P,getLineDashArray:A,getElevation:C,getPolygon:M,updateTriggers:R,material:O}=this.props,{paths:U,pathsDiff:B}=this.state,j=this.getSubLayerClass("fill",rc),H=this.getSubLayerClass("stroke",tc),$e=this.shouldRenderSubLayer("fill",U)&&new j({_dataDiff:n,extruded:s,elevationScale:c,filled:r,wireframe:o,_normalize:a,_windingOrder:l,getElevation:C,getFillColor:w,getLineColor:s&&o?S:H1,material:O,transitions:u},this.getSubLayerProps({id:"fill",updateTriggers:R&&{getPolygon:R.getPolygon,getElevation:R.getElevation,getFillColor:R.getFillColor,lineColors:s&&o,getLineColor:R.getLineColor}}),{data:e,positionFormat:f,getPolygon:M}),si=!s&&i&&this.shouldRenderSubLayer("stroke",U)&&new H({_dataDiff:B&&(()=>B),widthUnits:h,widthScale:p,widthMinPixels:g,widthMaxPixels:_,jointRounded:x,miterLimit:y,dashJustified:v,_pathType:"loop",transitions:u&&{getWidth:u.getLineWidth,getColor:u.getLineColor,getPath:u.getPolygon},getColor:this.getSubLayerAccessor(S),getWidth:this.getSubLayerAccessor(P),getDashArray:this.getSubLayerAccessor(A)},this.getSubLayerProps({id:"stroke",updateTriggers:R&&{getWidth:R.getLineWidth,getColor:R.getLineColor,getDashArray:R.getLineDashArray}}),{data:U,positionFormat:f,getPath:An=>An.path});return[!s&&$e,si,s&&$e]}}d($1,"layerName","PolygonLayer");d($1,"defaultProps",tk);function nk(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?ik(t,i,n):null}function ik(t,e,n){const i={properties:{...t.properties[e]}};for(const r in t.numericProps)i.properties[r]=t.numericProps[r].value[n];return i}function rk(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const r=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(r.length*3);const s=[];for(let o=0;o<r.length;o++)e(r[o],s),n[i][o*3+0]=s[0],n[i][o*3+1]=s[1],n[i][o*3+2]=s[2]}return n}var sk=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float buffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;

    // if enable sdf (signed distance fields)
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }

    // Take the global opacity and the alpha from color into account for the alpha component
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const o0=192/256,a0=[],ok={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Sd extends Jl{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:sk}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:i,target:r})=>this.encodePickingColor(i,r)}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:r}=n;r!==i.outlineColor&&(r=r.map(s=>s/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!n.sdf&&n.outlineWidth&&W.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:i,outlineWidth:r}=this.props,{outlineColor:s}=this.state;e.uniforms={...e.uniforms,buffer:o0,outlineBuffer:r?Math.max(i,o0*(1-r)):-1,gamma:i,sdf:Boolean(n),outlineColor:s},super.draw(e)}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):a0}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):a0}}d(Sd,"defaultProps",ok);d(Sd,"layerName","MultiIconLayer");var Pd={exports:{}};Pd.exports=To;Pd.exports.default=To;var gr=1e20;function To(t,e,n,i,r,s){this.fontSize=t||24,this.buffer=e===void 0?3:e,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=s||"normal",this.radius=n||8;var o=this.size=this.fontSize+this.buffer*2,a=o+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ak(t,e,n,i,r,s,o){s.fill(gr,0,e*n),o.fill(0,0,e*n);for(var a=(e-i)/2,l=0;l<r;l++)for(var c=0;c<i;c++){var u=(l+a)*e+c+a,f=t.data[4*(l*i+c)+3]/255;if(f===1)s[u]=0,o[u]=gr;else if(f===0)s[u]=gr,o[u]=0;else{var h=Math.max(0,.5-f),p=Math.max(0,f-.5);s[u]=h*h,o[u]=p*p}}}function lk(t,e,n,i,r,s,o){for(var a=0;a<e*n;a++){var l=Math.sqrt(i[a])-Math.sqrt(r[a]);t[a]=Math.round(255-255*(l/s+o))}}To.prototype._draw=function(t,e){var n=this.ctx.measureText(t),i=n.width,r=2*this.buffer,s,o,a,l,c,u,f,h;e&&this.useMetrics?(c=Math.floor(n.actualBoundingBoxAscent),h=this.buffer+Math.ceil(n.actualBoundingBoxAscent),u=this.buffer,f=this.buffer,o=Math.min(this.size,Math.ceil(n.actualBoundingBoxRight-n.actualBoundingBoxLeft)),l=Math.min(this.size-u,Math.ceil(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)),s=o+r,a=l+r,this.ctx.textBaseline="alphabetic"):(s=o=this.size,a=l=this.size,c=19*this.fontSize/24,u=f=0,h=this.middle,this.ctx.textBaseline="middle");var p;o&&l&&(this.ctx.clearRect(f,u,o,l),this.ctx.fillText(t,this.buffer,h),p=this.ctx.getImageData(f,u,o,l));var g=new Uint8ClampedArray(s*a);return ak(p,s,a,o,l,this.gridOuter,this.gridInner),l0(this.gridOuter,s,a,this.f,this.v,this.z),l0(this.gridInner,s,a,this.f,this.v,this.z),lk(g,s,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:g,metrics:{width:o,height:l,sdfWidth:s,sdfHeight:a,top:c,left:0,advance:i}}};To.prototype.draw=function(t){return this._draw(t,!1).data};To.prototype.drawWithMetrics=function(t){return this._draw(t,!0)};function l0(t,e,n,i,r,s){for(var o=0;o<e;o++)c0(t,o,e,n,i,r,s);for(var a=0;a<n;a++)c0(t,a*e,1,e,i,r,s)}function c0(t,e,n,i,r,s,o){var a,l,c,u;for(s[0]=0,o[0]=-gr,o[1]=gr,a=0;a<i;a++)r[a]=t[e+a*n];for(a=1,l=0,c=0;a<i;a++){do u=s[l],c=(r[a]-r[u]+a*a-u*u)/(a-u)/2;while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=gr}for(a=0,l=0;a<i;a++){for(;o[l+1]<a;)l++;u=s[l],t[e+a*n]=r[u]+(a-u)*(a-u)}}var ck=Pd.exports;const uk=32,fk=[];function hk(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function dk({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o;for(const f of t)if(!s[f]){const h=e(f);c+h+i*2>r&&(c=0,l++),s[f]={x:c+i,y:a+l*(n+i*2)+i,width:h,height:n},c+=h+i*2}const u=n+i*2;return{mapping:s,xOffset:c,yOffset:a+l*u,canvasHeight:hk(a+(l+1)*u)}}function X1(t,e,n,i){let r=0;for(let o=e;o<n;o++){var s;const a=t[o];r+=((s=i[a])===null||s===void 0?void 0:s.width)||0}return r}function Y1(t,e,n,i,r,s){let o=e,a=0;for(let l=e;l<n;l++){const c=X1(t,l,l+1,r);a+c>i&&(o<l&&s.push(l),o=l,a=0),a+=c}return a}function pk(t,e,n,i,r,s){let o=e,a=e,l=e,c=0;for(let u=e;u<n;u++)if((t[u]===" "||t[u+1]===" "||u+1===n)&&(l=u+1),l>a){let f=X1(t,a,l,r);c+f>i&&(o<a&&(s.push(a),o=a,c=0),f>i&&(f=Y1(t,a,l,i,r,s),o=s[s.length-1])),a=l,c+=f}return c}function gk(t,e,n,i,r=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?Y1(t,r,s,n,i,o):pk(t,r,s,n,i,o),o}function mk(t,e,n,i,r,s){let o=0,a=0;for(let l=e;l<n;l++){const c=t[l],u=i[c];u?(a||(a=u.height),r[l]=o+u.width/2,o+=u.width):(W.warn("Missing character: ".concat(c," (").concat(c.codePointAt(0),")"))(),r[l]=o,o+=uk)}s[0]=o,s[1]=a}function u0(t,e,n,i,r){const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),c=new Array(o),u=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,f=[0,0],h=[0,0];let p=0,g=0,_=0;for(let x=0;x<=o;x++){const y=s[x];if((y===`
`||x===o)&&(_=x),_>g){const v=u?gk(s,n,i,r,g,_):fk;for(let w=0;w<=v.length;w++){const S=w===0?g:v[w-1],P=w<v.length?v[w]:_;mk(s,S,P,r,a,h);for(let A=S;A<P;A++)l[A]=p+h[1]/2,c[A]=h[0];p=p+h[1]*e,f[0]=Math.max(f[0],h[0])}g=_}y===`
`&&(a[g]=0,l[g]=0,c[g]=0,g++)}return f[1]=p,{x:a,y:l,rowWidth:c,size:f}}function vk({value:t,length:e,stride:n,offset:i,startIndices:r,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=i?i/o:0,c=r[e]||Math.ceil((t.length-l)/a),u=s&&new Set,f=new Array(e);let h=t;if(a>1||l>0){const p=t.constructor;h=new p(c);for(let g=0;g<c;g++)h[g]=t[g*a+l]}for(let p=0;p<e;p++){const g=r[p],_=r[p+1]||c,x=h.subarray(g,_);f[p]=String.fromCodePoint.apply(null,x),u&&x.forEach(u.add,u)}if(u)for(const p of u)s.add(String.fromCodePoint(p));return{texts:f,characterCount:c}}class Z1{constructor(e=5){d(this,"limit",void 0),d(this,"_cache",{}),d(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function yk(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Cs={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:yk(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},f0=1024,_k=.9,h0=1.2,K1=3;let Cl=new Z1(K1);function Ek(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const i=Cl.get(t);if(!i)return n;for(const r in i.mapping)n.has(r)&&n.delete(r);return n}function wk(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function d0(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function xk(t){W.assert(Number.isFinite(t)&&t>=K1,"Invalid cache limit"),Cl=new Z1(t)}class Tk{constructor(){d(this,"props",{...Cs}),d(this,"_key",void 0),d(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return h0}setProps(e={}){Object.assign(this.props,e);const n=this._key;this._key=this._getKey();const i=Ek(this._key,this.props.characterSet),r=Cl.get(this._key);if(r&&i.size===0){this._key!==n&&(this._atlas=r);return}const s=this._generateFontAtlas(this._key,i,r);this._atlas=s,Cl.set(this._key,s)}_generateFontAtlas(e,n,i){const{fontFamily:r,fontWeight:s,fontSize:o,buffer:a,sdf:l,radius:c,cutoff:u}=this.props;let f=i&&i.data;f||(f=document.createElement("canvas"),f.width=f0);const h=f.getContext("2d");d0(h,r,o,s);const{mapping:p,canvasHeight:g,xOffset:_,yOffset:x}=dk({getFontWidth:y=>h.measureText(y).width,fontHeight:o*h0,buffer:a,characterSet:n,maxCanvasWidth:f0,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(f.height!==g){const y=h.getImageData(0,0,f.width,f.height);f.height=g,h.putImageData(y,0,0)}if(d0(h,r,o,s),l){const y=new ck(o,a,c,u,r,s),v=h.getImageData(0,0,y.size,y.size);for(const w of n)wk(y.draw(w),v),h.putImageData(v,p[w].x-a,p[w].y+a)}else for(const y of n)h.fillText(y,p[y].x,p[y].y+o*_k);return{xOffset:_,yOffset:x,mapping:p,data:f,width:f.width,height:f.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:r,sdf:s,radius:o,cutoff:a}=this.props;return s?"".concat(e," ").concat(n," ").concat(i," ").concat(r," ").concat(o," ").concat(a):"".concat(e," ").concat(n," ").concat(i," ").concat(r)}}var Sk=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;

  // convert size in meters to pixels, then scaled and clamp

  // project meters to pixels and clamp to limits
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Pk=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const bk={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class bd extends gt{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return super.getShaders({vs:Sk,fs:Pk,modules:[tn,nn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var i;const{gl:r}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:i,sizeUnits:r,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:Boolean(a),padding:l,sizeUnits:ht[r],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:o}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new At(e,{...this.getShaders(),id:this.props.id,geometry:new jt({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}d(bd,"defaultProps",bk);d(bd,"layerName","TextBackgroundLayer");const p0={start:1,middle:0,end:-1},g0={top:1,center:0,bottom:-1},xu=[0,0,0,255],Ak=1,Ck={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:xu},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Cs.characterSet},fontFamily:Cs.fontFamily,fontWeight:Cs.fontWeight,lineHeight:Ak,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:xu},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:xu},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Ad extends Ql{constructor(...e){super(...e),d(this,"state",void 0),d(this,"getBoundingRect",(n,i)=>{const r=this.state.fontAtlasManager.mapping,s=this.state.getText,{wordBreak:o,maxWidth:a,lineHeight:l,getTextAnchor:c,getAlignmentBaseline:u}=this.props,f=s(n,i)||"",{size:[h,p]}=u0(f,l,o,a,r),g=p0[typeof c=="function"?c(n,i):c],_=g0[typeof u=="function"?u(n,i):u];return[(g-1)*h/2,(_-1)*p/2,h,p]}),d(this,"getIconOffsets",(n,i)=>{const r=this.state.fontAtlasManager.mapping,s=this.state.getText,{wordBreak:o,maxWidth:a,lineHeight:l,getTextAnchor:c,getAlignmentBaseline:u}=this.props,f=s(n,i)||"",{x:h,y:p,rowWidth:g,size:[_,x]}=u0(f,l,o,a,r),y=p0[typeof c=="function"?c(n,i):c],v=g0[typeof u=="function"?u(n,i):u],w=h.length,S=new Array(w*2);let P=0;for(let A=0;A<w;A++){const C=(1-y)*(_-g[A])/2;S[P++]=(y-1)*_/2+C+h[A],S[P++]=(v-1)*x/2+p[A]}return S})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new Tk}}updateState(e){const{props:n,oldProps:i,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:i}=this.props,{fontAtlasManager:r,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:i};if(!r.mapping)return r.setProps(o),!0;for(const a in o)if(o[a]!==r.props[a])return r.setProps(o),!0;return!1}_updateText(){var e;const{data:n,characterSet:i}=this.props,r=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:s}=this.props,o=n.startIndices,a;const l=i==="auto"&&new Set;if(r&&o){const{texts:c,characterCount:u}=vk({...ArrayBuffer.isView(r)?{value:r}:r,length:n.length,startIndices:o,characterSet:l});a=u,s=(f,{index:h})=>c[h]}else{const{iterable:c,objectInfo:u}=xo(n);o=[0],a=0;for(const f of c){u.index++;const h=Array.from(s(f,u)||"");l&&h.forEach(l.add,l),a+=h.length,o.push(a)}}this.setState({getText:s,startIndices:o,numInstances:a,characterSet:l||i})}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:r,texture:s,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:c,getPosition:u,getColor:f,getSize:h,getAngle:p,getPixelOffset:g,getBackgroundColor:_,getBorderColor:x,getBorderWidth:y,backgroundPadding:v,background:w,billboard:S,fontSettings:P,outlineWidth:A,outlineColor:C,sizeScale:M,sizeUnits:R,sizeMinPixels:O,sizeMaxPixels:U,transitions:B,updateTriggers:j}=this.props,H=this.getSubLayerClass("characters",Sd),$e=this.getSubLayerClass("background",bd);return[w&&new $e({getFillColor:_,getLineColor:x,getLineWidth:y,padding:v,getPosition:u,getSize:h,getAngle:p,getPixelOffset:g,billboard:S,sizeScale:M/this.state.fontAtlasManager.props.fontSize,sizeUnits:R,sizeMinPixels:O,sizeMaxPixels:U,transitions:B&&{getPosition:B.getPosition,getAngle:B.getAngle,getSize:B.getSize,getFillColor:B.getBackgroundColor,getLineColor:B.getBorderColor,getLineWidth:B.getBorderWidth,getPixelOffset:B.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:j.getPosition,getAngle:j.getAngle,getSize:j.getSize,getFillColor:j.getBackgroundColor,getLineColor:j.getBorderColor,getLineWidth:j.getBorderWidth,getPixelOffset:j.getPixelOffset,getBoundingRect:{getText:j.getText,getTextAnchor:j.getTextAnchor,getAlignmentBaseline:j.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:c,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new H({sdf:P.sdf,smoothing:Number.isFinite(P.smoothing)?P.smoothing:Cs.smoothing,outlineWidth:A,outlineColor:C,iconAtlas:s,iconMapping:o,getPosition:u,getColor:f,getSize:h,getAngle:p,getPixelOffset:g,billboard:S,sizeScale:M*r,sizeUnits:R,sizeMinPixels:O*r,sizeMaxPixels:U*r,transitions:B&&{getPosition:B.getPosition,getAngle:B.getAngle,getColor:B.getColor,getSize:B.getSize,getPixelOffset:B.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:j.getText,getPosition:j.getPosition,getAngle:j.getAngle,getColor:j.getColor,getSize:j.getSize,getPixelOffset:j.getPixelOffset,getIconOffsets:{getText:j.getText,getTextAnchor:j.getTextAnchor,getAlignmentBaseline:j.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:c,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){xk(e)}}d(Ad,"defaultProps",Ck);d(Ad,"layerName","TextLayer");const za={circle:{type:ec,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Jl,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Ad,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Ua={type:tc,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Zf={type:rc,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function as({type:t,props:e}){const n={};for(const i in e)n[i]=t.defaultProps[e[i]];return n}function Tu(t,e){const{transitions:n,updateTriggers:i}=t.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),r.updateTriggers[o]=i[s],n&&(r.transitions[o]=n[s])),r[o]=a}return r}function Lk(t){if(Array.isArray(t))return t;switch(W.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return W.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function m0(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=t.length}=n;for(let o=r;o<s;o++){const a=t[o];W.assert(a&&a.geometry,"GeoJSON does not have geometry");const{geometry:l}=a;if(l.type==="GeometryCollection"){W.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");const{geometries:c}=l;for(let u=0;u<c.length;u++){const f=c[u];v0(f,i,e,a,o)}}else v0(l,i,e,a,o)}return i}function v0(t,e,n,i,r){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=e;if(!Ik(s,o)){W.warn("".concat(s," coordinates are malformed"))();return}switch(s){case"Point":a.push(n({geometry:t},i,r));break;case"MultiPoint":o.forEach(f=>{a.push(n({geometry:{type:"Point",coordinates:f}},i,r))});break;case"LineString":l.push(n({geometry:t},i,r));break;case"MultiLineString":o.forEach(f=>{l.push(n({geometry:{type:"LineString",coordinates:f}},i,r))});break;case"Polygon":c.push(n({geometry:t},i,r)),o.forEach(f=>{u.push(n({geometry:{type:"LineString",coordinates:f}},i,r))});break;case"MultiPolygon":o.forEach(f=>{c.push(n({geometry:{type:"Polygon",coordinates:f}},i,r)),f.forEach(h=>{u.push(n({geometry:{type:"LineString",coordinates:h}},i,r))})});break}}const Mk={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Ik(t,e){let n=Mk[t];for(W.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function q1(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function ga(t){return t.geometry.coordinates}function Rk(t,e){const n=q1(),{pointFeatures:i,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=ga,n.lines.data=r,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=ga,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=ga,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=ga,n}function Ok(t,e){const n=q1(),{points:i,lines:r,polygons:s}=t,o=rk(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const kk=["points","linestrings","polygons"],Nk={...as(za.circle),...as(za.icon),...as(za.text),...as(Ua),...as(Zf),stroked:!0,filled:!0,extruded:!1,wireframe:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Q1 extends Ql{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:i}=this.props,r=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const i=Ok(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:n}){const i=Lk(e.data),r=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(n.dataChanged)){const l=this.state.features;for(const c in l)s[c]=l[c].slice(),o[c]=[];for(const c of n.dataChanged){const u=m0(i,r,c);for(const f in l)o[f].push(W1({data:s[f],getIndex:h=>h.__source.index,dataRange:c,replace:u[f]}))}}else s=m0(i,r);const a=Rk(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i,sourceLayer:r}=n;return n.featureType=kk.find(s=>r.id.startsWith("".concat(this.id,"-").concat(s,"-"))),i>=0&&r.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[i]),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),i=e.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(n)===i&&r.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,r="polygons-fill",s=this.shouldRenderSubLayer(r,i.polygons.data)&&this.getSubLayerClass(r,Zf.type);if(s){const o=Tu(this,Zf.props),a=e&&n;return a||delete o.getLineColor,o.updateTriggers.lineColors=a,new s(o,this.getSubLayerProps({id:r,updateTriggers:o.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,r="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(r,i.polygonsOutline.data)&&this.getSubLayerClass(r,Ua.type),a=this.shouldRenderSubLayer(s,i.lines.data)&&this.getSubLayerClass(s,Ua.type);if(o||a){const l=Tu(this,Ua.props);return[o&&new o(l,this.getSubLayerProps({id:r,updateTriggers:l.updateTriggers}),i.polygonsOutline),a&&new a(l,this.getSubLayerProps({id:s,updateTriggers:l.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:r}=this.props;!i&&Number.isFinite(r)&&(r=n.points.data.findIndex(a=>a.__source.index===r));const s=new Set(e.split("+")),o=[];for(const a of s){const l="points-".concat(a),c=za[a],u=c&&this.shouldRenderSubLayer(l,n.points.data)&&this.getSubLayerClass(l,c.type);if(u){const f=Tu(this,c.props);let h=n.points;if(a==="text"&&i){const{instancePickingColors:p,...g}=h.data.attributes;h={...h,data:{...h.data,attributes:g}}}o.push(new u(f,this.getSubLayerProps({id:l,updateTriggers:f.updateTriggers,highlightedObjectIndex:r}),h))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),r=this._renderPointLayers();return[!e&&n,i,r,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,r)=>{const{data:s,index:o}=r,a=nk(s,o);return e(a,r)}}}d(Q1,"layerName","GeoJsonLayer");d(Q1,"defaultProps",Nk);var Cd={exports:{}},sc={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fk=Rt.exports,Dk=Symbol.for("react.element"),zk=Symbol.for("react.fragment"),Uk=Object.prototype.hasOwnProperty,Bk=Fk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Vk={key:!0,ref:!0,__self:!0,__source:!0};function J1(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)Uk.call(e,i)&&!Vk.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:Dk,type:t,key:s,ref:o,props:r,_owner:Bk.current}}sc.Fragment=zk;sc.jsx=J1;sc.jsxs=J1;Cd.exports=sc;const Ls=Cd.exports.jsx,jk=Cd.exports.jsxs;function Gk(){const[t]=Rt.exports.useState({lat:37.74,lng:-122.4,zoom:12}),e=Rt.exports.useRef(),n=Rt.exports.useRef(null),i=Rt.exports.useRef(null),r=Rt.exports.useRef(void 0);return Rt.exports.useEffect(()=>{r.current=new gd({initialViewState:{latitude:t.lat,longitude:t.lng,zoom:t.zoom-1},parent:n.current,canvas:i.current,getCursor:s=>s.isHovering?"pointer":"grab",layers:[new ec({id:"scatterplot-layer",data:"https://raw.githubusercontent.com/visgl/deck.gl-data/master/website/bart-stations.json",pickable:!0,opacity:.8,stroked:!0,filled:!0,radiusScale:6,radiusMinPixels:1,radiusMaxPixels:100,lineWidthMinPixels:1,getPosition:s=>s.coordinates,getRadius:s=>Math.sqrt(s.exits),getFillColor:s=>[255,140,0],getLineColor:s=>[0,0,0],autoHighlight:!0,highlightColor:[255,0,0,100]})]}),ymaps.ready().then(()=>{e.current=new ymaps.Map("map",{center:[t.lat,t.lng],zoom:t.zoom,controls:["zoomControl"]},{maxAnimationZoomDifference:0});const s=e.current.options.get("projection");e.current.cursors.push("inherit"),e.current.events.add("actiontick",o=>{var l,c;console.log("actiontick");const a=s.fromGlobalPixels(o.originalEvent.tick.globalPixelCenter,o.originalEvent.tick.zoom);(l=r.current)==null||l.setProps({viewState:{latitude:a[0],longitude:a[1],zoom:o.originalEvent.tick.zoom-1}}),(c=r.current)==null||c.redraw("false")})})},[]),Rt.exports.useEffect(()=>()=>{var s;(s=r.current)==null||s.finalize(),r.current=void 0},[]),Ls("div",{className:"App",children:jk("div",{ref:n,style:{height:"100%",position:"relative"},children:[Ls("div",{id:"map",className:"Map"}),Ls("canvas",{ref:i,style:{position:"absolute",pointerEvents:"none",inset:0}})]})})}Su.createRoot(document.getElementById("root")).render(Ls(HE.StrictMode,{children:Ls(Gk,{})}))});export default Wk();
